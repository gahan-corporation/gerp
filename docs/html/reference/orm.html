
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ORM API &#8212; gerp 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Files" href="data.html" />
    <link rel="prev" title="Reference" href="../reference.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="orm-api">
<span id="reference-orm"></span><h1>ORM API<a class="headerlink" href="#orm-api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="recordsets">
<h2>Recordsets<a class="headerlink" href="#recordsets" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified">New in version 8.0: </span>This page documents the New API added in Gerp 8.0 which should be the
primary development API going forward. It also provides information about
porting from or bridging with the “old API” of versions 7 and earlier, but
does not explicitly document that API. See the old documentation for that.</p>
</div>
<p>Interaction with models and records is performed through recordsets, a sorted
set of records of the same model.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">contrary to what the name implies, it is currently possible for
recordsets to contain duplicates. This may change in the future.</p>
</div>
<p>Methods defined on a model are executed on a recordset, and their <code class="docutils literal"><span class="pre">self</span></code> is
a recordset:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;a.model&#39;</span>
    <span class="k">def</span> <span class="nf">a_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self can be anywhere between 0 records and all records in the</span>
        <span class="c1"># database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_operation</span><span class="p">()</span>
</pre></div>
</div>
<p>Iterating on a recordset will yield new sets of <em>a single record</em>
(“singletons”), much like iterating on a Python string yields strings of a
single characters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span> <span class="bp">self</span> <span class="c1"># =&gt; a.model(1, 2, 3, 4, 5)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">record</span> <span class="c1"># =&gt; a.model(1), then a.model(2), then a.model(3), ...</span>
</pre></div>
</div>
<div class="section" id="field-access">
<h3>Field access<a class="headerlink" href="#field-access" title="Permalink to this headline">¶</a></h3>
<p>Recordsets provide an “Active Record” interface: model fields can be read and
written directly from the record as attributes, but only on singletons
(single-record recordsets).
Field values can also be accessed like dict items, which is more elegant and
safer than <code class="docutils literal"><span class="pre">getattr()</span></code> for dynamic field names.
Setting a field’s value triggers an update to the database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">name</span>
<span class="go">Example Name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">name</span>
<span class="go">Company Name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">field</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
<span class="go">Bob</span>
</pre></div>
</div>
<p>Trying to read or write a field on multiple records will raise an error.</p>
<p>Accessing a relational field (<a class="reference internal" href="#gerp.fields.Many2one" title="gerp.fields.Many2one"><code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code></a>,
<a class="reference internal" href="#gerp.fields.One2many" title="gerp.fields.One2many"><code class="xref py py-class docutils literal"><span class="pre">One2many</span></code></a>, <a class="reference internal" href="#gerp.fields.Many2many" title="gerp.fields.Many2many"><code class="xref py py-class docutils literal"><span class="pre">Many2many</span></code></a>)
<em>always</em> returns a recordset, empty if the field is not set.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p>each assignment to a field triggers a database update, when setting
multiple fields at the same time or setting fields on multiple records
(to the same value), use <a class="reference internal" href="#gerp.models.Model.write" title="gerp.models.Model.write"><code class="xref py py-meth docutils literal"><span class="pre">write()</span></code></a>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># 3 * len(records) database updates</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
    <span class="n">record</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">record</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">record</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># len(records) database updates</span>
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
    <span class="n">record</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>

<span class="c1"># 1 database update</span>
<span class="n">records</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="record-cache-and-prefetching">
<h3>Record cache and prefetching<a class="headerlink" href="#record-cache-and-prefetching" title="Permalink to this headline">¶</a></h3>
<p>Gerp maintains a cache for the fields of the records, so that not every field
access issues a database request, which would be terrible for performance. The
following example queries the database only for the first statement:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">record</span><span class="o">.</span><span class="n">name</span>             <span class="c1"># first access reads value from database</span>
<span class="n">record</span><span class="o">.</span><span class="n">name</span>             <span class="c1"># second access gets value from cache</span>
</pre></div>
</div>
<p>To avoid reading one field on one record at a time, Gerp <em>prefetches</em> records
and fields following some heuristics to get good performance. Once a field must
be read on a given record, the ORM actually reads that field on a larger
recordset, and stores the returned values in cache for later use. The prefetched
recordset is usually the recordset from which the record comes by iteration.
Moreover, all simple stored fields (boolean, integer, float, char, text, date,
datetime, selection, many2one) are fetched altogether; they correspond to the
columns of the model’s table, and are fetched efficiently in the same query.</p>
<p>Consider the following example, where <code class="docutils literal"><span class="pre">partners</span></code> is a recordset of 1000
records. Without prefetching, the loop would make 2000 queries to the database.
With prefetching, only one query is made:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">partners</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">partner</span><span class="o">.</span><span class="n">name</span>          <span class="c1"># first pass prefetches &#39;name&#39; and &#39;lang&#39;</span>
                                <span class="c1"># (and other fields) on all &#39;partners&#39;</span>
    <span class="nb">print</span> <span class="n">partner</span><span class="o">.</span><span class="n">lang</span>
</pre></div>
</div>
<p>The prefetching also works on <em>secondary records</em>: when relational fields are
read, their values (which are records) are  subscribed for future prefetching.
Accessing one of those secondary records prefetches all secondary records from
the same model. This makes the following example generate only two queries, one
for partners and one for countries:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">countries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">partners</span><span class="p">:</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">partner</span><span class="o">.</span><span class="n">country_id</span>        <span class="c1"># first pass prefetches all partners</span>
    <span class="n">countries</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">country</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>         <span class="c1"># first pass prefetches all countries</span>
</pre></div>
</div>
</div>
<div class="section" id="set-operations">
<h3>Set operations<a class="headerlink" href="#set-operations" title="Permalink to this headline">¶</a></h3>
<p>Recordsets are immutable, but sets of the same model can be combined using
various set operations, returning new recordsets. Set operations do <em>not</em>
preserve order.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">record</span> <span class="pre">in</span> <span class="pre">set</span></code> returns whether <code class="docutils literal"><span class="pre">record</span></code> (which must be a 1-element
recordset) is present in <code class="docutils literal"><span class="pre">set</span></code>. <code class="docutils literal"><span class="pre">record</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">set</span></code> is the inverse
operation</li>
<li><code class="docutils literal"><span class="pre">set1</span> <span class="pre">&lt;=</span> <span class="pre">set2</span></code> and <code class="docutils literal"><span class="pre">set1</span> <span class="pre">&lt;</span> <span class="pre">set2</span></code> return whether <code class="docutils literal"><span class="pre">set1</span></code> is a subset
of <code class="docutils literal"><span class="pre">set2</span></code> (resp. strict)</li>
<li><code class="docutils literal"><span class="pre">set1</span> <span class="pre">&gt;=</span> <span class="pre">set2</span></code> and <code class="docutils literal"><span class="pre">set1</span> <span class="pre">&gt;</span> <span class="pre">set2</span></code> return whether <code class="docutils literal"><span class="pre">set1</span></code> is a superset
of <code class="docutils literal"><span class="pre">set2</span></code> (resp. strict)</li>
<li><code class="docutils literal"><span class="pre">set1</span> <span class="pre">|</span> <span class="pre">set2</span></code> returns the union of the two recordsets, a new recordset
containing all records present in either source</li>
<li><code class="docutils literal"><span class="pre">set1</span> <span class="pre">&amp;</span> <span class="pre">set2</span></code> returns the intersection of two recordsets, a new recordset
containing only records present in both sources</li>
<li><code class="docutils literal"><span class="pre">set1</span> <span class="pre">-</span> <span class="pre">set2</span></code> returns a new recordset containing only records of <code class="docutils literal"><span class="pre">set1</span></code>
which are <em>not</em> in <code class="docutils literal"><span class="pre">set2</span></code></li>
</ul>
</div>
<div class="section" id="other-recordset-operations">
<h3>Other recordset operations<a class="headerlink" href="#other-recordset-operations" title="Permalink to this headline">¶</a></h3>
<p>Recordsets are iterable so the usual Python tools are available for
transformation (<code class="xref py py-func docutils literal"><span class="pre">python:map()</span></code>, <code class="xref py py-func docutils literal"><span class="pre">python:sorted()</span></code>,
<code class="xref py py-func docutils literal"><span class="pre">ifilter()</span></code>, …) however these return either a
<code class="xref py py-class docutils literal"><span class="pre">python:list</span></code> or an <span class="xref std std-term">python:iterator</span>, removing the ability to
call methods on their result, or to use set operations.</p>
<p>Recordsets therefore provide these operations returning recordsets themselves
(when possible):</p>
<dl class="docutils">
<dt><a class="reference internal" href="#gerp.models.Model.filtered" title="gerp.models.Model.filtered"><code class="xref py py-meth docutils literal"><span class="pre">filtered()</span></code></a></dt>
<dd><p class="first">returns a recordset containing only records satisfying the provided
predicate function. The predicate can also be a string to filter by a
field being true or false:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># only keep records whose company is the current user&#39;s</span>
<span class="n">records</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">company_id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">company_id</span><span class="p">)</span>

<span class="c1"># only keep records whose partner is a company</span>
<span class="n">records</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="s2">&quot;partner_id.is_company&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.sorted" title="gerp.models.Model.sorted"><code class="xref py py-meth docutils literal"><span class="pre">sorted()</span></code></a></dt>
<dd><p class="first">returns a recordset sorted by the provided key function. If no key
is provided, use the model’s default sort order:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># sort records by name</span>
<span class="n">records</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.mapped" title="gerp.models.Model.mapped"><code class="xref py py-meth docutils literal"><span class="pre">mapped()</span></code></a></dt>
<dd><p class="first">applies the provided function to each record in the recordset, returns
a recordset if the results are recordsets:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># returns a list of summing two fields for each record in the set</span>
<span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">field1</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">field2</span><span class="p">)</span>
</pre></div>
</div>
<p>The provided function can be a string to get field values:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># returns a list of names</span>
<span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="c1"># returns a recordset of partners</span>
<span class="n">record</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">)</span>

<span class="c1"># returns the union of all partner banks, with duplicates removed</span>
<span class="n">record</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;partner_id.bank_ids&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<p>The <code class="xref py py-class docutils literal"><span class="pre">Environment</span></code> stores various contextual data used by
the ORM: the database cursor (for database queries), the current user
(for access rights checking) and the current context (storing arbitrary
metadata). The environment also stores caches.</p>
<p>All recordsets have an environment, which is immutable, can be accessed
using <code class="xref py py-attr docutils literal"><span class="pre">env</span></code> and gives access to the current user
(<code class="xref py py-attr docutils literal"><span class="pre">user</span></code>), the cursor
(<code class="xref py py-attr docutils literal"><span class="pre">cr</span></code>) or the context
(<code class="xref py py-attr docutils literal"><span class="pre">context</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">records</span><span class="o">.</span><span class="n">env</span>
<span class="go">&lt;Environment object ...&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">records</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span>
<span class="go">res.user(3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">records</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span>
<span class="go">&lt;Cursor object ...)</span>
</pre></div>
</div>
<p>When creating a recordset from an other recordset, the environment is
inherited. The environment can be used to get an empty recordset in an
other model, and query that model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
<span class="go">res.partner</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([[</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">]])</span>
<span class="go">res.partner(7, 18, 12, 14, 17, 19, 8, 31, 26, 16, 13, 20, 30, 22, 29, 15, 23, 28, 74)</span>
</pre></div>
</div>
<div class="section" id="altering-the-environment">
<h3>Altering the environment<a class="headerlink" href="#altering-the-environment" title="Permalink to this headline">¶</a></h3>
<p>The environment can be customized from a recordset. This returns a new
version of the recordset using the altered environment.</p>
<dl class="docutils">
<dt><a class="reference internal" href="#gerp.models.Model.sudo" title="gerp.models.Model.sudo"><code class="xref py py-meth docutils literal"><span class="pre">sudo()</span></code></a></dt>
<dd><p class="first">creates a new environment with the provided user set, uses the
administrator if none is provided (to bypass access rights/rules in safe
contexts), returns a copy of the recordset it is called on using the
new environment:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># create partner object as administrator</span>
<span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sudo</span><span class="p">()</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;A Partner&quot;</span><span class="p">})</span>

<span class="c1"># list partners visible by the &quot;public&quot; user</span>
<span class="n">public</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.public_user&#39;</span><span class="p">)</span>
<span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sudo</span><span class="p">(</span><span class="n">public</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.with_context" title="gerp.models.Model.with_context"><code class="xref py py-meth docutils literal"><span class="pre">with_context()</span></code></a></dt>
<dd><ol class="first arabic simple">
<li>can take a single positional parameter, which replaces the current
environment’s context</li>
<li>can take any number of parameters by keyword, which are added to either
the current environment’s context or the context set during step 1</li>
</ol>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="c1"># look for partner, or create one with specified timezone if none is</span>
<span class="c1"># found</span>
<span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">a_tz</span><span class="p">)</span><span class="o">.</span><span class="n">find_or_create</span><span class="p">(</span><span class="n">email_address</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.with_env" title="gerp.models.Model.with_env"><code class="xref py py-meth docutils literal"><span class="pre">with_env()</span></code></a></dt>
<dd>replaces the existing environment entirely</dd>
</dl>
</div>
</div>
<div class="section" id="common-orm-methods">
<h2>Common ORM methods<a class="headerlink" href="#common-orm-methods" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><a class="reference internal" href="#gerp.models.Model.search" title="gerp.models.Model.search"><code class="xref py py-meth docutils literal"><span class="pre">search()</span></code></a></dt>
<dd><p class="first">Takes a <a class="reference internal" href="#reference-orm-domains"><span class="std std-ref">search domain</span></a>, returns a recordset
of matching records. Can return a subset of matching records (<code class="docutils literal"><span class="pre">offset</span></code>
and <code class="docutils literal"><span class="pre">limit</span></code> parameters) and be ordered (<code class="docutils literal"><span class="pre">order</span></code> parameter):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># searches the current model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
<span class="go">res.partner(7, 18, 12, 14, 17, 19, 8, 31, 26, 16, 13, 20, 30, 22, 29, 15, 23, 28, 74)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;Agrolait&#39;</span>
</pre></div>
</div>
<div class="last admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">to just check if any record matches a domain, or count the number
of records which do, use
<a class="reference internal" href="#gerp.models.Model.search_count" title="gerp.models.Model.search_count"><code class="xref py py-meth docutils literal"><span class="pre">search_count()</span></code></a></p>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a></dt>
<dd><p class="first">Takes a number of field values, and returns a recordset containing the
record created:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;New Name&quot;</span><span class="p">})</span>
<span class="go">res.partner(78)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.write" title="gerp.models.Model.write"><code class="xref py py-meth docutils literal"><span class="pre">write()</span></code></a></dt>
<dd><p class="first">Takes a number of field values, writes them to all the records in its
recordset. Does not return anything:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Newer Name&quot;</span><span class="p">})</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.browse" title="gerp.models.Model.browse"><code class="xref py py-meth docutils literal"><span class="pre">browse()</span></code></a></dt>
<dd><p class="first">Takes a database id or a list of ids and returns a recordset, useful when
record ids are obtained from outside Gerp (e.g. round-trip through
external system) or <a class="reference internal" href="#reference-orm-oldapi"><span class="std std-ref">when calling methods in the old API</span></a>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
<span class="go">res.partner(7, 18, 12)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.exists" title="gerp.models.Model.exists"><code class="xref py py-meth docutils literal"><span class="pre">exists()</span></code></a></dt>
<dd><p class="first">Returns a new recordset containing only the records which exist in the
database. Can be used to check whether a record (e.g. obtained externally)
still exists:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The record has been deleted&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or after calling a method which could have removed some records:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">may_remove_some</span><span class="p">()</span>
<span class="c1"># only keep records which were not deleted</span>
<span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt><code class="xref py py-meth docutils literal"><span class="pre">ref()</span></code></dt>
<dd><p class="first">Environment method returning the record matching a provided
<a class="reference internal" href="../glossary.html#term-external-id"><span class="xref std std-term">external id</span></a>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_public&#39;</span><span class="p">)</span>
<span class="go">res.groups(2)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.models.Model.ensure_one" title="gerp.models.Model.ensure_one"><code class="xref py py-meth docutils literal"><span class="pre">ensure_one()</span></code></a></dt>
<dd><p class="first">checks that the recordset is a singleton (only contains a single record),
raises an error otherwise:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
<span class="c1"># is equivalent to but clearer than:</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Expected singleton&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="creating-models">
<h2>Creating Models<a class="headerlink" href="#creating-models" title="Permalink to this headline">¶</a></h2>
<p>Model fields are defined as attributes on the model itself:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerp</span> <span class="k">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>
<span class="k">class</span> <span class="nc">AModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;a.model.name&#39;</span>

    <span class="n">field1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">this means you can not define a field and a method with the same
name, they will conflict</p>
</div>
<p>By default, the field’s label (user-visible name) is a capitalized version of
the field name, this can be overridden with the <code class="docutils literal"><span class="pre">string</span></code> parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">field2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;an other field&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the various field types and parameters, see <a class="reference internal" href="#reference-orm-fields"><span class="std std-ref">the fields reference</span></a>.</p>
<p>Default values are defined as parameters on fields, either a value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">a_field</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;a value&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>or a function called to compute the default value, which should return that
value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
<span class="n">a_field</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">compute_default_value</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="computed-fields">
<h3>Computed fields<a class="headerlink" href="#computed-fields" title="Permalink to this headline">¶</a></h3>
<p>Fields can be computed (instead of read straight from the database) using the
<code class="docutils literal"><span class="pre">compute</span></code> parameter. <strong>It must assign the computed value to the field</strong>. If
it uses the values of other <em>fields</em>, it should specify those fields using
<a class="reference internal" href="#gerp.api.depends" title="gerp.api.depends"><code class="xref py py-func docutils literal"><span class="pre">depends()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerp</span> <span class="k">import</span> <span class="n">api</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_total&#39;</span><span class="p">)</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;tax&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_compute_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">tax</span>
</pre></div>
</div>
<ul>
<li><p class="first">dependencies can be dotted paths when using sub-fields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;line_ids.value&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_compute_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">computed fields are not stored by default, they are computed and
returned when requested. Setting <code class="docutils literal"><span class="pre">store=True</span></code> will store them in the
database and automatically enable searching</p>
</li>
<li><p class="first">searching on a computed field can also be enabled by setting the <code class="docutils literal"><span class="pre">search</span></code>
parameter. The value is a method name returning a
<a class="reference internal" href="#reference-orm-domains"><span class="std std-ref">Domains</span></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">upper_name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_upper&#39;</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_upper&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_search_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;like&#39;</span><span class="p">:</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;ilike&#39;</span>
    <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p class="first">to allow <em>setting</em> values on a computed field, use the <code class="docutils literal"><span class="pre">inverse</span></code>
parameter. It is the name of a function reversing the computation and
setting the relevant fields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">document</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_get_document&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_document&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_get_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get_document_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">_set_document</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">document</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get_document_path</span><span class="p">())</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">document</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">multiple fields can be computed at the same time by the same method, just
use the same method on all fields and set all of them:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">discount_value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_apply_discount&#39;</span><span class="p">)</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_apply_discount&#39;</span><span class="p">)</span>

<span class="nd">@depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;discount&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_apply_discount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="c1"># compute actual discount from discount percentage</span>
        <span class="n">discount</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">discount</span>
        <span class="n">record</span><span class="o">.</span><span class="n">discount_value</span> <span class="o">=</span> <span class="n">discount</span>
        <span class="n">record</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">discount</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="related-fields">
<h4>Related fields<a class="headerlink" href="#related-fields" title="Permalink to this headline">¶</a></h4>
<p>A special case of computed fields are <em>related</em> (proxy) fields, which provide
the value of a sub-field on the current record. They are defined by setting
the <code class="docutils literal"><span class="pre">related</span></code> parameter and like regular computed fields they can be
stored:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nickname</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;user_id.partner_id.name&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="onchange-updating-ui-on-the-fly">
<h3>onchange: updating UI on the fly<a class="headerlink" href="#onchange-updating-ui-on-the-fly" title="Permalink to this headline">¶</a></h3>
<p>When a user changes a field’s value in a form (but hasn’t saved the form yet),
it can be useful to automatically update other fields based on that value
e.g. updating a final total when the tax is changed or a new invoice line is
added.</p>
<ul>
<li><p class="first">computed fields are automatically checked and recomputed, they do not need
an <code class="docutils literal"><span class="pre">onchange</span></code></p>
</li>
<li><p class="first">for non-computed fields, the <a class="reference internal" href="#gerp.api.onchange" title="gerp.api.onchange"><code class="xref py py-func docutils literal"><span class="pre">onchange()</span></code></a> decorator is used
to provide new field values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;field1&#39;</span><span class="p">,</span> <span class="s1">&#39;field2&#39;</span><span class="p">)</span> <span class="c1"># if these fields are changed, call method</span>
<span class="k">def</span> <span class="nf">check_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">field2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field3</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>the changes performed during the method are then sent to the client program
and become visible to the user</p>
</li>
<li><p class="first">Both computed fields and new-API onchanges are automatically called by the
client without having to add them in views</p>
</li>
<li><p class="first">It is possible to suppress the trigger from a specific field by adding
<code class="docutils literal"><span class="pre">on_change=&quot;0&quot;</span></code> in a view:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;name&quot;</span> <span class="n">on_change</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>will not trigger any interface update when the field is edited by the user,
even if there are function fields or explicit onchange depending on that
field.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">onchange</span></code> methods work on virtual records assignment on these records
is not written to the database, just used to know which value to send back
to the client</p>
</div>
</div>
<div class="section" id="low-level-sql">
<h3>Low-level SQL<a class="headerlink" href="#low-level-sql" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-attr docutils literal"><span class="pre">cr</span></code> attribute on environments is the
cursor for the current database transaction and allows executing SQL directly,
either for queries which are difficult to express using the ORM (e.g. complex
joins) or for performance reasons:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;some_sql&quot;</span><span class="p">,</span> <span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>
</pre></div>
</div>
<p>Because models use the same cursor and the <code class="xref py py-class docutils literal"><span class="pre">Environment</span></code>
holds various caches, these caches must be invalidated when <em>altering</em> the
database in raw SQL, or further uses of models may become incoherent. It is
necessary to clear caches when using <code class="docutils literal"><span class="pre">CREATE</span></code>, <code class="docutils literal"><span class="pre">UPDATE</span></code> or <code class="docutils literal"><span class="pre">DELETE</span></code> in
SQL, but not <code class="docutils literal"><span class="pre">SELECT</span></code> (which simply reads the database).</p>
<p>Clearing caches can be performed using the
<code class="xref py py-meth docutils literal"><span class="pre">invalidate_all()</span></code> method of the
<code class="xref py py-class docutils literal"><span class="pre">Environment</span></code> object.</p>
</div>
</div>
<div class="section" id="compatibility-between-new-api-and-old-api">
<span id="reference-orm-oldapi"></span><h2>Compatibility between new API and old API<a class="headerlink" href="#compatibility-between-new-api-and-old-api" title="Permalink to this headline">¶</a></h2>
<p>Gerp is currently transitioning from an older (less regular) API, it can be
necessary to manually bridge from one to the other manually:</p>
<ul class="simple">
<li>RPC layers (both XML-RPC and JSON-RPC) are expressed in terms of the old
API, methods expressed purely in the new API are not available over RPC</li>
<li>overridable methods may be called from older pieces of code still written
in the old API style</li>
</ul>
<p>The big differences between the old and new APIs are:</p>
<ul class="simple">
<li>values of the <code class="xref py py-class docutils literal"><span class="pre">Environment</span></code> (cursor, user id and
context) are passed explicitly to methods instead</li>
<li>record data (<a class="reference internal" href="#gerp.models.Model.ids" title="gerp.models.Model.ids"><code class="xref py py-attr docutils literal"><span class="pre">ids</span></code></a>) are passed explicitly to
methods, and possibly not passed at all</li>
<li>methods tend to work on lists of ids instead of recordsets</li>
</ul>
<p>By default, methods are assumed to use the new API style and are not callable
from the old API style.</p>
<div class="aphorism admonition tip">
<p class="first admonition-title">Tip</p>
<p>calls from the new API to the old API are bridged</p>
<p>when using the new API style, calls to methods defined using the old API
are automatically converted on-the-fly, there should be no need to do
anything special:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># method in the old API style</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">old_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="gp">... </span>   <span class="nb">print</span> <span class="n">ids</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># method in the new API style</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">new_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># system automatically infers how to call the old-style</span>
<span class="gp">... </span>    <span class="c1"># method from the new-style method</span>
<span class="gp">... </span>    <span class="bp">self</span><span class="o">.</span><span class="n">old_method</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">new_method</span><span class="p">()</span>
<span class="go">[1, 2, 3, 4]</span>
</pre></div>
</div>
</div>
<p>Two decorators can expose a new-style method to the old API:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#gerp.api.model" title="gerp.api.model"><code class="xref py py-func docutils literal"><span class="pre">model()</span></code></a></dt>
<dd><p class="first">the method is exposed as not using ids, its recordset will generally be
empty. Its “old API” signature is <code class="docutils literal"><span class="pre">cr,</span> <span class="pre">uid,</span> <span class="pre">*arguments,</span> <span class="pre">context</span></code>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
<span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_value</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c1"># can be called as</span>
<span class="n">old_style_model</span><span class="o">.</span><span class="n">some_method</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">a_value</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><a class="reference internal" href="#gerp.api.multi" title="gerp.api.multi"><code class="xref py py-func docutils literal"><span class="pre">multi()</span></code></a></dt>
<dd><p class="first">the method is exposed as taking a list of ids (possibly empty), its
“old API” signature is <code class="docutils literal"><span class="pre">cr,</span> <span class="pre">uid,</span> <span class="pre">ids,</span> <span class="pre">*arguments,</span> <span class="pre">context</span></code>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">multi</span>
<span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_value</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="c1"># can be called as</span>
<span class="n">old_style_model</span><span class="o">.</span><span class="n">some_method</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">],</span> <span class="n">a_value</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>Because new-style APIs tend to return recordsets and old-style APIs tend to
return lists of ids, there is also a decorator managing this:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#gerp.api.returns" title="gerp.api.returns"><code class="xref py py-func docutils literal"><span class="pre">returns()</span></code></a></dt>
<dd><p class="first">the function is assumed to return a recordset, the first parameter should
be the name of the recordset’s model or <code class="docutils literal"><span class="pre">self</span></code> (for the current model).</p>
<p>No effect if the method is called in new API style, but transforms the
recordset into a list of ids when called from the old API style:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@api</span><span class="o">.</span><span class="n">multi</span>
<span class="gp">... </span><span class="nd">@api</span><span class="o">.</span><span class="n">returns</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">some_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">self</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_style_model</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;a.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_style_model</span><span class="o">.</span><span class="n">some_method</span><span class="p">()</span>
<span class="go">a.model(1, 2, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">old_style_model</span> <span class="o">=</span> <span class="n">pool</span><span class="p">[</span><span class="s1">&#39;a.model&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">old_style_model</span><span class="o">.</span><span class="n">some_method</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="go">[1, 2, 3]</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="model-reference">
<span id="reference-orm-model"></span><h2>Model Reference<a class="headerlink" href="#model-reference" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="gerp.models.Model">
<em class="property">class </em><code class="descclassname">gerp.models.</code><code class="descname">Model</code><span class="sig-paren">(</span><em>pool</em>, <em>cr</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/models.html#Model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.models.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>Main super-class for regular database-persisted Gerp models.</p>
<p>Gerp models are created by inheriting from this class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">user</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The system will later instantiate the class once per database (on
which the class’ module is installed).</p>
<p class="rubric">Structural attributes</p>
<dl class="attribute">
<dt id="gerp.models.Model._name">
<code class="descname">_name</code><a class="headerlink" href="#gerp.models.Model._name" title="Permalink to this definition">¶</a></dt>
<dd><p>business object name, in dot-notation (in module namespace)</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._rec_name">
<code class="descname">_rec_name</code><a class="headerlink" href="#gerp.models.Model._rec_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Alternative field to use as name, used by osv’s name_get()
(default: <code class="docutils literal"><span class="pre">'name'</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._inherit">
<code class="descname">_inherit</code><a class="headerlink" href="#gerp.models.Model._inherit" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li>If <a class="reference internal" href="#gerp.models.Model._name" title="gerp.models.Model._name"><code class="xref py py-attr docutils literal"><span class="pre">_name</span></code></a> is set, names of parent models to inherit from.
Can be a <code class="docutils literal"><span class="pre">str</span></code> if inheriting from a single parent</li>
<li>If <a class="reference internal" href="#gerp.models.Model._name" title="gerp.models.Model._name"><code class="xref py py-attr docutils literal"><span class="pre">_name</span></code></a> is unset, name of a single model to extend
in-place</li>
</ul>
<p>See <a class="reference internal" href="#reference-orm-inheritance"><span class="std std-ref">Inheritance and extension</span></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._order">
<code class="descname">_order</code><a class="headerlink" href="#gerp.models.Model._order" title="Permalink to this definition">¶</a></dt>
<dd><p>Ordering field when searching without an ordering specified (default:
<code class="docutils literal"><span class="pre">'id'</span></code>)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._auto">
<code class="descname">_auto</code><a class="headerlink" href="#gerp.models.Model._auto" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether a database table should be created (default: <code class="docutils literal"><span class="pre">True</span></code>)</p>
<p>If set to <code class="docutils literal"><span class="pre">False</span></code>, override <code class="xref py py-meth docutils literal"><span class="pre">init()</span></code> to create the database
table</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._table">
<code class="descname">_table</code><a class="headerlink" href="#gerp.models.Model._table" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of the table backing the model created when
<a class="reference internal" href="#gerp.models.Model._auto" title="gerp.models.Model._auto"><code class="xref py py-attr docutils literal"><span class="pre">_auto</span></code></a>, automatically generated by
default.</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._inherits">
<code class="descname">_inherits</code><a class="headerlink" href="#gerp.models.Model._inherits" title="Permalink to this definition">¶</a></dt>
<dd><p>dictionary mapping the _name of the parent business objects to the
names of the corresponding foreign key fields to use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;a.model&#39;</span><span class="p">:</span> <span class="s1">&#39;a_field_id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;b.model&#39;</span><span class="p">:</span> <span class="s1">&#39;b_field_id&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>implements composition-based inheritance: the new model exposes all
the fields of the <a class="reference internal" href="#gerp.models.Model._inherits" title="gerp.models.Model._inherits"><code class="xref py py-attr docutils literal"><span class="pre">_inherits</span></code></a>-ed model but
stores none of them: the values themselves remain stored on the linked
record.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">if the same field is defined on multiple
<a class="reference internal" href="#gerp.models.Model._inherits" title="gerp.models.Model._inherits"><code class="xref py py-attr docutils literal"><span class="pre">_inherits</span></code></a>-ed</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._constraints">
<code class="descname">_constraints</code><a class="headerlink" href="#gerp.models.Model._constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>list of <code class="docutils literal"><span class="pre">(constraint_function,</span> <span class="pre">message,</span> <span class="pre">fields)</span></code> defining Python
constraints. The fields list is indicative</p>
<div class="deprecated">
<p><span class="versionmodified">Deprecated since version 8.0: </span>use <a class="reference internal" href="#gerp.api.constrains" title="gerp.api.constrains"><code class="xref py py-func docutils literal"><span class="pre">constrains()</span></code></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._sql_constraints">
<code class="descname">_sql_constraints</code><a class="headerlink" href="#gerp.models.Model._sql_constraints" title="Permalink to this definition">¶</a></dt>
<dd><p>list of <code class="docutils literal"><span class="pre">(name,</span> <span class="pre">sql_definition,</span> <span class="pre">message)</span></code> triples defining SQL
constraints to execute when generating the backing table</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._parent_store">
<code class="descname">_parent_store</code><a class="headerlink" href="#gerp.models.Model._parent_store" title="Permalink to this definition">¶</a></dt>
<dd><p>Alongside <a class="reference internal" href="#gerp.models.Model.parent_left" title="gerp.models.Model.parent_left"><code class="xref py py-attr docutils literal"><span class="pre">parent_left</span></code></a> and <a class="reference internal" href="#gerp.models.Model.parent_right" title="gerp.models.Model.parent_right"><code class="xref py py-attr docutils literal"><span class="pre">parent_right</span></code></a>, sets up a
<a class="reference external" href="http://en.wikipedia.org/wiki/Nested_set_model">nested set</a>  to
enable fast hierarchical queries on the records of the current model
(default: <code class="docutils literal"><span class="pre">False</span></code>)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric">CRUD</p>
<dl class="method">
<dt id="gerp.models.Model.create">
<code class="descname">create</code><span class="sig-paren">(</span><em>vals</em><span class="sig-paren">)</span> &#x2192; record<a class="headerlink" href="#gerp.models.Model.create" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new record for the model.</p>
<p>The new record is initialized using the values from <code class="docutils literal"><span class="pre">vals</span></code> and
if necessary those from <a class="reference internal" href="#gerp.models.Model.default_get" title="gerp.models.Model.default_get"><code class="xref py py-meth docutils literal"><span class="pre">default_get()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>vals</strong> (<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>values for the model’s fields, as a dictionary:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;field_name&#39;</span><span class="p">:</span> <span class="n">field_value</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
</pre></div>
</div>
<p>see <a class="reference internal" href="#gerp.models.Model.write" title="gerp.models.Model.write"><code class="xref py py-meth docutils literal"><span class="pre">write()</span></code></a> for details</p>
</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">new record created</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.AccessError" title="gerp.exceptions.AccessError"><strong>AccessError</strong></a> – <ul>
<li>if user has no create rights on the requested object</li>
<li>if user tries to bypass access rules for create on the requested object</li>
</ul>
</li>
<li><strong>ValidateError</strong> – if user tries to enter invalid value for a field that is not in selection</li>
<li><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.UserError" title="gerp.exceptions.UserError"><strong>UserError</strong></a> – if a loop would be created in a hierarchy of objects a result of the operation (such as setting an object as its own parent)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.browse">
<code class="descname">browse</code><span class="sig-paren">(</span><span class="optional">[</span><em>ids</em><span class="optional">]</span><span class="sig-paren">)</span> &#x2192; records<a class="headerlink" href="#gerp.models.Model.browse" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a recordset for the ids provided as parameter in the current
environment.</p>
<p>Can take no ids, a single id or a sequence of ids.</p>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.unlink">
<code class="descname">unlink</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.unlink" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes the records of the current set</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.AccessError" title="gerp.exceptions.AccessError"><strong>AccessError</strong></a> – <ul>
<li>if user has no unlink rights on the requested object</li>
<li>if user tries to bypass access rules for unlink on the requested object</li>
</ul>
</li>
<li><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.UserError" title="gerp.exceptions.UserError"><strong>UserError</strong></a> – if the record is default property for other records</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>vals</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates all records in the current set with the provided values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>vals</strong> (<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – <p>fields to update and the value to set on them e.g:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="s2">&quot;Qux&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>will set the field <code class="docutils literal"><span class="pre">foo</span></code> to <code class="docutils literal"><span class="pre">1</span></code> and the field <code class="docutils literal"><span class="pre">bar</span></code> to
<code class="docutils literal"><span class="pre">&quot;Qux&quot;</span></code> if those are valid (otherwise it will trigger an error).</p>
</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.AccessError" title="gerp.exceptions.AccessError"><strong>AccessError</strong></a> – <ul>
<li>if user has no write rights on the requested object</li>
<li>if user tries to bypass access rules for write on the requested object</li>
</ul>
</li>
<li><strong>ValidateError</strong> – if user tries to enter invalid value for a field that is not in selection</li>
<li><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.UserError" title="gerp.exceptions.UserError"><strong>UserError</strong></a> – if a loop would be created in a hierarchy of objects a result of the operation (such as setting an object as its own parent)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">For numeric fields (<a class="reference internal" href="#gerp.fields.Integer" title="gerp.fields.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a>,
<a class="reference internal" href="#gerp.fields.Float" title="gerp.fields.Float"><code class="xref py py-class docutils literal"><span class="pre">Float</span></code></a>) the value should be of the
corresponding type</p>
</li>
<li><p class="first">For <a class="reference internal" href="#gerp.fields.Boolean" title="gerp.fields.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a>, the value should be a
<code class="xref py py-class docutils literal"><span class="pre">python:bool</span></code></p>
</li>
<li><p class="first">For <a class="reference internal" href="#gerp.fields.Selection" title="gerp.fields.Selection"><code class="xref py py-class docutils literal"><span class="pre">Selection</span></code></a>, the value should match the
selection values (generally <code class="xref py py-class docutils literal"><span class="pre">python:str</span></code>, sometimes
<code class="xref py py-class docutils literal"><span class="pre">python:int</span></code>)</p>
</li>
<li><p class="first">For <a class="reference internal" href="#gerp.fields.Many2one" title="gerp.fields.Many2one"><code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code></a>, the value should be the
database identifier of the record to set</p>
</li>
<li><p class="first">Other non-relational fields use a string for value</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">for historical and compatibility reasons,
<a class="reference internal" href="#gerp.fields.Date" title="gerp.fields.Date"><code class="xref py py-class docutils literal"><span class="pre">Date</span></code></a> and
<a class="reference internal" href="#gerp.fields.Datetime" title="gerp.fields.Datetime"><code class="xref py py-class docutils literal"><span class="pre">Datetime</span></code></a> fields use strings as values
(written and read) rather than <code class="xref py py-class docutils literal"><span class="pre">date</span></code> or
<code class="xref py py-class docutils literal"><span class="pre">datetime</span></code>. These date strings are
UTC-only and formatted according to
<code class="xref py py-const docutils literal"><span class="pre">gerp.tools.misc.DEFAULT_SERVER_DATE_FORMAT</span></code> and
<code class="xref py py-const docutils literal"><span class="pre">gerp.tools.misc.DEFAULT_SERVER_DATETIME_FORMAT</span></code></p>
</div>
</li>
<li><p id="openerp-models-relationals-format"><a class="reference internal" href="#gerp.fields.One2many" title="gerp.fields.One2many"><code class="xref py py-class docutils literal"><span class="pre">One2many</span></code></a> and
<a class="reference internal" href="#gerp.fields.Many2many" title="gerp.fields.Many2many"><code class="xref py py-class docutils literal"><span class="pre">Many2many</span></code></a> use a special “commands” format to
manipulate the set of records stored in/associated with the field.</p>
<p>This format is a list of triplets executed sequentially, where each
triplet is a command to execute on the set of records. Not all
commands apply in all situations. Possible commands are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">(0,</span> <span class="pre">_,</span> <span class="pre">values)</span></code></dt>
<dd><p class="first last">adds a new record created from the provided <code class="docutils literal"><span class="pre">value</span></code> dict.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">(1,</span> <span class="pre">id,</span> <span class="pre">values)</span></code></dt>
<dd><p class="first last">updates an existing record of id <code class="docutils literal"><span class="pre">id</span></code> with the values in
<code class="docutils literal"><span class="pre">values</span></code>. Can not be used in <a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">(2,</span> <span class="pre">id,</span> <span class="pre">_)</span></code></dt>
<dd><p class="first last">removes the record of id <code class="docutils literal"><span class="pre">id</span></code> from the set, then deletes it
(from the database). Can not be used in <a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">(3,</span> <span class="pre">id,</span> <span class="pre">_)</span></code></dt>
<dd><p class="first last">removes the record of id <code class="docutils literal"><span class="pre">id</span></code> from the set, but does not
delete it. Can not be used on
<a class="reference internal" href="#gerp.fields.One2many" title="gerp.fields.One2many"><code class="xref py py-class docutils literal"><span class="pre">One2many</span></code></a>. Can not be used in
<a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">(4,</span> <span class="pre">id,</span> <span class="pre">_)</span></code></dt>
<dd><p class="first last">adds an existing record of id <code class="docutils literal"><span class="pre">id</span></code> to the set. Can not be
used on <a class="reference internal" href="#gerp.fields.One2many" title="gerp.fields.One2many"><code class="xref py py-class docutils literal"><span class="pre">One2many</span></code></a>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">(5,</span> <span class="pre">_,</span> <span class="pre">_)</span></code></dt>
<dd><p class="first last">removes all records from the set, equivalent to using the
command <code class="docutils literal"><span class="pre">3</span></code> on every record explicitly. Can not be used on
<a class="reference internal" href="#gerp.fields.One2many" title="gerp.fields.One2many"><code class="xref py py-class docutils literal"><span class="pre">One2many</span></code></a>. Can not be used in
<a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">(6,</span> <span class="pre">_,</span> <span class="pre">ids)</span></code></dt>
<dd><p class="first last">replaces all existing records in the set by the <code class="docutils literal"><span class="pre">ids</span></code> list,
equivalent to using the command <code class="docutils literal"><span class="pre">5</span></code> followed by a command
<code class="docutils literal"><span class="pre">4</span></code> for each <code class="docutils literal"><span class="pre">id</span></code> in <code class="docutils literal"><span class="pre">ids</span></code>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Values marked as <code class="docutils literal"><span class="pre">_</span></code> in the list above are ignored and
can be anything, generally <code class="docutils literal"><span class="pre">0</span></code> or <code class="docutils literal"><span class="pre">False</span></code>.</p>
</div>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.read">
<code class="descname">read</code><span class="sig-paren">(</span><span class="optional">[</span><em>fields</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the requested fields for the records in <code class="docutils literal"><span class="pre">self</span></code>, low-level/RPC
method. In Python code, prefer <a class="reference internal" href="#gerp.models.Model.browse" title="gerp.models.Model.browse"><code class="xref py py-meth docutils literal"><span class="pre">browse()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fields</strong> – list of field names to return (default is all fields)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a list of dictionaries mapping field names to their values,
with one dictionary per record</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.AccessError" title="gerp.exceptions.AccessError"><strong>AccessError</strong></a> – if user has no read rights on some of the given
records</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.read_group">
<code class="descname">read_group</code><span class="sig-paren">(</span><em>domain</em>, <em>fields</em>, <em>groupby</em>, <em>offset=0</em>, <em>limit=None</em>, <em>orderby=False</em>, <em>lazy=True</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.read_group" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the list of records in list view grouped by the given <code class="docutils literal"><span class="pre">groupby</span></code> fields</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>domain</strong> – list specifying search criteria [[‘field_name’, ‘operator’, ‘value’], …]</li>
<li><strong>fields</strong> (<em>list</em>) – list of fields present in the list view specified on the object</li>
<li><strong>groupby</strong> (<em>list</em>) – list of groupby descriptions by which the records will be grouped.  
A groupby description is either a field (then it will be grouped by that field)
or a string ‘field:groupby_function’.  Right now, the only functions supported
are ‘day’, ‘week’, ‘month’, ‘quarter’ or ‘year’, and they only make sense for 
date/datetime fields.</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – optional number of records to skip</li>
<li><strong>limit</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – optional max number of records to return</li>
<li><strong>orderby</strong> (<em>list</em>) – optional <code class="docutils literal"><span class="pre">order</span> <span class="pre">by</span></code> specification, for
overriding the natural sort ordering of the
groups, see also <code class="xref py py-meth docutils literal"><span class="pre">search()</span></code>
(supported only for many2one fields currently)</li>
<li><strong>lazy</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if true, the results are only grouped by the first groupby and the 
remaining groupbys are put in the __context key.  If false, all the groupbys are
done in one call.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>list of dictionaries(one dictionary for each record) containing:</p>
<ul class="simple">
<li>the values of fields grouped by the fields in <code class="docutils literal"><span class="pre">groupby</span></code> argument</li>
<li>__domain: list of tuples specifying the search criteria</li>
<li>__context: dictionary with argument like <code class="docutils literal"><span class="pre">groupby</span></code></li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">[{‘field_name_1’: value, ..]</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.AccessError" title="gerp.exceptions.AccessError"><strong>AccessError</strong></a> – <ul class="simple">
<li>if user has no read rights on the requested object</li>
<li>if user tries to bypass access rules for read on the requested object</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric">Searching</p>
<dl class="method">
<dt id="gerp.models.Model.search">
<code class="descname">search</code><span class="sig-paren">(</span><em>args[, offset=0][, limit=None][, order=None][, count=False]</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches for records based on the <code class="docutils literal"><span class="pre">args</span></code>
<a class="reference internal" href="#reference-orm-domains"><span class="std std-ref">search domain</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>args</strong> – <a class="reference internal" href="#reference-orm-domains"><span class="std std-ref">A search domain</span></a>. Use an empty
list to match all records.</li>
<li><strong>offset</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – number of results to ignore (default: none)</li>
<li><strong>limit</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – maximum number of records to return (default: all)</li>
<li><strong>order</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – sort string</li>
<li><strong>count</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – if True, only counts and returns the number of matching records (default: False)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">at most <code class="docutils literal"><span class="pre">limit</span></code> records matching the search criteria</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="../webservices/iap.html#gerp.exceptions.AccessError" title="gerp.exceptions.AccessError"><strong>AccessError</strong></a> – <ul class="simple">
<li>if user tries to bypass access rules for read on the requested object.</li>
</ul>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.search_count">
<code class="descname">search_count</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span> &#x2192; int<a class="headerlink" href="#gerp.models.Model.search_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of records in the current model matching <a class="reference internal" href="#reference-orm-domains"><span class="std std-ref">the
provided domain</span></a>.</p>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.name_search">
<code class="descname">name_search</code><span class="sig-paren">(</span><em>name=''</em>, <em>args=None</em>, <em>operator='ilike'</em>, <em>limit=100</em><span class="sig-paren">)</span> &#x2192; records<a class="headerlink" href="#gerp.models.Model.name_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Search for records that have a display name matching the given
<code class="docutils literal"><span class="pre">name</span></code> pattern when compared with the given <code class="docutils literal"><span class="pre">operator</span></code>, while also
matching the optional search domain (<code class="docutils literal"><span class="pre">args</span></code>).</p>
<p>This is used for example to provide suggestions based on a partial
value for a relational field. Sometimes be seen as the inverse
function of <a class="reference internal" href="#gerp.models.Model.name_get" title="gerp.models.Model.name_get"><code class="xref py py-meth docutils literal"><span class="pre">name_get()</span></code></a>, but it is not guaranteed to be.</p>
<p>This method is equivalent to calling <a class="reference internal" href="#gerp.models.Model.search" title="gerp.models.Model.search"><code class="xref py py-meth docutils literal"><span class="pre">search()</span></code></a> with a search
domain based on <code class="docutils literal"><span class="pre">display_name</span></code> and then <a class="reference internal" href="#gerp.models.Model.name_get" title="gerp.models.Model.name_get"><code class="xref py py-meth docutils literal"><span class="pre">name_get()</span></code></a> on the
result of the search.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – the name pattern to match</li>
<li><strong>args</strong> (<em>list</em>) – optional search domain (see <a class="reference internal" href="#gerp.models.Model.search" title="gerp.models.Model.search"><code class="xref py py-meth docutils literal"><span class="pre">search()</span></code></a> for
syntax), specifying further restrictions</li>
<li><strong>operator</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) – domain operator for matching <code class="docutils literal"><span class="pre">name</span></code>, such as
<code class="docutils literal"><span class="pre">'like'</span></code> or <code class="docutils literal"><span class="pre">'='</span></code>.</li>
<li><strong>limit</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – optional max number of records to return</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">list</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of pairs <code class="docutils literal"><span class="pre">(id,</span> <span class="pre">text_repr)</span></code> for all matching records.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric">Recordset operations</p>
<dl class="attribute">
<dt id="gerp.models.Model.ids">
<code class="descname">ids</code><a class="headerlink" href="#gerp.models.Model.ids" title="Permalink to this definition">¶</a></dt>
<dd><p>List of actual record ids in this recordset (ignores placeholder
ids for records to create)</p>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.ensure_one">
<code class="descname">ensure_one</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.ensure_one" title="Permalink to this definition">¶</a></dt>
<dd><p>Verifies that the current recorset holds a single record. Raises
an exception otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.exists">
<code class="descname">exists</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; records<a class="headerlink" href="#gerp.models.Model.exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the subset of records in <code class="docutils literal"><span class="pre">self</span></code> that exist, and marks deleted
records as such in cache. It can be used as a test on records:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>By convention, new records are returned as existing.</p>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.filtered">
<code class="descname">filtered</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.filtered" title="Permalink to this definition">¶</a></dt>
<dd><p>Select the records in <code class="docutils literal"><span class="pre">self</span></code> such that <code class="docutils literal"><span class="pre">func(rec)</span></code> is true, and
return them as a recordset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>func</strong> – a function or a dot-separated sequence of field names</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.sorted">
<code class="descname">sorted</code><span class="sig-paren">(</span><em>key=None</em>, <em>reverse=False</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.sorted" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the recordset <code class="docutils literal"><span class="pre">self</span></code> ordered by <code class="docutils literal"><span class="pre">key</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> – either a function of one argument that returns a
comparison key for each record, or a field name, or <code class="docutils literal"><span class="pre">None</span></code>, in
which case records are ordered according the default model’s order</li>
<li><strong>reverse</strong> – if <code class="docutils literal"><span class="pre">True</span></code>, return the result in reverse order</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.mapped">
<code class="descname">mapped</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.mapped" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply <code class="docutils literal"><span class="pre">func</span></code> on all records in <code class="docutils literal"><span class="pre">self</span></code>, and return the result as a
list or a recordset (if <code class="docutils literal"><span class="pre">func</span></code> return recordsets). In the latter
case, the order of the returned recordset is arbitrary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>func</strong> – a function or a dot-separated sequence of field names
(string); any falsy value simply returns the recordset <code class="docutils literal"><span class="pre">self</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric">Environment swapping</p>
<dl class="method">
<dt id="gerp.models.Model.sudo">
<code class="descname">sudo</code><span class="sig-paren">(</span><span class="optional">[</span><em>user=SUPERUSER</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.sudo" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new version of this recordset attached to the provided
user.</p>
<p>By default this returns a <code class="docutils literal"><span class="pre">SUPERUSER</span></code> recordset, where access
control and record rules are bypassed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Using <code class="docutils literal"><span class="pre">sudo</span></code> could cause data access to cross the
boundaries of record rules, possibly mixing records that
are meant to be isolated (e.g. records from different
companies in multi-company environments).</p>
<p class="last">It may lead to un-intuitive results in methods which select one
record among many - for example getting the default company, or
selecting a Bill of Materials.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because the record rules and access control will have to be
re-evaluated, the new recordset will not benefit from the current
environment’s data cache, so later data access may incur extra
delays while re-fetching from the database.
The returned recordset has the same prefetch object as <code class="docutils literal"><span class="pre">self</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.with_context">
<code class="descname">with_context</code><span class="sig-paren">(</span><em>[context][, **overrides]</em><span class="sig-paren">)</span> &#x2192; records<a class="headerlink" href="#gerp.models.Model.with_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new version of this recordset attached to an extended
context.</p>
<p>The extended context is either the provided <code class="docutils literal"><span class="pre">context</span></code> in which
<code class="docutils literal"><span class="pre">overrides</span></code> are merged or the <em>current</em> context in which
<code class="docutils literal"><span class="pre">overrides</span></code> are merged e.g.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># current context is {&#39;key1&#39;: True}</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">({},</span> <span class="n">key2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># -&gt; r2._context is {&#39;key2&#39;: True}</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">key2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># -&gt; r2._context is {&#39;key1&#39;: True, &#39;key2&#39;: True}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.with_env">
<code class="descname">with_env</code><span class="sig-paren">(</span><em>env</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.with_env" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a new version of this recordset attached to the provided
environment</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The new environment will not benefit from the current
environment’s data cache, so later data access may incur extra
delays while re-fetching from the database.
The returned recordset has the same prefetch object as <code class="docutils literal"><span class="pre">self</span></code>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
</tbody>
</table>
</dd></dl>

<p class="rubric">Fields and views querying</p>
<dl class="method">
<dt id="gerp.models.Model.fields_get">
<code class="descname">fields_get</code><span class="sig-paren">(</span><em>[fields][, attributes]</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.fields_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the definition of each field.</p>
<p>The returned value is a dictionary (indiced by field name) of
dictionaries. The _inherits’d fields are included. The string, help,
and selection (if present) attributes are translated.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>allfields</strong> – list of fields to document, all if empty or not provided</li>
<li><strong>attributes</strong> – list of description attributes to return for each field, all if empty or not provided</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.fields_view_get">
<code class="descname">fields_view_get</code><span class="sig-paren">(</span><span class="optional">[</span><em>view_id | view_type='form'</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.fields_view_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the detailed composition of the requested view like fields, model, view architecture</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>view_id</strong> – id of the view or None</li>
<li><strong>view_type</strong> – type of the view to return if view_id is None (‘form’, ‘tree’, …)</li>
<li><strong>toolbar</strong> – true to include contextual actions</li>
<li><strong>submenu</strong> – deprecated</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dictionary describing the composition of the requested view (including inherited views and extensions)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>AttributeError</strong> – <ul>
<li>if the inherited view has unknown position to work with other than ‘before’, ‘after’, ‘inside’, ‘replace’</li>
<li>if some tag other than ‘position’ is found in parent view</li>
</ul>
</li>
<li><strong>Invalid ArchitectureError</strong> – if there is view type other than form, tree, calendar, search etc defined on the structure</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric">Miscellaneous methods</p>
<dl class="method">
<dt id="gerp.models.Model.default_get">
<code class="descname">default_get</code><span class="sig-paren">(</span><em>fields</em><span class="sig-paren">)</span> &#x2192; default_values<a class="headerlink" href="#gerp.models.Model.default_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return default values for the fields in <code class="docutils literal"><span class="pre">fields_list</span></code>. Default
values are determined by the context, user defaults, and the model
itself.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>fields_list</strong> – a list of field names</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a dictionary mapping each field name to its corresponding
default value, if it has one.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.copy">
<code class="descname">copy</code><span class="sig-paren">(</span><em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#gerp.models.Model.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Duplicate record <code class="docutils literal"><span class="pre">self</span></code> updating it with default values</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>default</strong> (<a class="reference external" href="https://docs.python.org/2/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) – dictionary of field values to override in the
original values of the copied record, e.g: <code class="docutils literal"><span class="pre">{'field_name':</span> <span class="pre">overridden_value,</span> <span class="pre">...}</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">new record</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.name_get">
<code class="descname">name_get</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; [(id, name), ...]<a class="headerlink" href="#gerp.models.Model.name_get" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a textual representation for the records in <code class="docutils literal"><span class="pre">self</span></code>.
By default this is the value of the <code class="docutils literal"><span class="pre">display_name</span></code> field.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of pairs <code class="docutils literal"><span class="pre">(id,</span> <span class="pre">text_repr)</span></code> for each records</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list(<a class="reference external" href="https://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)">tuple</a>)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="gerp.models.Model.name_create">
<code class="descname">name_create</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span> &#x2192; record<a class="headerlink" href="#gerp.models.Model.name_create" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new record by calling <a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a> with only one value
provided: the display name of the new record.</p>
<p>The new record will be initialized with any default values
applicable to this model, or provided through the context. The usual
behavior of <a class="reference internal" href="#gerp.models.Model.create" title="gerp.models.Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a> applies.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> – display name of the record to create</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2/library/functions.html#tuple" title="(in Python v2.7)">tuple</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the <a class="reference internal" href="#gerp.models.Model.name_get" title="gerp.models.Model.name_get"><code class="xref py py-meth docutils literal"><span class="pre">name_get()</span></code></a> pair value of the created record</td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric" id="reference-orm-model-automatic">Automatic fields</p>
<dl class="attribute">
<dt id="gerp.models.Model.id">
<code class="descname">id</code><a class="headerlink" href="#gerp.models.Model.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Identifier <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">field</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model._log_access">
<code class="descname">_log_access</code><a class="headerlink" href="#gerp.models.Model._log_access" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether log access fields (<code class="docutils literal"><span class="pre">create_date</span></code>, <code class="docutils literal"><span class="pre">write_uid</span></code>, …) should
be generated (default: <code class="docutils literal"><span class="pre">True</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.create_date">
<code class="descname">create_date</code><a class="headerlink" href="#gerp.models.Model.create_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Date at which the record was created</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">Datetime</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.create_uid">
<code class="descname">create_uid</code><a class="headerlink" href="#gerp.models.Model.create_uid" title="Permalink to this definition">¶</a></dt>
<dd><p>Relational field to the user who created the record</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal"><span class="pre">res.users</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.write_date">
<code class="descname">write_date</code><a class="headerlink" href="#gerp.models.Model.write_date" title="Permalink to this definition">¶</a></dt>
<dd><p>Date at which the record was last modified</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">Datetime</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.write_uid">
<code class="descname">write_uid</code><a class="headerlink" href="#gerp.models.Model.write_uid" title="Permalink to this definition">¶</a></dt>
<dd><p>Relational field to the last user who modified the record</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><code class="docutils literal"><span class="pre">res.users</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<p class="rubric">Reserved field names</p>
<p>A few field names are reserved for pre-defined behaviors beyond that of
automated fields. They should be defined on a model when the related
behavior is desired:</p>
<dl class="attribute">
<dt id="gerp.models.Model.name">
<code class="descname">name</code><a class="headerlink" href="#gerp.models.Model.name" title="Permalink to this definition">¶</a></dt>
<dd><p>default value for <a class="reference internal" href="#gerp.models.Model._rec_name" title="gerp.models.Model._rec_name"><code class="xref py py-attr docutils literal"><span class="pre">_rec_name</span></code></a>, used to
display records in context where a representative “naming” is
necessary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#gerp.fields.Char" title="gerp.fields.Char"><code class="xref py py-class docutils literal"><span class="pre">Char</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.active">
<code class="descname">active</code><a class="headerlink" href="#gerp.models.Model.active" title="Permalink to this definition">¶</a></dt>
<dd><p>toggles the global visibility of the record, if <code class="docutils literal"><span class="pre">active</span></code> is set to
<code class="docutils literal"><span class="pre">False</span></code> the record is invisible in most searches and listing</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#gerp.fields.Boolean" title="gerp.fields.Boolean"><code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.sequence">
<code class="descname">sequence</code><a class="headerlink" href="#gerp.models.Model.sequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Alterable ordering criteria, allows drag-and-drop reordering of models
in list views</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#gerp.fields.Integer" title="gerp.fields.Integer"><code class="xref py py-class docutils literal"><span class="pre">Integer</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.state">
<code class="descname">state</code><a class="headerlink" href="#gerp.models.Model.state" title="Permalink to this definition">¶</a></dt>
<dd><p>lifecycle stages of the object, used by the <code class="docutils literal"><span class="pre">states</span></code> attribute on
<a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">fields</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#gerp.fields.Selection" title="gerp.fields.Selection"><code class="xref py py-class docutils literal"><span class="pre">Selection</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.parent_id">
<code class="descname">parent_id</code><a class="headerlink" href="#gerp.models.Model.parent_id" title="Permalink to this definition">¶</a></dt>
<dd><p>used to order records in a tree structure and enables the <code class="docutils literal"><span class="pre">child_of</span></code>
operator in domains</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#gerp.fields.Many2one" title="gerp.fields.Many2one"><code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.parent_left">
<code class="descname">parent_left</code><a class="headerlink" href="#gerp.models.Model.parent_left" title="Permalink to this definition">¶</a></dt>
<dd><p>used with <a class="reference internal" href="#gerp.models.Model._parent_store" title="gerp.models.Model._parent_store"><code class="xref py py-attr docutils literal"><span class="pre">_parent_store</span></code></a>, allows faster tree structure access</p>
</dd></dl>

<dl class="attribute">
<dt id="gerp.models.Model.parent_right">
<code class="descname">parent_right</code><a class="headerlink" href="#gerp.models.Model.parent_right" title="Permalink to this definition">¶</a></dt>
<dd><p>see <a class="reference internal" href="#gerp.models.Model.parent_left" title="gerp.models.Model.parent_left"><code class="xref py py-attr docutils literal"><span class="pre">parent_left</span></code></a></p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-gerp.api">
<span id="method-decorators"></span><span id="reference-orm-decorators"></span><h2>Method decorators<a class="headerlink" href="#module-gerp.api" title="Permalink to this headline">¶</a></h2>
<p>This module provides the elements for managing two different API styles,
namely the “traditional” and “record” styles.</p>
<p>In the “traditional” style, parameters like the database cursor, user id,
context dictionary and record ids (usually denoted as <code class="docutils literal"><span class="pre">cr</span></code>, <code class="docutils literal"><span class="pre">uid</span></code>,
<code class="docutils literal"><span class="pre">context</span></code>, <code class="docutils literal"><span class="pre">ids</span></code>) are passed explicitly to all methods. In the “record”
style, those parameters are hidden into model instances, which gives it a
more object-oriented feel.</p>
<p>For instance, the statements:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">MODEL</span><span class="p">)</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">DOMAIN</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>
<span class="n">model</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">VALUES</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>may also be written as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="c1"># cr, uid, context wrapped in env</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">env</span><span class="p">[</span><span class="n">MODEL</span><span class="p">]</span>                  <span class="c1"># retrieve an instance of MODEL</span>
<span class="n">recs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">DOMAIN</span><span class="p">)</span>         <span class="c1"># search returns a recordset</span>
<span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">recs</span><span class="p">:</span>                    <span class="c1"># iterate over the records</span>
    <span class="nb">print</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>
<span class="n">recs</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">VALUES</span><span class="p">)</span>                  <span class="c1"># update all records in recs</span>
</pre></div>
</div>
<p>Methods written in the “traditional” style are automatically decorated,
following some heuristics based on parameter names.</p>
<dl class="function">
<dt id="gerp.api.multi">
<code class="descclassname">gerp.api.</code><code class="descname">multi</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#multi"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.multi" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorate a record-style method where <code class="docutils literal"><span class="pre">self</span></code> is a recordset. The method
typically defines an operation on records. Such a method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">multi</span>
<span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>may be called in both record and traditional styles, like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># recs = model.browse(cr, uid, ids, context)</span>
<span class="n">recs</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="gerp.api.model">
<code class="descclassname">gerp.api.</code><code class="descname">model</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.model" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorate a record-style method where <code class="docutils literal"><span class="pre">self</span></code> is a recordset, but its
contents is not relevant, only the model is. Such a method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
<span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>may be called in both record and traditional styles, like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># recs = model.browse(cr, uid, ids, context)</span>
<span class="n">recs</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that no <code class="docutils literal"><span class="pre">ids</span></code> are passed to the method in the traditional style.</p>
</dd></dl>

<dl class="function">
<dt id="gerp.api.depends">
<code class="descclassname">gerp.api.</code><code class="descname">depends</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#depends"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.depends" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a decorator that specifies the field dependencies of a “compute”
method (for new-style function fields). Each argument must be a string
that consists in a dot-separated sequence of field names:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pname</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_pname&#39;</span><span class="p">)</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">one</span>
<span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id.is_company&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_compute_pname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">is_company</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pname</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>One may also pass a single function as argument. In that case, the
dependencies are given by calling the function with the field’s model.</p>
</dd></dl>

<dl class="function">
<dt id="gerp.api.constrains">
<code class="descclassname">gerp.api.</code><code class="descname">constrains</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#constrains"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.constrains" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a constraint checker. Each argument must be a field name
used in the check:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">one</span>
<span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_check_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Fields name and description must be different&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Invoked on the records on which one of the named fields has been modified.</p>
<p>Should raise <code class="xref py py-class docutils literal"><span class="pre">ValidationError</span></code> if the
validation failed.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><code class="docutils literal"><span class="pre">&#64;constrains</span></code> only supports simple field names, dotted names
(fields of relational fields e.g. <code class="docutils literal"><span class="pre">partner_id.customer</span></code>) are not
supported and will be ignored</p>
<p class="last"><code class="docutils literal"><span class="pre">&#64;constrains</span></code> will be triggered only if the declared fields in the
decorated method are included in the <code class="docutils literal"><span class="pre">create</span></code> or <code class="docutils literal"><span class="pre">write</span></code> call.
It implies that fields not present in a view will not trigger a call
during a record creation. A override of <code class="docutils literal"><span class="pre">create</span></code> is necessary to make
sure a constraint will always be triggered (e.g. to test the absence of
value).</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gerp.api.onchange">
<code class="descclassname">gerp.api.</code><code class="descname">onchange</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#onchange"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.onchange" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a decorator to decorate an onchange method for given fields.
Each argument must be a field name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_onchange_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Dear </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the form views where the field appears, the method will be called
when one of the given fields is modified. The method is invoked on a
pseudo-record that contains the values present in the form. Field
assignments on that record are automatically sent back to the client.</p>
<p>The method may return a dictionary for changing field domains and pop up
a warning message, like in the old API:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">{</span>
    <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;other_id&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">partner_id</span><span class="p">)]},</span>
    <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><code class="docutils literal"><span class="pre">&#64;onchange</span></code> only supports simple field names, dotted names
(fields of relational fields e.g. <code class="docutils literal"><span class="pre">partner_id.tz</span></code>) are not
supported and will be ignored</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gerp.api.returns">
<code class="descclassname">gerp.api.</code><code class="descname">returns</code><span class="sig-paren">(</span><em>model</em>, <em>downgrade=None</em>, <em>upgrade=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#returns"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.returns" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a decorator for methods that return instances of <code class="docutils literal"><span class="pre">model</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>model</strong> – a model name, or <code class="docutils literal"><span class="pre">'self'</span></code> for the current model</li>
<li><strong>downgrade</strong> – a function <code class="docutils literal"><span class="pre">downgrade(self,</span> <span class="pre">value,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code>
to convert the record-style <code class="docutils literal"><span class="pre">value</span></code> to a traditional-style output</li>
<li><strong>upgrade</strong> – a function <code class="docutils literal"><span class="pre">upgrade(self,</span> <span class="pre">value,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code>
to convert the traditional-style <code class="docutils literal"><span class="pre">value</span></code> to a record-style output</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The arguments <code class="docutils literal"><span class="pre">self</span></code>, <code class="docutils literal"><span class="pre">*args</span></code> and <code class="docutils literal"><span class="pre">**kwargs</span></code> are the ones passed
to the method in the record-style.</p>
<p>The decorator adapts the method output to the api style: <code class="docutils literal"><span class="pre">id</span></code>, <code class="docutils literal"><span class="pre">ids</span></code> or
<code class="docutils literal"><span class="pre">False</span></code> for the traditional style, and recordset for the record style:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@model</span>
<span class="nd">@returns</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">find_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="o">...</span>     <span class="c1"># return some record</span>

<span class="c1"># output depends on call style: traditional vs record style</span>
<span class="n">partner_id</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">find_partner</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

<span class="c1"># recs = model.browse(cr, uid, ids, context)</span>
<span class="n">partner_record</span> <span class="o">=</span> <span class="n">recs</span><span class="o">.</span><span class="n">find_partner</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the decorated method must satisfy that convention.</p>
<p>Those decorators are automatically <em>inherited</em>: a method that overrides
a decorated existing method will be decorated with the same
<code class="docutils literal"><span class="pre">&#64;returns(model)</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="gerp.api.one">
<code class="descclassname">gerp.api.</code><code class="descname">one</code><span class="sig-paren">(</span><em>method</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#one"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.one" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorate a record-style method where <code class="docutils literal"><span class="pre">self</span></code> is expected to be a
singleton instance. The decorated method automatically loops on records,
and makes a list with the results. In case the method is decorated with
<a class="reference internal" href="#gerp.api.returns" title="gerp.api.returns"><code class="xref py py-func docutils literal"><span class="pre">returns()</span></code></a>, it concatenates the resulting instances. Such a
method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">one</span>
<span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>may be called in both record and traditional styles, like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># recs = model.browse(cr, uid, ids, context)</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">recs</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="n">names</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<div class="deprecated">
<p><span class="versionmodified">Deprecated since version 9.0: </span><a class="reference internal" href="#gerp.api.one" title="gerp.api.one"><code class="xref py py-func docutils literal"><span class="pre">one()</span></code></a> often makes the code less clear and behaves in ways
developers and readers may not expect.</p>
<p>It is strongly recommended to use <a class="reference internal" href="#gerp.api.multi" title="gerp.api.multi"><code class="xref py py-func docutils literal"><span class="pre">multi()</span></code></a> and either
iterate on the <code class="docutils literal"><span class="pre">self</span></code> recordset or ensure that the recordset
is a single record with <a class="reference internal" href="#gerp.models.Model.ensure_one" title="gerp.models.Model.ensure_one"><code class="xref py py-meth docutils literal"><span class="pre">ensure_one()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="gerp.api.v7">
<code class="descclassname">gerp.api.</code><code class="descname">v7</code><span class="sig-paren">(</span><em>method_v7</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#v7"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.v7" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorate a method that supports the old-style api only. A new-style api
may be provided by redefining a method with the same name and decorated
with <a class="reference internal" href="#gerp.api.v8" title="gerp.api.v8"><code class="xref py py-func docutils literal"><span class="pre">v8()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">v7</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">...</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">v8</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Special care must be taken if one method calls the other one, because
the method may be overridden! In that case, one should call the method
from the current class (say <code class="docutils literal"><span class="pre">MyClass</span></code>), for instance:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">v7</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Beware: records.foo() may call an overriding of foo()</span>
    <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MyClass</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the wrapper method uses the docstring of the first method.</p>
</dd></dl>

<dl class="function">
<dt id="gerp.api.v8">
<code class="descclassname">gerp.api.</code><code class="descname">v8</code><span class="sig-paren">(</span><em>method_v8</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/api.html#v8"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.api.v8" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorate a method that supports the new-style api only. An old-style api
may be provided by redefining a method with the same name and decorated
with <a class="reference internal" href="#gerp.api.v7" title="gerp.api.v7"><code class="xref py py-func docutils literal"><span class="pre">v7()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@api</span><span class="o">.</span><span class="n">v8</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">v7</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Note that the wrapper method uses the docstring of the first method.</p>
</dd></dl>

</div>
<div class="section" id="fields">
<span id="reference-orm-fields"></span><h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-fields">
<span id="reference-orm-fields-basic"></span><h3>Basic fields<a class="headerlink" href="#basic-fields" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="gerp.fields.Field">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Field</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Field"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Field" title="Permalink to this definition">¶</a></dt>
<dd><p>The field descriptor contains the field definition, and manages accesses
and assignments of the corresponding field on records. The following
attributes may be provided when instanciating a field:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>string</strong> – the label of the field seen by users (string); if not
set, the ORM takes the field name in the class (capitalized).</li>
<li><strong>help</strong> – the tooltip of the field seen by users (string)</li>
<li><strong>readonly</strong> – whether the field is readonly (boolean, by default <code class="docutils literal"><span class="pre">False</span></code>)</li>
<li><strong>required</strong> – whether the value of the field is required (boolean, by
default <code class="docutils literal"><span class="pre">False</span></code>)</li>
<li><strong>index</strong> – whether the field is indexed in database (boolean, by
default <code class="docutils literal"><span class="pre">False</span></code>)</li>
<li><strong>default</strong> – the default value for the field; this is either a static
value, or a function taking a recordset and returning a value; use
<code class="docutils literal"><span class="pre">default=None</span></code> to discard default values for the field</li>
<li><strong>states</strong> – a dictionary mapping state values to lists of UI attribute-value
pairs; possible attributes are: ‘readonly’, ‘required’, ‘invisible’.
Note: Any state-based condition requires the <code class="docutils literal"><span class="pre">state</span></code> field value to be
available on the client-side UI. This is typically done by including it in
the relevant views, possibly made invisible if not relevant for the
end-user.</li>
<li><strong>groups</strong> – comma-separated list of group xml ids (string); this
restricts the field access to the users of the given groups only</li>
<li><strong>copy</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) – whether the field value should be copied when the record
is duplicated (default: <code class="docutils literal"><span class="pre">True</span></code> for normal fields, <code class="docutils literal"><span class="pre">False</span></code> for
<code class="docutils literal"><span class="pre">one2many</span></code> and computed fields, including property fields and
related fields)</li>
<li><strong>oldname</strong> (<a class="reference external" href="https://docs.python.org/2/library/string.html#module-string" title="(in Python v2.7)"><em>string</em></a>) – the previous name of this field, so that ORM can rename
it automatically at migration</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric" id="field-computed">Computed fields</p>
<p>One can define a field whose value is computed instead of simply being
read from the database. The attributes that are specific to computed
fields are given below. To define such a field, simply provide a value
for the attribute <code class="docutils literal"><span class="pre">compute</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>compute</strong> – name of a method that computes the field</li>
<li><strong>inverse</strong> – name of a method that inverses the field (optional)</li>
<li><strong>search</strong> – name of a method that implement search on the field (optional)</li>
<li><strong>store</strong> – whether the field is stored in database (boolean, by
default <code class="docutils literal"><span class="pre">False</span></code> on computed fields)</li>
<li><strong>compute_sudo</strong> – whether the field should be recomputed as superuser
to bypass access rights (boolean, by default <code class="docutils literal"><span class="pre">False</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The methods given for <code class="docutils literal"><span class="pre">compute</span></code>, <code class="docutils literal"><span class="pre">inverse</span></code> and <code class="docutils literal"><span class="pre">search</span></code> are model
methods. Their signature is shown in the following example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">upper</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_upper&#39;</span><span class="p">,</span>
                    <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_upper&#39;</span><span class="p">,</span>
                    <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_upper&#39;</span><span class="p">)</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_compute_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">_inverse_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">upper</span> <span class="k">else</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">_search_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;like&#39;</span><span class="p">:</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;ilike&#39;</span>
    <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span>
</pre></div>
</div>
<p>The compute method has to assign the field on all records of the invoked
recordset. The decorator <a class="reference internal" href="#gerp.api.depends" title="gerp.api.depends"><code class="xref py py-meth docutils literal"><span class="pre">gerp.api.depends()</span></code></a> must be applied on
the compute method to specify the field dependencies; those dependencies
are used to determine when to recompute the field; recomputation is
automatic and guarantees cache/database consistency. Note that the same
method can be used for several fields, you simply have to assign all the
given fields in the method; the method will be invoked once for all
those fields.</p>
<p>By default, a computed field is not stored to the database, and is
computed on-the-fly. Adding the attribute <code class="docutils literal"><span class="pre">store=True</span></code> will store the
field’s values in the database. The advantage of a stored field is that
searching on that field is done by the database itself. The disadvantage
is that it requires database updates when the field must be recomputed.</p>
<p>The inverse method, as its name says, does the inverse of the compute
method: the invoked records have a value for the field, and you must
apply the necessary changes on the field dependencies such that the
computation gives the expected value. Note that a computed field without
an inverse method is readonly by default.</p>
<p>The search method is invoked when processing domains before doing an
actual search on the model. It must return a domain equivalent to the
condition: <code class="docutils literal"><span class="pre">field</span> <span class="pre">operator</span> <span class="pre">value</span></code>.</p>
<p class="rubric" id="field-related">Related fields</p>
<p>The value of a related field is given by following a sequence of
relational fields and reading a field on the reached model. The complete
sequence of fields to traverse is specified by the attribute</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>related</strong> – sequence of field names</td>
</tr>
</tbody>
</table>
<p>Some field attributes are automatically copied from the source field if
they are not redefined: <code class="docutils literal"><span class="pre">string</span></code>, <code class="docutils literal"><span class="pre">help</span></code>, <code class="docutils literal"><span class="pre">readonly</span></code>, <code class="docutils literal"><span class="pre">required</span></code> (only
if all fields in the sequence are required), <code class="docutils literal"><span class="pre">groups</span></code>, <code class="docutils literal"><span class="pre">digits</span></code>, <code class="docutils literal"><span class="pre">size</span></code>,
<code class="docutils literal"><span class="pre">translate</span></code>, <code class="docutils literal"><span class="pre">sanitize</span></code>, <code class="docutils literal"><span class="pre">selection</span></code>, <code class="docutils literal"><span class="pre">comodel_name</span></code>, <code class="docutils literal"><span class="pre">domain</span></code>,
<code class="docutils literal"><span class="pre">context</span></code>. All semantic-free attributes are copied from the source
field.</p>
<p>By default, the values of related fields are not stored to the database.
Add the attribute <code class="docutils literal"><span class="pre">store=True</span></code> to make it stored, just like computed
fields. Related fields are automatically recomputed when their
dependencies are modified.</p>
<p class="rubric" id="field-company-dependent">Company-dependent fields</p>
<p>Formerly known as ‘property’ fields, the value of those fields depends
on the company. In other words, users that belong to different companies
may see different values for the field on a given record.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>company_dependent</strong> – whether the field is company-dependent (boolean)</td>
</tr>
</tbody>
</table>
<p class="rubric" id="field-incremental-definition">Incremental definition</p>
<p>A field is defined as class attribute on a model class. If the model
is extended (see <a class="reference internal" href="#gerp.models.Model" title="gerp.models.Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>), one can also extend
the field definition by redefining a field with the same name and same
type on the subclass. In that case, the attributes of the field are
taken from the parent class and overridden by the ones given in
subclasses.</p>
<p>For instance, the second class below only adds a tooltip on the field
<code class="docutils literal"><span class="pre">state</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">First</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span><span class="o">...</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Second</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s2">&quot;Blah blah blah&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Char">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Char</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Char"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Char" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">gerp.fields._String</span></code></p>
<p>Basic string field, can be length-limited, usually displayed as a
single-line string in clients.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>size</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) – the maximum size of values stored for that field</li>
<li><strong>translate</strong> – enable the translation of the field’s values; use
<code class="docutils literal"><span class="pre">translate=True</span></code> to translate field values as a whole; <code class="docutils literal"><span class="pre">translate</span></code>
may also be a callable such that <code class="docutils literal"><span class="pre">translate(callback,</span> <span class="pre">value)</span></code>
translates <code class="docutils literal"><span class="pre">value</span></code> by using <code class="docutils literal"><span class="pre">callback(term)</span></code> to retrieve the
translation of terms.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Boolean">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Boolean</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Boolean"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Boolean" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Integer">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Integer</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Integer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Integer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a></p>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Float">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Float</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>digits=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Float"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Float" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a></p>
<p>The precision digits are given by the attribute</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>digits</strong> – a pair (total, decimal), or a function taking a database
cursor and returning a pair (total, decimal)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Text">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Text</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Text"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Text" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">gerp.fields._String</span></code></p>
<p>Very similar to <a class="reference internal" href="#gerp.fields.Char" title="gerp.fields.Char"><code class="xref py py-class docutils literal"><span class="pre">Char</span></code></a> but used for longer contents, does not
have a size and usually displayed as a multiline text box.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>translate</strong> – enable the translation of the field’s values; use
<code class="docutils literal"><span class="pre">translate=True</span></code> to translate field values as a whole; <code class="docutils literal"><span class="pre">translate</span></code>
may also be a callable such that <code class="docutils literal"><span class="pre">translate(callback,</span> <span class="pre">value)</span></code>
translates <code class="docutils literal"><span class="pre">value</span></code> by using <code class="docutils literal"><span class="pre">callback(term)</span></code> to retrieve the
translation of terms.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Selection">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Selection</code><span class="sig-paren">(</span><em>selection=&lt;object object&gt;</em>, <em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Selection"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Selection" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>selection</strong> – specifies the possible values for this field.
It is given as either a list of pairs (<code class="docutils literal"><span class="pre">value</span></code>, <code class="docutils literal"><span class="pre">string</span></code>), or a
model method, or a method name.</li>
<li><strong>selection_add</strong> – provides an extension of the selection in the case
of an overridden field. It is a list of pairs (<code class="docutils literal"><span class="pre">value</span></code>, <code class="docutils literal"><span class="pre">string</span></code>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The attribute <code class="docutils literal"><span class="pre">selection</span></code> is mandatory except in the case of
<a class="reference internal" href="#field-related"><span class="std std-ref">related fields</span></a> or <a class="reference internal" href="#field-incremental-definition"><span class="std std-ref">field extensions</span></a>.</p>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Html">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Html</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Html"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Html" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">gerp.fields._String</span></code></p>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Date">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Date</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Date"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Date" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a></p>
<dl class="staticmethod">
<dt id="gerp.fields.Date.context_today">
<em class="property">static </em><code class="descname">context_today</code><span class="sig-paren">(</span><em>record</em>, <em>timestamp=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Date.context_today"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Date.context_today" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current date as seen in the client’s timezone in a format
fit for date fields. This method may be used to compute default
values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>timestamp</strong> (<a class="reference external" href="https://docs.python.org/2/library/datetime.html#module-datetime" title="(in Python v2.7)"><em>datetime</em></a>) – optional datetime value to use instead of
the current date and time (must be a datetime, regular dates
can’t be converted between timezones.)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)">str</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="gerp.fields.Date.from_string">
<em class="property">static </em><code class="descname">from_string</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Date.from_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Date.from_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert an ORM <code class="docutils literal"><span class="pre">value</span></code> into a <code class="xref py py-class docutils literal"><span class="pre">date</span></code> value.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="gerp.fields.Date.to_string">
<em class="property">static </em><code class="descname">to_string</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Date.to_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Date.to_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a <code class="xref py py-class docutils literal"><span class="pre">date</span></code> value into the format expected by the ORM.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="gerp.fields.Date.today">
<em class="property">static </em><code class="descname">today</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Date.today"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Date.today" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current day in the format expected by the ORM.
This function may be used to compute default values.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="gerp.fields.Datetime">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Datetime</code><span class="sig-paren">(</span><em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Datetime"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Datetime" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a></p>
<dl class="staticmethod">
<dt id="gerp.fields.Datetime.context_timestamp">
<em class="property">static </em><code class="descname">context_timestamp</code><span class="sig-paren">(</span><em>record</em>, <em>timestamp</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Datetime.context_timestamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Datetime.context_timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the given timestamp converted to the client’s timezone.
This method is <em>not</em> meant for use as a default initializer,
because datetime fields are automatically converted upon
display on client side. For default values <code class="xref py py-meth docutils literal"><span class="pre">fields.datetime.now()</span></code>
should be used instead.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>timestamp</strong> (<a class="reference external" href="https://docs.python.org/2/library/datetime.html#module-datetime" title="(in Python v2.7)"><em>datetime</em></a>) – naive datetime value (expressed in UTC)
to be converted to the client timezone</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2/library/datetime.html#module-datetime" title="(in Python v2.7)">datetime</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">timestamp converted to timezone-aware datetime in context
timezone</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="gerp.fields.Datetime.from_string">
<em class="property">static </em><code class="descname">from_string</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Datetime.from_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Datetime.from_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert an ORM <code class="docutils literal"><span class="pre">value</span></code> into a <code class="xref py py-class docutils literal"><span class="pre">datetime</span></code> value.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="gerp.fields.Datetime.now">
<em class="property">static </em><code class="descname">now</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Datetime.now"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Datetime.now" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current day and time in the format expected by the ORM.
This function may be used to compute default values.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="gerp.fields.Datetime.to_string">
<em class="property">static </em><code class="descname">to_string</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Datetime.to_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Datetime.to_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a <code class="xref py py-class docutils literal"><span class="pre">datetime</span></code> value into the format expected by the ORM.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="relational-fields">
<span id="reference-orm-fields-relational"></span><h3>Relational fields<a class="headerlink" href="#relational-fields" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="gerp.fields.Many2one">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Many2one</code><span class="sig-paren">(</span><em>comodel_name=&lt;object object&gt;</em>, <em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Many2one"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Many2one" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">gerp.fields._Relational</span></code></p>
<p>The value of such a field is a recordset of size 0 (no
record) or 1 (a single record).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>comodel_name</strong> – name of the target model (string)</li>
<li><strong>domain</strong> – an optional domain to set on candidate values on the
client side (domain or string)</li>
<li><strong>context</strong> – an optional context to use on the client side when
handling that field (dictionary)</li>
<li><strong>ondelete</strong> – what to do when the referred record is deleted;
possible values are: <code class="docutils literal"><span class="pre">'set</span> <span class="pre">null'</span></code>, <code class="docutils literal"><span class="pre">'restrict'</span></code>, <code class="docutils literal"><span class="pre">'cascade'</span></code></li>
<li><strong>auto_join</strong> – whether JOINs are generated upon search through that
field (boolean, by default <code class="docutils literal"><span class="pre">False</span></code>)</li>
<li><strong>delegate</strong> – set it to <code class="docutils literal"><span class="pre">True</span></code> to make fields of the target model
accessible from the current model (corresponds to <code class="docutils literal"><span class="pre">_inherits</span></code>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The attribute <code class="docutils literal"><span class="pre">comodel_name</span></code> is mandatory except in the case of related
fields or field extensions.</p>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.One2many">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">One2many</code><span class="sig-paren">(</span><em>comodel_name=&lt;object object&gt;</em>, <em>inverse_name=&lt;object object&gt;</em>, <em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#One2many"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.One2many" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">gerp.fields._RelationalMulti</span></code></p>
<p>One2many field; the value of such a field is the recordset of all the
records in <code class="docutils literal"><span class="pre">comodel_name</span></code> such that the field <code class="docutils literal"><span class="pre">inverse_name</span></code> is equal to
the current record.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>comodel_name</strong> – name of the target model (string)</li>
<li><strong>inverse_name</strong> – name of the inverse <code class="docutils literal"><span class="pre">Many2one</span></code> field in
<code class="docutils literal"><span class="pre">comodel_name</span></code> (string)</li>
<li><strong>domain</strong> – an optional domain to set on candidate values on the
client side (domain or string)</li>
<li><strong>context</strong> – an optional context to use on the client side when
handling that field (dictionary)</li>
<li><strong>auto_join</strong> – whether JOINs are generated upon search through that
field (boolean, by default <code class="docutils literal"><span class="pre">False</span></code>)</li>
<li><strong>limit</strong> – optional limit to use upon read (integer)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The attributes <code class="docutils literal"><span class="pre">comodel_name</span></code> and <code class="docutils literal"><span class="pre">inverse_name</span></code> are mandatory except in
the case of related fields or field extensions.</p>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Many2many">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Many2many</code><span class="sig-paren">(</span><em>comodel_name=&lt;object object&gt;</em>, <em>relation=&lt;object object&gt;</em>, <em>column1=&lt;object object&gt;</em>, <em>column2=&lt;object object&gt;</em>, <em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Many2many"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Many2many" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">gerp.fields._RelationalMulti</span></code></p>
<p>Many2many field; the value of such a field is the recordset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>comodel_name</strong> – name of the target model (string)</td>
</tr>
</tbody>
</table>
<p>The attribute <code class="docutils literal"><span class="pre">comodel_name</span></code> is mandatory except in the case of related
fields or field extensions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>relation</strong> – optional name of the table that stores the relation in
the database (string)</li>
<li><strong>column1</strong> – optional name of the column referring to “these” records
in the table <code class="docutils literal"><span class="pre">relation</span></code> (string)</li>
<li><strong>column2</strong> – optional name of the column referring to “those” records
in the table <code class="docutils literal"><span class="pre">relation</span></code> (string)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The attributes <code class="docutils literal"><span class="pre">relation</span></code>, <code class="docutils literal"><span class="pre">column1</span></code> and <code class="docutils literal"><span class="pre">column2</span></code> are optional. If not
given, names are automatically generated from model names, provided
<code class="docutils literal"><span class="pre">model_name</span></code> and <code class="docutils literal"><span class="pre">comodel_name</span></code> are different!</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>domain</strong> – an optional domain to set on candidate values on the
client side (domain or string)</li>
<li><strong>context</strong> – an optional context to use on the client side when
handling that field (dictionary)</li>
<li><strong>limit</strong> – optional limit to use upon read (integer)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="gerp.fields.Reference">
<em class="property">class </em><code class="descclassname">gerp.fields.</code><code class="descname">Reference</code><span class="sig-paren">(</span><em>selection=&lt;object object&gt;</em>, <em>string=&lt;object object&gt;</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/gerp/fields.html#Reference"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gerp.fields.Reference" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#gerp.fields.Selection" title="gerp.fields.Selection"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Selection</span></code></a></p>
</dd></dl>

</div>
</div>
<div class="section" id="inheritance-and-extension">
<span id="reference-orm-inheritance"></span><h2>Inheritance and extension<a class="headerlink" href="#inheritance-and-extension" title="Permalink to this headline">¶</a></h2>
<p>Gerp provides three different mechanisms to extend models in a modular way:</p>
<ul class="simple">
<li>creating a new model from an existing one, adding new information to the
copy but leaving the original module as-is</li>
<li>extending models defined in other modules in-place, replacing the previous
version</li>
<li>delegating some of the model’s fields to records it contains</li>
</ul>
<img alt="../_images/inheritance_methods1.png" class="align-center" src="../_images/inheritance_methods1.png" />
<div class="section" id="classical-inheritance">
<h3>Classical inheritance<a class="headerlink" href="#classical-inheritance" title="Permalink to this headline">¶</a></h3>
<p>When using the <a class="reference internal" href="#gerp.models.Model._inherit" title="gerp.models.Model._inherit"><code class="xref py py-attr docutils literal"><span class="pre">_inherit</span></code></a> and
<a class="reference internal" href="#gerp.models.Model._name" title="gerp.models.Model._name"><code class="xref py py-attr docutils literal"><span class="pre">_name</span></code></a> attributes together, Gerp creates a new
model using the existing one (provided via
<a class="reference internal" href="#gerp.models.Model._inherit" title="gerp.models.Model._inherit"><code class="xref py py-attr docutils literal"><span class="pre">_inherit</span></code></a>) as a base. The new model gets all the
fields, methods and meta-information (defaults &amp; al) from its base.</p>
<p>and using them:</p>
<p>will yield:</p>
<p>the second model has inherited from the first model’s <code class="docutils literal"><span class="pre">check</span></code> method and its
<code class="docutils literal"><span class="pre">name</span></code> field, but overridden the <code class="docutils literal"><span class="pre">call</span></code> method, as when using standard
<span class="xref std std-ref">Python inheritance</span>.</p>
</div>
<div class="section" id="extension">
<h3>Extension<a class="headerlink" href="#extension" title="Permalink to this headline">¶</a></h3>
<p>When using <a class="reference internal" href="#gerp.models.Model._inherit" title="gerp.models.Model._inherit"><code class="xref py py-attr docutils literal"><span class="pre">_inherit</span></code></a> but leaving out
<a class="reference internal" href="#gerp.models.Model._name" title="gerp.models.Model._name"><code class="xref py py-attr docutils literal"><span class="pre">_name</span></code></a>, the new model replaces the existing one,
essentially extending it in-place. This is useful to add new fields or methods
to existing models (created in other modules), or to customize or reconfigure
them (e.g. to change their default sort order):</p>
<p>will yield:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">it will also yield the various <a class="reference internal" href="#reference-orm-model-automatic"><span class="std std-ref">automatic fields</span></a> unless they’ve been disabled</p>
</div>
</div>
<div class="section" id="delegation">
<h3>Delegation<a class="headerlink" href="#delegation" title="Permalink to this headline">¶</a></h3>
<p>The third inheritance mechanism provides more flexibility (it can be altered
at runtime) but less power: using the <a class="reference internal" href="#gerp.models.Model._inherits" title="gerp.models.Model._inherits"><code class="xref py py-attr docutils literal"><span class="pre">_inherits</span></code></a>
a model <em>delegates</em> the lookup of any field not found on the current model
to “children” models. The delegation is performed via
<a class="reference internal" href="#gerp.fields.Reference" title="gerp.fields.Reference"><code class="xref py py-class docutils literal"><span class="pre">Reference</span></code></a> fields automatically set up on the parent
model:</p>
<p>will result in:</p>
<p>and it’s possible to write directly on the delegated field:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">when using delegation inheritance, methods are <em>not</em> inherited,
only fields</p>
</div>
</div>
</div>
<div class="section" id="domains">
<span id="reference-orm-domains"></span><h2>Domains<a class="headerlink" href="#domains" title="Permalink to this headline">¶</a></h2>
<p>A domain is a list of criteria, each criterion being a triple (either a
<code class="docutils literal"><span class="pre">list</span></code> or a <code class="docutils literal"><span class="pre">tuple</span></code>) of <code class="docutils literal"><span class="pre">(field_name,</span> <span class="pre">operator,</span> <span class="pre">value)</span></code> where:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">field_name</span></code> (<code class="docutils literal"><span class="pre">str</span></code>)</dt>
<dd>a field name of the current model, or a relationship traversal through
a <a class="reference internal" href="#gerp.fields.Many2one" title="gerp.fields.Many2one"><code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code></a> using dot-notation e.g. <code class="docutils literal"><span class="pre">'street'</span></code>
or <code class="docutils literal"><span class="pre">'partner_id.country'</span></code></dd>
<dt><code class="docutils literal"><span class="pre">operator</span></code> (<code class="docutils literal"><span class="pre">str</span></code>)</dt>
<dd><p class="first">an operator used to compare the <code class="docutils literal"><span class="pre">field_name</span></code> with the <code class="docutils literal"><span class="pre">value</span></code>. Valid
operators are:</p>
<dl class="last docutils">
<dt><code class="docutils literal"><span class="pre">=</span></code></dt>
<dd>equals to</dd>
<dt><code class="docutils literal"><span class="pre">!=</span></code></dt>
<dd>not equals to</dd>
<dt><code class="docutils literal"><span class="pre">&gt;</span></code></dt>
<dd>greater than</dd>
<dt><code class="docutils literal"><span class="pre">&gt;=</span></code></dt>
<dd>greater than or equal to</dd>
<dt><code class="docutils literal"><span class="pre">&lt;</span></code></dt>
<dd>less than</dd>
<dt><code class="docutils literal"><span class="pre">&lt;=</span></code></dt>
<dd>less than or equal to</dd>
<dt><code class="docutils literal"><span class="pre">=?</span></code></dt>
<dd>unset or equals to (returns true if <code class="docutils literal"><span class="pre">value</span></code> is either <code class="docutils literal"><span class="pre">None</span></code> or
<code class="docutils literal"><span class="pre">False</span></code>, otherwise behaves like <code class="docutils literal"><span class="pre">=</span></code>)</dd>
<dt><code class="docutils literal"><span class="pre">=like</span></code></dt>
<dd>matches <code class="docutils literal"><span class="pre">field_name</span></code> against the <code class="docutils literal"><span class="pre">value</span></code> pattern. An underscore
<code class="docutils literal"><span class="pre">_</span></code> in the pattern stands for (matches) any single character; a
percent sign <code class="docutils literal"><span class="pre">%</span></code> matches any string of zero or more characters.</dd>
<dt><code class="docutils literal"><span class="pre">like</span></code></dt>
<dd>matches <code class="docutils literal"><span class="pre">field_name</span></code> against the <code class="docutils literal"><span class="pre">%value%</span></code> pattern. Similar to
<code class="docutils literal"><span class="pre">=like</span></code> but wraps <code class="docutils literal"><span class="pre">value</span></code> with ‘%’ before matching</dd>
<dt><code class="docutils literal"><span class="pre">not</span> <span class="pre">like</span></code></dt>
<dd>doesn’t match against the <code class="docutils literal"><span class="pre">%value%</span></code> pattern</dd>
<dt><code class="docutils literal"><span class="pre">ilike</span></code></dt>
<dd>case insensitive <code class="docutils literal"><span class="pre">like</span></code></dd>
<dt><code class="docutils literal"><span class="pre">not</span> <span class="pre">ilike</span></code></dt>
<dd>case insensitive <code class="docutils literal"><span class="pre">not</span> <span class="pre">like</span></code></dd>
<dt><code class="docutils literal"><span class="pre">=ilike</span></code></dt>
<dd>case insensitive <code class="docutils literal"><span class="pre">=like</span></code></dd>
<dt><code class="docutils literal"><span class="pre">in</span></code></dt>
<dd>is equal to any of the items from <code class="docutils literal"><span class="pre">value</span></code>, <code class="docutils literal"><span class="pre">value</span></code> should be a
list of items</dd>
<dt><code class="docutils literal"><span class="pre">not</span> <span class="pre">in</span></code></dt>
<dd>is unequal to all of the items from <code class="docutils literal"><span class="pre">value</span></code></dd>
<dt><code class="docutils literal"><span class="pre">child_of</span></code></dt>
<dd><p class="first">is a child (descendant) of a <code class="docutils literal"><span class="pre">value</span></code> record.</p>
<p class="last">Takes the semantics of the model into account (i.e following the
relationship field named by
<code class="xref py py-attr docutils literal"><span class="pre">_parent_name</span></code>).</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal"><span class="pre">value</span></code></dt>
<dd>variable type, must be comparable (through <code class="docutils literal"><span class="pre">operator</span></code>) to the named
field</dd>
</dl>
<p>Domain criteria can be combined using logical operators in <em>prefix</em> form:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">'&amp;'</span></code></dt>
<dd>logical <em>AND</em>, default operation to combine criteria following one
another. Arity 2 (uses the next 2 criteria or combinations).</dd>
<dt><code class="docutils literal"><span class="pre">'|'</span></code></dt>
<dd>logical <em>OR</em>, arity 2.</dd>
<dt><code class="docutils literal"><span class="pre">'!'</span></code></dt>
<dd><p class="first">logical <em>NOT</em>, arity 1.</p>
<div class="aphorism last admonition tip">
<p class="first admonition-title">Tip</p>
<p>Mostly to negate combinations of criteria</p>
<p class="last">Individual criterion generally have a negative form (e.g. <code class="docutils literal"><span class="pre">=</span></code> -&gt;
<code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code> -&gt; <code class="docutils literal"><span class="pre">&gt;=</span></code>) which is simpler than negating the positive.</p>
</div>
</dd>
</dl>
<div class="admonition-example admonition">
<p class="first admonition-title">Example</p>
<p>To search for partners named <em>ABC</em>, from belgium or germany, whose language
is not english:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;ABC&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;language.code&#39;</span><span class="p">,</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span><span class="s1">&#39;en_US&#39;</span><span class="p">),</span>
 <span class="s1">&#39;|&#39;</span><span class="p">,(</span><span class="s1">&#39;country_id.code&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;be&#39;</span><span class="p">),</span>
     <span class="p">(</span><span class="s1">&#39;country_id.code&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;de&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>This domain is interpreted as:</p>
<div class="last highlight-text"><div class="highlight"><pre><span></span>    (name is &#39;ABC&#39;)
AND (language is NOT english)
AND (country is Belgium OR Germany)
</pre></div>
</div>
</div>
</div>
<div class="section" id="porting-from-the-old-api-to-the-new-api">
<h2>Porting from the old API to the new API<a class="headerlink" href="#porting-from-the-old-api-to-the-new-api" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">bare lists of ids are to be avoided in the new API, use recordsets instead</p>
</li>
<li><p class="first">methods still written in the old API should be automatically bridged by the
ORM, no need to switch to the old API, just call them as if they were a new
API method. See <a class="reference internal" href="#reference-orm-oldapi-bridging"><span class="std std-ref">Automatic bridging of old API methods</span></a> for more details.</p>
</li>
<li><p class="first"><a class="reference internal" href="#gerp.models.Model.search" title="gerp.models.Model.search"><code class="xref py py-meth docutils literal"><span class="pre">search()</span></code></a> returns a recordset, no point in e.g.
browsing its result</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">fields.related</span></code> and <code class="docutils literal"><span class="pre">fields.function</span></code> are replaced by using a normal
field type with either a <code class="docutils literal"><span class="pre">related=</span></code> or a <code class="docutils literal"><span class="pre">compute=</span></code> parameter</p>
</li>
<li><p class="first"><a class="reference internal" href="#gerp.api.depends" title="gerp.api.depends"><code class="xref py py-func docutils literal"><span class="pre">depends()</span></code></a> on <code class="docutils literal"><span class="pre">compute=</span></code> methods <strong>must be complete</strong>,
it must list <strong>all</strong> the fields and sub-fields which the compute method
uses. It is better to have too many dependencies (will recompute the field
in cases where that is not needed) than not enough (will forget to recompute
the field and then values will be incorrect)</p>
</li>
<li><p class="first"><strong>remove</strong> all <code class="docutils literal"><span class="pre">onchange</span></code> methods on computed fields. Computed fields are
automatically re-computed when one of their dependencies is changed, and
that is used to auto-generate <code class="docutils literal"><span class="pre">onchange</span></code> by the client</p>
</li>
<li><p class="first">the decorators <a class="reference internal" href="#gerp.api.model" title="gerp.api.model"><code class="xref py py-func docutils literal"><span class="pre">model()</span></code></a> and <a class="reference internal" href="#gerp.api.multi" title="gerp.api.multi"><code class="xref py py-func docutils literal"><span class="pre">multi()</span></code></a> are
for bridging <em>when calling from the old API context</em>, for internal or pure
new-api (e.g. compute) they are useless</p>
</li>
<li><p class="first">remove <code class="xref py py-attr docutils literal"><span class="pre">_default</span></code>, replace by <code class="docutils literal"><span class="pre">default=</span></code>
parameter on corresponding fields</p>
</li>
<li><p class="first">if a field’s <code class="docutils literal"><span class="pre">string=</span></code> is the titlecased version of the field name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>it is useless and should be removed</p>
</li>
<li><p class="first">the <code class="docutils literal"><span class="pre">multi=</span></code> parameter does not do anything on new API fields use the same
<code class="docutils literal"><span class="pre">compute=</span></code> methods on all relevant fields for the same result</p>
</li>
<li><p class="first">provide <code class="docutils literal"><span class="pre">compute=</span></code>, <code class="docutils literal"><span class="pre">inverse=</span></code> and <code class="docutils literal"><span class="pre">search=</span></code> methods by name (as a
string), this makes them overridable (removes the need for an intermediate
“trampoline” function)</p>
</li>
<li><p class="first">double check that all fields and methods have different names, there is no
warning in case of collision (because Python handles it before Gerp sees
anything)</p>
</li>
<li><p class="first">the normal new-api import is <code class="docutils literal"><span class="pre">from</span> <span class="pre">gerp</span> <span class="pre">import</span> <span class="pre">fields,</span> <span class="pre">models</span></code>. If
compatibility decorators are necessary, use <code class="docutils literal"><span class="pre">from</span> <span class="pre">gerp</span> <span class="pre">import</span> <span class="pre">api,</span>
<span class="pre">fields,</span> <span class="pre">models</span></code></p>
</li>
<li><p class="first">avoid the <a class="reference internal" href="#gerp.api.one" title="gerp.api.one"><code class="xref py py-func docutils literal"><span class="pre">one()</span></code></a> decorator, it probably does not do what
you expect</p>
</li>
<li><p class="first">remove explicit definition of <a class="reference internal" href="#gerp.models.Model.create_uid" title="gerp.models.Model.create_uid"><code class="xref py py-attr docutils literal"><span class="pre">create_uid</span></code></a>,
<a class="reference internal" href="#gerp.models.Model.create_date" title="gerp.models.Model.create_date"><code class="xref py py-attr docutils literal"><span class="pre">create_date</span></code></a>,
<a class="reference internal" href="#gerp.models.Model.write_uid" title="gerp.models.Model.write_uid"><code class="xref py py-attr docutils literal"><span class="pre">write_uid</span></code></a> and
<a class="reference internal" href="#gerp.models.Model.write_date" title="gerp.models.Model.write_date"><code class="xref py py-attr docutils literal"><span class="pre">write_date</span></code></a> fields: they are now created as
regular “legitimate” fields, and can be read and written like any other
field out-of-the-box</p>
</li>
<li><p class="first">when straight conversion is impossible (semantics can not be bridged) or the
“old API” version is not desirable and could be improved for the new API, it
is possible to use completely different “old API” and “new API”
implementations for the same method name using <a class="reference internal" href="#gerp.api.v7" title="gerp.api.v7"><code class="xref py py-func docutils literal"><span class="pre">v7()</span></code></a> and
<a class="reference internal" href="#gerp.api.v8" title="gerp.api.v8"><code class="xref py py-func docutils literal"><span class="pre">v8()</span></code></a>. The method should first be defined using the
old-API style and decorated with <a class="reference internal" href="#gerp.api.v7" title="gerp.api.v7"><code class="xref py py-func docutils literal"><span class="pre">v7()</span></code></a>, it should then be
re-defined using the exact same name but the new-API style and decorated
with <a class="reference internal" href="#gerp.api.v8" title="gerp.api.v8"><code class="xref py py-func docutils literal"><span class="pre">v8()</span></code></a>. Calls from an old-API context will be
dispatched to the first implementation and calls from a new-API context will
be dispatched to the second implementation. One implementation can call (and
frequently does) call the other by switching context.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">using these decorators makes methods extremely difficult to
override and harder to understand and document</p>
</div>
</li>
<li><p class="first">uses of <code class="xref py py-attr docutils literal"><span class="pre">_columns</span></code> or
<code class="xref py py-attr docutils literal"><span class="pre">_all_columns</span></code> should be replaced by
<code class="xref py py-attr docutils literal"><span class="pre">_fields</span></code>, which provides access to instances of
new-style <a class="reference internal" href="#gerp.fields.Field" title="gerp.fields.Field"><code class="xref py py-class docutils literal"><span class="pre">gerp.fields.Field</span></code></a> instances (rather than old-style
<code class="xref py py-class docutils literal"><span class="pre">gerp.osv.fields._column</span></code>).</p>
<p>Non-stored computed fields created using the new API style are <em>not</em>
available in <code class="xref py py-attr docutils literal"><span class="pre">_columns</span></code> and can only be
inspected through <code class="xref py py-attr docutils literal"><span class="pre">_fields</span></code></p>
</li>
<li><p class="first">reassigning <code class="docutils literal"><span class="pre">self</span></code> in a method is probably unnecessary and may break
translation introspection</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal"><span class="pre">Environment</span></code> objects rely on some threadlocal state,
which has to be set up before using them. It is necessary to do so using the
<code class="xref py py-meth docutils literal"><span class="pre">gerp.api.Environment.manage()</span></code> context manager when trying to use
the new API in contexts where it hasn’t been set up yet, such as new threads
or a Python interactive environment:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">gerp</span> <span class="k">import</span> <span class="n">api</span><span class="p">,</span> <span class="n">modules</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">RegistryManager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cr</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">AttributeError</span>: <span class="n">environments</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">api</span><span class="o">.</span><span class="n">Environment</span><span class="o">.</span><span class="n">manage</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">env</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">res.partner(1,)</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="automatic-bridging-of-old-api-methods">
<span id="reference-orm-oldapi-bridging"></span><h3>Automatic bridging of old API methods<a class="headerlink" href="#automatic-bridging-of-old-api-methods" title="Permalink to this headline">¶</a></h3>
<p>When models are initialized, all methods are automatically scanned and bridged
if they look like models declared in the old API style. This bridging makes
them transparently callable from new-API-style methods.</p>
<p>Methods are matched as “old-API style” if their second positional parameter
(after <code class="docutils literal"><span class="pre">self</span></code>) is called either <code class="docutils literal"><span class="pre">cr</span></code> or <code class="docutils literal"><span class="pre">cursor</span></code>. The system also
recognizes the third positional parameter being called <code class="docutils literal"><span class="pre">uid</span></code> or <code class="docutils literal"><span class="pre">user</span></code> and
the fourth being called <code class="docutils literal"><span class="pre">id</span></code> or <code class="docutils literal"><span class="pre">ids</span></code>. It also recognizes the presence of
any parameter called <code class="docutils literal"><span class="pre">context</span></code>.</p>
<p>When calling such methods from a new API context, the system will
automatically fill matched parameters from the current
<code class="xref py py-class docutils literal"><span class="pre">Environment</span></code> (for <code class="xref py py-attr docutils literal"><span class="pre">cr</span></code>,
<code class="xref py py-attr docutils literal"><span class="pre">user</span></code> and
<code class="xref py py-attr docutils literal"><span class="pre">context</span></code>) or the current recordset (for <code class="docutils literal"><span class="pre">id</span></code>
and <code class="docutils literal"><span class="pre">ids</span></code>).</p>
<p>In the rare cases where it is necessary, the bridging can be customized by
decorating the old-style method:</p>
<ul>
<li><p class="first">disabling it entirely, by decorating a method with
<code class="xref py py-func docutils literal"><span class="pre">noguess()</span></code> there will be no bridging and methods will be
called the exact same way from the new and old API styles</p>
</li>
<li><p class="first">defining the bridge explicitly, this is mostly for methods which are matched
incorrectly (because parameters are named in unexpected ways):</p>
<dl class="docutils">
<dt><code class="xref py py-func docutils literal"><span class="pre">cr()</span></code></dt>
<dd><p class="first last">will automatically prepend the current cursor to explicitly provided
parameters, positionally</p>
</dd>
<dt><code class="xref py py-func docutils literal"><span class="pre">cr_uid()</span></code></dt>
<dd><p class="first last">will automatically prepend the current cursor and user’s id to explictly
provided parameters</p>
</dd>
<dt><code class="xref py py-func docutils literal"><span class="pre">cr_uid_ids()</span></code></dt>
<dd><p class="first last">will automatically prepend the current cursor, user’s id and recordset’s
ids to explicitly provided parameters</p>
</dd>
<dt><code class="xref py py-func docutils literal"><span class="pre">cr_uid_id()</span></code></dt>
<dd><p class="first">will loop over the current recordset and call the method once for each
record, prepending the current cursor, user’s id and record’s id to
explicitly provided parameters.</p>
<div class="last admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">the result of this wrapper is <em>always a list</em> when calling
from a new-API context</p>
</div>
</dd>
</dl>
<p>All of these methods have a <code class="docutils literal"><span class="pre">_context</span></code>-suffixed version
(e.g. <code class="xref py py-func docutils literal"><span class="pre">cr_uid_context()</span></code>) which also passes the current
context <em>by keyword</em>.</p>
</li>
<li><p class="first">dual implementations using <a class="reference internal" href="#gerp.api.v7" title="gerp.api.v7"><code class="xref py py-func docutils literal"><span class="pre">v7()</span></code></a> and
<a class="reference internal" href="#gerp.api.v8" title="gerp.api.v8"><code class="xref py py-func docutils literal"><span class="pre">v8()</span></code></a> will be ignored as they provide their own “bridging”</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../reference.html">Reference</a><ul>
      <li>Previous: <a href="../reference.html" title="previous chapter">Reference</a></li>
      <li>Next: <a href="data.html" title="next chapter">Data Files</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Gahan Corporation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/reference/orm.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>