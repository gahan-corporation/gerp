
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Odoo Guidelines &#8212; gerp 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mobile JavaScript" href="mobile.html" />
    <link rel="prev" title="Mixins and Useful Classes" href="mixins.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="odoo-guidelines">
<h1>Odoo Guidelines<a class="headerlink" href="#odoo-guidelines" title="Permalink to this headline">¶</a></h1>
<p>This page introduces the new Odoo Coding Guidelines. Those aim to improve the quality of the code (e.g. better readability of source) and Odoo Apps. Indeed, proper code eases maintenance, aids debugging, lowers complexity and promotes reliability.</p>
<p>These guidelines should be applied to every new module, and new developpment. These guidelines will be applied to old module <strong>only</strong> in case of code refactoring (migration to new API, big refactoring, …).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">These guidelines are written with new modules and new files in mind. When
modifying existing files, the original style of the file strictly supersedes
any other style guidelines. In other words, never modify existing files in
order to apply these guidelines, to avoid disrupting the revision history of
each line. For more details, see our <a class="reference external" href="https://odoo.com/submit-pr">pull request guide</a>.</p>
</div>
<div class="section" id="module-structure">
<h2>Module structure<a class="headerlink" href="#module-structure" title="Permalink to this headline">¶</a></h2>
<div class="section" id="directories">
<h3>Directories<a class="headerlink" href="#directories" title="Permalink to this headline">¶</a></h3>
<p>A module is organised in important directories. Those contain the business logic; having a look at them should make understand the purpose of the module.</p>
<ul class="simple">
<li><em>data/</em> : demo and data xml</li>
<li><em>models/</em> : models definition</li>
<li><em>controllers/</em> : contains controllers (HTTP routes).</li>
<li><em>views/</em> : contains the views and templates</li>
<li><em>static/</em> : contains the web assets, separated into <em>css/, js/, img/, lib/, …</em></li>
</ul>
<p>Other optional directories compose the module.</p>
<ul class="simple">
<li><em>wizard/</em> : regroups the transient models (formerly <em>osv_memory</em>) and their views.</li>
<li><em>report/</em> : contains the reports (RML report <strong>[deprecated]</strong>, models based on SQL views (for reporting) and other complex reports). Python objects and XML views are included in this directory.</li>
<li><em>tests/</em> : contains the Python/YML tests</li>
</ul>
</div>
<div class="section" id="file-naming">
<h3>File naming<a class="headerlink" href="#file-naming" title="Permalink to this headline">¶</a></h3>
<p>For <em>views</em> declarations, split backend views from (frontend)
templates in 2 differents files.</p>
<p>For <em>models</em>, split the business logic by sets of models, in each set
select a main model, this model gives its name to the set. If there is
only one model, its name is the same as the module name. For
each set named &lt;main_model&gt; the following files may be created:</p>
<ul class="simple">
<li><code class="file docutils literal"><span class="pre">models/</span><em><span class="pre">&lt;main_model&gt;</span></em><span class="pre">.py</span></code></li>
<li><code class="file docutils literal"><span class="pre">models/</span><em><span class="pre">&lt;inherited_main_model&gt;</span></em><span class="pre">.py</span></code></li>
<li><code class="file docutils literal"><span class="pre">views/</span><em><span class="pre">&lt;main_model&gt;</span></em><span class="pre">_templates.xml</span></code></li>
<li><code class="file docutils literal"><span class="pre">views/</span><em><span class="pre">&lt;main_model&gt;</span></em><span class="pre">_views.xml</span></code></li>
</ul>
<p>For instance, <em>sale</em> module introduces <code class="docutils literal"><span class="pre">sale_order</span></code> and
<code class="docutils literal"><span class="pre">sale_order_line</span></code> where <code class="docutils literal"><span class="pre">sale_order</span></code> is dominant. So the
<code class="docutils literal"><span class="pre">&lt;main_model&gt;</span></code> files will be named <code class="file docutils literal"><span class="pre">models/sale_order.py</span></code> and
<code class="file docutils literal"><span class="pre">views/sale_order_views.py</span></code>.</p>
<p>For <em>data</em>, split them by purpose : demo or data. The filename will be
the main_model name, suffixed by <em>_demo.xml</em> or <em>_data.xml</em>.</p>
<p>For <em>controllers</em>, the only file should be named <em>main.py</em>. Otherwise, if you need to inherit an existing controller from another module, its name will be <em>&lt;module_name&gt;.py</em>. Unlike <em>models</em>, each controller class should be contained in a separated file.</p>
<p>For <em>static files</em>, since the resources can be used in different contexts (frontend, backend, both), they will be included in only one bundle. So, CSS/Less, JavaScript and XML files should be suffixed with the name of the bundle type. i.e.: <em>im_chat_common.css</em>, <em>im_chat_common.js</em> for ‘assets_common’ bundle, and <em>im_chat_backend.css</em>, <em>im_chat_backend.js</em> for ‘assets_backend’ bundle.
If the module owns only one file, the convention will be <em>&lt;module_name&gt;.ext</em> (i.e.: <em>project.js</em>).
Don’t link data (image, libraries) outside Odoo: do not use an
URL to an image but copy it in our codebase instead.</p>
<p>Regarding <em>data</em>, split them by purpose: data or demo. The filename will be
the <em>main_model</em> name, suffixed by <em>_data.xml</em> or <em>_demo.xml</em>.</p>
<p>Regarding <em>wizards</em>, naming convention is :</p>
<ul class="simple">
<li><code class="file docutils literal"><em><span class="pre">&lt;main_transient&gt;</span></em><span class="pre">.py</span></code></li>
<li><code class="file docutils literal"><em><span class="pre">&lt;main_transient&gt;</span></em><span class="pre">_views.xml</span></code></li>
</ul>
<p>Where <em>&lt;main_transient&gt;</em> is the name of the dominant transient model, just like for <em>models</em>. &lt;main_transient&gt;.py can contains the models ‘model.action’ and ‘model.action.line’.</p>
<p>For <em>statistics reports</em>, their names should look like :</p>
<ul class="simple">
<li><code class="file docutils literal"><em><span class="pre">&lt;report_name_A&gt;</span></em><span class="pre">_report.py</span></code></li>
<li><code class="file docutils literal"><em><span class="pre">&lt;report_name_A&gt;</span></em><span class="pre">_report_views.py</span></code> (often pivot and graph views)</li>
</ul>
<p>For <em>printable reports</em>, you should have :</p>
<ul class="simple">
<li><code class="file docutils literal"><em><span class="pre">&lt;print_report_name&gt;</span></em><span class="pre">_reports.py</span></code> (report actions, paperformat definition, …)</li>
<li><code class="file docutils literal"><em><span class="pre">&lt;print_report_name&gt;</span></em><span class="pre">_templates.xml</span></code> (xml report templates)</li>
</ul>
<p>The complete tree should look like</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>addons/&lt;my_module_name&gt;/
|-- __init__.py
|-- __manifest__.py
|-- controllers/
|   |-- __init__.py
|   |-- &lt;inherited_module_name&gt;.py
|   `-- main.py
|-- data/
|   |-- &lt;main_model&gt;_data.xml
|   `-- &lt;inherited_main_model&gt;_demo.xml
|-- models/
|   |-- __init__.py
|   |-- &lt;main_model&gt;.py
|   `-- &lt;inherited_main_model&gt;.py
|-- report/
|   |-- __init__.py
|   |-- &lt;main_stat_report_model&gt;.py
|   |-- &lt;main_stat_report_model&gt;_views.xml
|   |-- &lt;main_print_report&gt;_reports.xml
|   `-- &lt;main_print_report&gt;_templates.xml
|-- security/
|   |-- ir.model.access.csv
|   `-- &lt;main_model&gt;_security.xml
|-- static/
|   |-- img/
|   |   |-- my_little_kitten.png
|   |   `-- troll.jpg
|   |-- lib/
|   |   `-- external_lib/
|   `-- src/
|       |-- js/
|       |   `-- &lt;my_module_name&gt;.js
|       |-- css/
|       |   `-- &lt;my_module_name&gt;.css
|       |-- less/
|       |   `-- &lt;my_module_name&gt;.less
|       `-- xml/
|           `-- &lt;my_module_name&gt;.xml
|-- views/
|   |-- &lt;main_model&gt;_templates.xml
|   |-- &lt;main_model&gt;_views.xml
|   |-- &lt;inherited_main_model&gt;_templates.xml
|   `-- &lt;inherited_main_model&gt;_views.xml
`-- wizard/
    |-- &lt;main_transient_A&gt;.py
    |-- &lt;main_transient_A&gt;_views.xml
    |-- &lt;main_transient_B&gt;.py
    `-- &lt;main_transient_B&gt;_views.xml
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">File names should only contain <code class="docutils literal"><span class="pre">[a-z0-9_]</span></code> (lowercase
alphanumerics and <code class="docutils literal"><span class="pre">_</span></code>)</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Use correct file permissions : folder 755 and file 644.</p>
</div>
</div>
</div>
<div class="section" id="xml-files">
<h2>XML files<a class="headerlink" href="#xml-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="format">
<h3>Format<a class="headerlink" href="#format" title="Permalink to this headline">¶</a></h3>
<p>To declare a record in XML, the <strong>record</strong> notation (using <em>&lt;record&gt;</em>) is recommended:</p>
<ul class="simple">
<li>Place <code class="docutils literal"><span class="pre">id</span></code> attribute before <code class="docutils literal"><span class="pre">model</span></code></li>
<li>For field declaration, <code class="docutils literal"><span class="pre">name</span></code> attribute is first. Then place the
<em>value</em> either in the <code class="docutils literal"><span class="pre">field</span></code> tag, either in the <code class="docutils literal"><span class="pre">eval</span></code>
attribute, and finally other attributes (widget, options, …)
ordered by importance.</li>
<li>Try to group the record by model. In case of dependencies between
action/menu/views, this convention may not be applicable.</li>
<li>Use naming convention defined at the next point</li>
<li>The tag <em>&lt;data&gt;</em> is only used to set not-updatable data with <code class="docutils literal"><span class="pre">noupdate=1</span></code>.
If there is only not-updatable data in the file, the <code class="docutils literal"><span class="pre">noupdate=1</span></code> can be
set on the <code class="docutils literal"><span class="pre">&lt;odoo&gt;</span></code> tag and do not set a <code class="docutils literal"><span class="pre">&lt;data&gt;</span></code> tag.</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;view_id&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;priority&quot;</span> <span class="na">eval=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tree&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;my_field_1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;my_field_2&quot;</span> <span class="na">string=</span><span class="s">&quot;My Label&quot;</span> <span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span> <span class="na">statusbar_visible=</span><span class="s">&quot;draft,sent,progress,done&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/tree&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p>Odoo supports custom tags acting as syntactic sugar:</p>
<ul class="simple">
<li>menuitem: use it as a shortcut to declare a <code class="docutils literal"><span class="pre">ir.ui.menu</span></code></li>
<li>template: use it to declare a QWeb View requiring only the <code class="docutils literal"><span class="pre">arch</span></code> section of the view.</li>
<li>report: use to declare a <a class="reference internal" href="actions.html#reference-actions-report"><span class="std std-ref">report action</span></a></li>
<li>act_window: use it if the record notation can’t do what you want</li>
</ul>
<p>The 4 first tags are prefered over the <em>record</em> notation.</p>
</div>
<div class="section" id="naming-xml-id">
<h3>Naming xml_id<a class="headerlink" href="#naming-xml-id" title="Permalink to this headline">¶</a></h3>
<div class="section" id="security-view-and-action">
<h4>Security, View and Action<a class="headerlink" href="#security-view-and-action" title="Permalink to this headline">¶</a></h4>
<p>Use the following pattern :</p>
<ul class="simple">
<li>For a menu: <code class="samp docutils literal"><em><span class="pre">&lt;model_name&gt;</span></em><span class="pre">_menu</span></code></li>
<li>For a view: <code class="samp docutils literal"><em><span class="pre">&lt;model_name&gt;</span></em><span class="pre">_view_</span><em><span class="pre">&lt;view_type&gt;</span></em></code>, where <em>view_type</em> is
<code class="docutils literal"><span class="pre">kanban</span></code>, <code class="docutils literal"><span class="pre">form</span></code>, <code class="docutils literal"><span class="pre">tree</span></code>, <code class="docutils literal"><span class="pre">search</span></code>, …</li>
<li>For an action: the main action respects <code class="samp docutils literal"><em><span class="pre">&lt;model_name&gt;</span></em><span class="pre">_action</span></code>.
Others are suffixed with <code class="samp docutils literal"><span class="pre">_</span><em><span class="pre">&lt;detail&gt;</span></em></code>, where <em>detail</em> is a
lowercase string briefly explaining the action.
This is used only if multiple actions are declared for the
model.</li>
<li>For a group: <code class="samp docutils literal"><em><span class="pre">&lt;model_name&gt;</span></em><span class="pre">_group_</span><em><span class="pre">&lt;group_name&gt;</span></em></code> where <em>group_name</em>
is the name of the group, generally ‘user’, ‘manager’, …</li>
<li>For a rule: <code class="samp docutils literal"><em><span class="pre">&lt;model_name&gt;</span></em><span class="pre">_rule_</span><em><span class="pre">&lt;concerned_group&gt;</span></em></code> where
<em>concerned_group</em> is the short name of the concerned group (‘user’
for the ‘model_name_group_user’, ‘public’ for public user, ‘company’
for multi-company rules, …).</li>
<li>For a group : <code class="samp docutils literal"><em><span class="pre">&lt;model_name&gt;</span></em><span class="pre">_group_</span><em><span class="pre">&lt;group_name&gt;</span></em></code> where <em>group_name</em> is the name of the group, generally ‘user’, ‘manager’, …</li>
</ul>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- views and menus --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_view_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_view_kanban&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;menuitem</span>
    <span class="na">id=</span><span class="s">&quot;model_name_menu_root&quot;</span>
    <span class="na">name=</span><span class="s">&quot;Main Menu&quot;</span>
    <span class="na">sequence=</span><span class="s">&quot;5&quot;</span>
<span class="nt">/&gt;</span>
<span class="nt">&lt;menuitem</span>
    <span class="na">id=</span><span class="s">&quot;model_name_menu_action&quot;</span>
    <span class="na">name=</span><span class="s">&quot;Sub Menu 1&quot;</span>
    <span class="na">parent=</span><span class="s">&quot;module_name.module_name_menu_root&quot;</span>
    <span class="na">action=</span><span class="s">&quot;model_name_action&quot;</span>
    <span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
<span class="nt">/&gt;</span>

<span class="c">&lt;!-- actions --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_action&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_action_child_list&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="c">&lt;!-- security --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;module_name_group_user&quot;</span> <span class="na">model=</span><span class="s">&quot;res.groups&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_rule_public&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_rule_company&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">View names use dot notation <code class="docutils literal"><span class="pre">my.model.view_type</span></code> or
<code class="docutils literal"><span class="pre">my.model.view_type.inherit</span></code> instead of <em>“This is the form view of
My Model”</em>.</p>
</div>
</div>
<div class="section" id="inherited-xml">
<h4>Inherited XML<a class="headerlink" href="#inherited-xml" title="Permalink to this headline">¶</a></h4>
<p>The naming pattern of inherited view is
<code class="samp docutils literal"><em><span class="pre">&lt;base_view&gt;</span></em><span class="pre">_inherit_</span><em><span class="pre">&lt;current_module_name&gt;</span></em></code>. A module may only
extend a view once.  Suffix the orginal name with
<code class="samp docutils literal"><span class="pre">_inherit_</span><em><span class="pre">&lt;current_module_name&gt;</span></em></code> where <em>current_module_name</em> is the
technical name of the module extending the view.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;inherited_model_view_form_inherit_my_module&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pep8-options">
<h3>PEP8 options<a class="headerlink" href="#pep8-options" title="Permalink to this headline">¶</a></h3>
<p>Using a linter can help show syntax and semantic warnings or errors. Odoo
source code tries to respect Python standard, but some of them can be ignored.</p>
<ul class="simple">
<li>E501: line too long</li>
<li>E301: expected 1 blank line, found 0</li>
<li>E302: expected 2 blank lines, found 1</li>
<li>E126: continuation line over-indented for hanging indent</li>
<li>E123: closing bracket does not match indentation of opening bracket’s line</li>
<li>E127: continuation line over-indented for visual indent</li>
<li>E128: continuation line under-indented for visual indent</li>
<li>E265: block comment should start with ‘# ‘</li>
</ul>
</div>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<p>The imports are ordered as</p>
<ol class="arabic simple">
<li>External libraries (one per line sorted and split in python stdlib)</li>
<li>Imports of <code class="docutils literal"><span class="pre">odoo</span></code></li>
<li>Imports from Odoo modules (rarely, and only if necessary)</li>
</ol>
<p>Inside these 3 groups, the imported lines are alphabetically sorted.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 1 : imports of python lib</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c1"># 2 :  imports of odoo</span>
<span class="kn">import</span> <span class="nn">odoo</span>
<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">api</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">models</span> <span class="c1"># alphabetically ordered</span>
<span class="kn">from</span> <span class="nn">odoo.tools.safe_eval</span> <span class="kn">import</span> <span class="n">safe_eval</span> <span class="k">as</span> <span class="nb">eval</span>
<span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">_</span>
<span class="c1"># 3 :  imports from odoo modules</span>
<span class="kn">from</span> <span class="nn">odoo.addons.website.models.website</span> <span class="kn">import</span> <span class="n">slug</span>
<span class="kn">from</span> <span class="nn">odoo.addons.web.controllers.main</span> <span class="kn">import</span> <span class="n">login_redirect</span>
</pre></div>
</div>
</div>
<div class="section" id="idiomatics-python-programming">
<h3>Idiomatics Python Programming<a class="headerlink" href="#idiomatics-python-programming" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Each python file should have <code class="docutils literal"><span class="pre">#</span> <span class="pre">-*-</span> <span class="pre">coding:</span> <span class="pre">utf-8</span> <span class="pre">-*-</span></code> as first line.</li>
<li>Always favor <em>readability</em> over <em>conciseness</em> or using the language features or idioms.</li>
<li>Don’t use <code class="docutils literal"><span class="pre">.clone()</span></code></li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># bad</span>
<span class="n">new_dict</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="n">old_list</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="c1"># good</span>
<span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">old_list</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Python dictionary : creation and update</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -- creation empty dict</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_dict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># -- creation with values</span>
<span class="c1"># bad</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># good</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>

<span class="c1"># -- update dict</span>
<span class="c1"># bad</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># good</span>
<span class="n">my_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">my_dict2</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Use meaningful variable/class/method names</li>
<li>Useless variable : Temporary variables can make the code clearer by giving
names to objects, but that doesn’t mean you should create temporary variables
all the time:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># pointless</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema</span><span class="p">}</span>
<span class="c1"># simpler</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<ul class="simple">
<li>Multiple return points are OK, when they’re simpler</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># a bit complex and with a redundant temp variable</span>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axes</span>

 <span class="c1"># clearer</span>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="c1"># clone the axis</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="c1"># single-element list</span>
</pre></div>
</div>
<ul class="simple">
<li>Know your builtins : You should at least have a basic understanding of all
the Python builtins (<a class="reference external" href="http://docs.python.org/library/functions.html">http://docs.python.org/library/functions.html</a>)</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="c1"># very very redundant</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span> <span class="c1"># good</span>
</pre></div>
</div>
<p>Also, <code class="docutils literal"><span class="pre">if</span> <span class="pre">'key'</span> <span class="pre">in</span> <span class="pre">my_dict</span></code> and <code class="docutils literal"><span class="pre">if</span> <span class="pre">my_dict.get('key')</span></code> have very different
meaning, be sure that you’re using the right one.</p>
<ul class="simple">
<li>Learn list comprehensions : Use list comprehension, dict comprehension, and
basic manipulation using <code class="docutils literal"><span class="pre">map</span></code>, <code class="docutils literal"><span class="pre">filter</span></code>, <code class="docutils literal"><span class="pre">sum</span></code>, … They make the code
easier to read.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># not very good</span>
<span class="n">cube</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
<span class="c1"># better</span>
<span class="n">cube</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>Collections are booleans too : In python, many objects have “boolean-ish” value
when evaluated in a boolean context (such as an if). Among these are collections
(lists, dicts, sets, …) which are “falsy” when empty and “truthy” when containing
items:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">bool</span><span class="p">([])</span> <span class="ow">is</span> <span class="bp">False</span>
<span class="nb">bool</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">True</span>
<span class="nb">bool</span><span class="p">([</span><span class="bp">False</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">True</span>
</pre></div>
</div>
<p>So, you can write <code class="docutils literal"><span class="pre">if</span> <span class="pre">some_collection:</span></code> instead of <code class="docutils literal"><span class="pre">if</span> <span class="pre">len(some_collection):</span></code>.</p>
<ul class="simple">
<li>Iterate on iterables</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># creates a temporary list and looks bar</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># better</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="p">:</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># accessing the key,value pair</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Use dict.setdefault</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># longer.. harder to read</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">values</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_value</span><span class="p">)</span>

<span class="c1"># better.. use dict.setdefault method</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="n">values</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_value</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>As a good developper, document your code (docstring on methods, simple
comments for tricky part of code)</li>
<li>In additions to these guidelines, you may also find the following link
interesting: <a class="reference external" href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html">http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html</a>
(a little bit outdated, but quite relevant)</li>
</ul>
</div>
<div class="section" id="programming-in-odoo">
<h3>Programming in Odoo<a class="headerlink" href="#programming-in-odoo" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid to create generators and decorators: only use the ones provided by
the Odoo API.</li>
<li>As in python, use <code class="docutils literal"><span class="pre">filtered</span></code>, <code class="docutils literal"><span class="pre">mapped</span></code>, <code class="docutils literal"><span class="pre">sorted</span></code>, … methods to
ease code reading and performance.</li>
</ul>
<div class="section" id="make-your-method-works-in-batch">
<h4>Make your method works in batch<a class="headerlink" href="#make-your-method-works-in-batch" title="Permalink to this headline">¶</a></h4>
<p>When adding a function, make sure it can process multiple records. Typically,
such method is decorated with <code class="docutils literal"><span class="pre">api.multi</span></code> decorator (or takes a list of <em>id</em>,
if written in old api). Then you will have to iterate on <code class="docutils literal"><span class="pre">self</span></code> to treat each
record.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.multi</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">do_cool_stuff</span><span class="p">()</span>
</pre></div>
</div>
<p>Avoid to use <code class="docutils literal"><span class="pre">api.one</span></code>  decorator : this will probably not do what you expected,
and extending a such method is not as easy than a <em>api.multi</em> method, since it
returns a list of result (ordered by recordset ids).</p>
<p>For performance issue, when developping a ‘stat button’ (for instance), do not
perform a <code class="docutils literal"><span class="pre">search</span></code> or a <code class="docutils literal"><span class="pre">search_count</span></code> in a loop in a <code class="docutils literal"><span class="pre">api.multi</span></code> method. It
is recommended to use <code class="docutils literal"><span class="pre">read_group</span></code> method, to compute all value in only one request.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.multi</span>
<span class="k">def</span> <span class="nf">_compute_equipment_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot; Count the number of equipement per category &quot;&quot;&quot;</span>
    <span class="n">equipment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;hr.equipment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read_group</span><span class="p">([(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)],</span> <span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">])</span>
    <span class="n">mapped_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;category_id_count&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">equipment_data</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">category</span><span class="o">.</span><span class="n">equipment_count</span> <span class="o">=</span> <span class="n">mapped_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="propagate-the-context">
<h4>Propagate the context<a class="headerlink" href="#propagate-the-context" title="Permalink to this headline">¶</a></h4>
<p>In new API, the context is a <code class="docutils literal"><span class="pre">frozendict</span></code> that cannot be modified. To call
a method with a different context, the <code class="docutils literal"><span class="pre">with_context</span></code> method should be used :</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">new_context</span><span class="p">)</span><span class="o">.</span><span class="n">do_stuff</span><span class="p">()</span> <span class="c1"># all the context is replaced</span>
<span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="o">**</span><span class="n">additionnal_context</span><span class="p">)</span><span class="o">.</span><span class="n">do_other_stuff</span><span class="p">()</span> <span class="c1"># additionnal_context values override native context ones</span>
</pre></div>
</div>
<p>Passing parameter in context can have dangerous side-effects. Since the values
are propagated automatically, some behavior can appears. Calling <code class="docutils literal"><span class="pre">create()</span></code>
method of a model with <em>default_my_field</em> key in context will set the default
value of <em>my_field</em> for the concerned model. But if curing this creation, other
object (such as sale.order.line, on sale.order creation) having a field
name <em>my_field</em>, their default value will be set too.</p>
<p>If you need to create a key context influencing the behavior of some object,
choice a good name, and eventually prefix it by the name of the module to
isolate its impact. A good example are the keys of <code class="docutils literal"><span class="pre">mail</span></code> module :
<em>mail_create_nosubscribe</em>, <em>mail_notrack</em>, <em>mail_notify_user_signature</em>, …</p>
</div>
<div class="section" id="do-not-bypass-the-orm">
<h4>Do not bypass the ORM<a class="headerlink" href="#do-not-bypass-the-orm" title="Permalink to this headline">¶</a></h4>
<p>You should never use the database cursor directly when the ORM can do the same
thing! By doing so you are bypassing all the ORM features, possibly the
transactions, access rights and so on.</p>
<p>And chances are that you are also making the code harder to read and probably
less secure.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># very very wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in (&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;) AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># no injection, but still wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in </span><span class="si">%s</span><span class="s1"> &#39;</span>\
           <span class="s1">&#39;AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># better</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;auction_id&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;draft&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;obj_price&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="no-sql-injections-please">
<h4>No SQL injections, please !<a class="headerlink" href="#no-sql-injections-please" title="Permalink to this headline">¶</a></h4>
<p>Care must be taken not to introduce SQL injections vulnerabilities when using
manual SQL queries. The vulnerability is present when user input is either
incorrectly filtered or badly quoted, allowing an attacker to introduce
undesirable clauses to a SQL query (such as circumventing filters or
executing UPDATE or DELETE commands).</p>
<p>The best way to be safe is to never, NEVER use Python string concatenation (+)
or string parameters interpolation (%) to pass variables to a SQL query string.</p>
<p>The second reason, which is almost as important, is that it is the job of the
database abstraction layer (psycopg2) to decide how to format query parameters,
not your job! For example psycopg2 knows that when you pass a list of values
it needs to format them as a comma-separated list, enclosed in parentheses !</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># the following is very bad:</span>
<span class="c1">#   - it&#39;s a SQL injection vulnerability</span>
<span class="c1">#   - it&#39;s unreadable</span>
<span class="c1">#   - it&#39;s not your job to format the list of ids</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT distinct child_id FROM account_account_consol_rel &#39;</span> <span class="o">+</span>
           <span class="s1">&#39;WHERE parent_id IN (&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1"># better</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT DISTINCT child_id &#39;</span>\
           <span class="s1">&#39;FROM account_account_consol_rel &#39;</span>\
           <span class="s1">&#39;WHERE parent_id IN </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
           <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),))</span>
</pre></div>
</div>
<p>This is very important, so please be careful also when refactoring, and most
importantly do not copy these patterns!</p>
<p>Here is a memorable example to help you remember what the issue is about (but
do not copy the code there). Before continuing, please be sure to read the
online documentation of pyscopg2 to learn of to use it properly:</p>
<ul class="simple">
<li>The problem with query parameters (<a class="reference external" href="http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters">http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters</a>)</li>
<li>How to pass parameters with psycopg2 (<a class="reference external" href="http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries">http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries</a>)</li>
<li>Advanced parameter types (<a class="reference external" href="http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types">http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types</a>)</li>
</ul>
</div>
<div class="section" id="keep-your-methods-short-simple-when-possible">
<h4>Keep your methods short/simple when possible<a class="headerlink" href="#keep-your-methods-short-simple-when-possible" title="Permalink to this headline">¶</a></h4>
<p>Functions and methods should not contain too much logic: having a lot of small
and simple methods is more advisable than having few large and complex methods.
A good rule of thumb is to split a method as soon as:
- it has more than one responsibility (see <a class="reference external" href="http://en.wikipedia.org/wiki/Single_responsibility_principle">http://en.wikipedia.org/wiki/Single_responsibility_principle</a>)
- it is too big to fit on one screen.</p>
<p>Also, name your functions accordingly: small and properly named functions are the starting point of readable/maintainable code and tighter documentation.</p>
<p>This recommendation is also relevant for classes, files, modules and packages. (See also <a class="reference external" href="http://en.wikipedia.org/wiki/Cyclomatic_complexity">http://en.wikipedia.org/wiki/Cyclomatic_complexity</a>)</p>
</div>
<div class="section" id="never-commit-the-transaction">
<h4>Never commit the transaction<a class="headerlink" href="#never-commit-the-transaction" title="Permalink to this headline">¶</a></h4>
<p>The Odoo framework is in charge of providing the transactional context for
all RPC calls. The principle is that a new database cursor is opened at the
beginning of each RPC call, and committed when the call has returned, just
before transmitting the answer to the RPC client, approximately like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">db</span><span class="p">,</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">pooler</span><span class="o">.</span><span class="n">get_db_and_pool</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
    <span class="c1"># create transaction cursor</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">execute_cr</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c1"># all good, we commit</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span> <span class="c1"># error, rollback everything atomically</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># always close cursor opened manually</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>If any error occurs during the execution of the RPC call, the transaction is
rolled back atomically, preserving the state of the system.</p>
<p>Similarly, the system also provides a dedicated transaction during the execution
of tests suites, so it can be rolled back or not depending on the server
startup options.</p>
<p>The consequence is that if you manually call <code class="docutils literal"><span class="pre">cr.commit()</span></code> anywhere there is
a very high chance that you will break the system in various ways, because you
will cause partial commits, and thus partial and unclean rollbacks, causing
among others:</p>
<ol class="arabic simple">
<li>inconsistent business data, usually data loss</li>
<li>workflow desynchronization, documents stuck permanently</li>
<li>tests that can’t be rolled back cleanly, and will start polluting the
database, and triggering error (this is true even if no error occurs
during the transaction)</li>
</ol>
<dl class="docutils">
<dt>Here is the very simple rule:</dt>
<dd><p class="first">You should <strong>NEVER</strong> call <code class="docutils literal"><span class="pre">cr.commit()</span></code> yourself, <strong>UNLESS</strong> you have
created your own database cursor explicitly! And the situations where you
need to do that are exceptional!</p>
<p class="last">And by the way if you did create your own cursor, then you need to handle
error cases and proper rollback, as well as properly close the cursor when
you’re done with it.</p>
</dd>
</dl>
<p>And contrary to popular belief, you do not even need to call <code class="docutils literal"><span class="pre">cr.commit()</span></code>
in the following situations:
- in the <code class="docutils literal"><span class="pre">_auto_init()</span></code> method of an <em>models.Model</em> object: this is taken
care of by the addons initialization method, or by the ORM transaction when
creating custom models
- in reports: the <code class="docutils literal"><span class="pre">commit()</span></code> is handled by the framework too, so you can
update the database even from within a report
- within <em>models.Transient</em> methods: these methods are called exactly like
regular <em>models.Model</em> ones, within a transaction and with the corresponding
<code class="docutils literal"><span class="pre">cr.commit()/rollback()</span></code> at the end
- etc. (see general rule above if you have in doubt!)</p>
<p>All <code class="docutils literal"><span class="pre">cr.commit()</span></code> calls outside of the server framework from now on must
have an <strong>explicit comment</strong> explaining why they are absolutely necessary, why
they are indeed correct, and why they do not break the transactions. Otherwise
they can and will be removed !</p>
</div>
<div class="section" id="use-translation-method-correctly">
<h4>Use translation method correctly<a class="headerlink" href="#use-translation-method-correctly" title="Permalink to this headline">¶</a></h4>
<p>Odoo uses a GetText-like method named “underscore” <code class="docutils literal"><span class="pre">_(</span> <span class="pre">)</span></code> to indicate that
a static string used in the code needs to be translated at runtime using the
language of the context. This pseudo-method is accessed within your code by
importing as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">_</span>
</pre></div>
</div>
<p>A few very important rules must be followed when using it, in order for it to
work and to avoid filling the translations with useless junk.</p>
<p>Basically, this method should only be used for static strings written manually
in the code, it will not work to translate field values, such as Product names,
etc. This must be done instead using the translate flag on the corresponding
field.</p>
<p>The rule is very simple: calls to the underscore method should always be in
the form <code class="docutils literal"><span class="pre">_('literal</span> <span class="pre">string')</span></code> and nothing else:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># good: plain strings</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;This record is locked!&#39;</span><span class="p">)</span>

<span class="c1"># good: strings with formatting patterns included</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified!&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>

<span class="c1"># ok too: multi-line literal strings</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;This is a bad multiline example</span>
<span class="s2">             about record </span><span class="si">%s</span><span class="s2">!&quot;&quot;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified&#39;</span> \
          <span class="s1">&#39;after being validated!&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>

<span class="c1"># bad: tries to translate after string formatting</span>
<span class="c1">#      (pay attention to brackets!)</span>
<span class="c1"># This does NOT work and messes up the translations!</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified!&#39;</span> <span class="o">%</span> <span class="n">record</span><span class="p">)</span>

<span class="c1"># bad: dynamic string, string concatenation, etc are forbidden!</span>
<span class="c1"># This does NOT work and messes up the translations!</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">que_rec</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># bad: field values are automatically translated by the framework</span>
<span class="c1"># This is useless and will not work the way you think:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is out of stock!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># and the following will of course not work as already explained:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is out of stock!&quot;</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># bad: field values are automatically translated by the framework</span>
<span class="c1"># This is useless and will not work the way you think:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># and the following will of course not work as already explained:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># Instead you can do the following and everything will be translated,</span>
<span class="c1"># including the product name if its field definition has the</span>
<span class="c1"># translate flag properly set:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>Also, keep in mind that translators will have to work with the literal values
that are passed to the underscore function, so please try to make them easy to
understand and keep spurious characters and formatting to a minimum. Translators
must be aware that formatting patterns such as %s or %d, newlines, etc. need
to be preserved, but it’s important to use these in a sensible and obvious manner:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Bad: makes the translations hard to work with</span>
<span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">question</span> <span class="o">+</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&#39; </span><span class="se">\n</span><span class="s2">Please enter an integer value &quot;</span><span class="p">)</span>

<span class="c1"># Better (pay attention to position of the brackets too!)</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Answer to question </span><span class="si">%s</span><span class="s2"> is not valid.</span><span class="se">\n</span><span class="s2">&quot;</span> \
          <span class="s2">&quot;Please enter an integer value.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">question</span>
</pre></div>
</div>
<p>In general in Odoo, when manipulating strings, prefer <code class="docutils literal"><span class="pre">%</span></code> over <code class="docutils literal"><span class="pre">.format()</span></code>
(when only one variable to replace in a string), and prefer <code class="docutils literal"><span class="pre">%(varname)</span></code> instead
of position (when multiple variables have to be replaced). This makes the
translation easier for the community translators.</p>
</div>
</div>
<div class="section" id="symbols-and-conventions">
<h3>Symbols and Conventions<a class="headerlink" href="#symbols-and-conventions" title="Permalink to this headline">¶</a></h3>
<ul>
<li><dl class="first docutils">
<dt>Model name (using the dot notation, prefix by the module name) :</dt>
<dd><ul class="first last simple">
<li>When defining an Odoo Model : use singular form of the name (<em>res.partner</em>
and <em>sale.order</em> instead of <em>res.partnerS</em> and <em>saleS.orderS</em>)</li>
<li>When defining an Odoo Transient (wizard) : use <code class="docutils literal"><span class="pre">&lt;related_base_model&gt;.&lt;action&gt;</span></code>
where <em>related_base_model</em> is the base model (defined in <em>models/</em>) related
to the transient, and <em>action</em> is the short name of what the transient do.
For instance : <code class="docutils literal"><span class="pre">account.invoice.make</span></code>, <code class="docutils literal"><span class="pre">project.task.delegate.batch</span></code>, …</li>
<li>When defining <em>report</em> model (SQL views e.i.) : use
<code class="docutils literal"><span class="pre">&lt;related_base_model&gt;.report.&lt;action&gt;</span></code>, based on the Transient convention.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Odoo Python Class : use camelcase for code in api v8 (Object-oriented style),
underscore lowercase notation for old api (SQL style).</p>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountInvoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">account_invoice</span><span class="p">(</span><span class="n">osv</span><span class="o">.</span><span class="n">osv</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<ul>
<li><dl class="first docutils">
<dt>Variable name :</dt>
<dd><ul class="first last simple">
<li>use camelcase for model variable</li>
<li>use underscore lowercase notation for common variable.</li>
<li>since new API works with record or recordset instead of id list, don’t
suffix variable name with <em>_id</em> or <em>_ids</em> if they not contain id or list
of id.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ResPartner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
<span class="n">partners</span> <span class="o">=</span> <span class="n">ResPartner</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
<span class="n">partner_id</span> <span class="o">=</span> <span class="n">partners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">One2Many</span></code> and <code class="docutils literal"><span class="pre">Many2Many</span></code> fields should always have <em>_ids</em> as suffix (example: sale_order_line_ids)</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Many2One</span></code> fields should have <em>_id</em> as suffix (example : partner_id, user_id, …)</p>
</li>
<li><dl class="first docutils">
<dt>Method conventions</dt>
<dd><ul class="first last simple">
<li>Compute Field : the compute method pattern is <em>_compute_&lt;field_name&gt;</em></li>
<li>Search method : the search method pattern is <em>_search_&lt;field_name&gt;</em></li>
<li>Default method : the default method pattern is <em>_default_&lt;field_name&gt;</em></li>
<li>Onchange method : the onchange method pattern is <em>_onchange_&lt;field_name&gt;</em></li>
<li>Constraint method : the constraint method pattern is <em>_check_&lt;constraint_name&gt;</em></li>
<li>Action method : an object action method is prefix with <em>action_</em>. Its decorator is
<code class="docutils literal"><span class="pre">&#64;api.multi</span></code>, but since it use only one record, add <code class="docutils literal"><span class="pre">self.ensure_one()</span></code>
at the beginning of the method.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In a Model attribute order should be</dt>
<dd><ol class="first last arabic simple">
<li>Private attributes (<code class="docutils literal"><span class="pre">_name</span></code>, <code class="docutils literal"><span class="pre">_description</span></code>, <code class="docutils literal"><span class="pre">_inherit</span></code>, …)</li>
<li>Default method and <code class="docutils literal"><span class="pre">_default_get</span></code></li>
<li>Field declarations</li>
<li>Compute and search methods in the same order as field declaration</li>
<li>Constrains methods (<code class="docutils literal"><span class="pre">&#64;api.constrains</span></code>) and onchange methods (<code class="docutils literal"><span class="pre">&#64;api.onchange</span></code>)</li>
<li>CRUD methods (ORM overrides)</li>
<li>Action methods</li>
<li>And finally, other business methods.</li>
</ol>
</dd>
</dl>
</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># Private attributes</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;event.event&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Event&#39;</span>

    <span class="c1"># Default methods</span>
    <span class="k">def</span> <span class="nf">_default_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Fields declaration</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_name</span><span class="p">)</span>
    <span class="n">seats_reserved</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">oldname</span><span class="o">=</span><span class="s1">&#39;register_current&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Reserved Seats&#39;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_seats&#39;</span><span class="p">)</span>
    <span class="n">seats_available</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">oldname</span><span class="o">=</span><span class="s1">&#39;register_avail&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Available Seats&#39;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_seats&#39;</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>

    <span class="c1"># compute and search fields, in the same order of fields declaration</span>
    <span class="nd">@api.multi</span>
    <span class="nd">@api.depends</span><span class="p">(</span><span class="s1">&#39;seats_max&#39;</span><span class="p">,</span> <span class="s1">&#39;registration_ids.state&#39;</span><span class="p">,</span> <span class="s1">&#39;registration_ids.nb_register&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Constraints and onchanges</span>
    <span class="nd">@api.constrains</span><span class="p">(</span><span class="s1">&#39;seats_max&#39;</span><span class="p">,</span> <span class="s1">&#39;seats_available&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_seats_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@api.onchange</span><span class="p">(</span><span class="s1">&#39;date_begin&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_date_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># CRUD methods (and name_get, name_search, ...) overrides</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Action methods</span>
    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">action_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
        <span class="o">...</span>

    <span class="c1"># Business methods</span>
    <span class="k">def</span> <span class="nf">mail_user_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="javascript-and-css">
<h2>Javascript and CSS<a class="headerlink" href="#javascript-and-css" title="Permalink to this headline">¶</a></h2>
<p><strong>For javascript :</strong></p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">use</span> <span class="pre">strict;</span></code> is recommended for all javascript files</li>
<li>Use a linter (jshint, …)</li>
<li>Never add minified Javascript Libraries</li>
<li>Use camelcase for class declaration</li>
<li>Unless your code is supposed to run on every page, target specific pages
using the <code class="docutils literal"><span class="pre">if_dom_contains</span></code> function of website module. Target an
element which is specific to the pages your code needs to run on
using JQuery.</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">website</span><span class="p">.</span><span class="nx">if_dom_contains</span><span class="p">(</span><span class="s1">&#39;.jquery_class_selector&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="cm">/*your code here*/</span>
<span class="p">});</span>
</pre></div>
</div>
<p><strong>For CSS :</strong></p>
<ul class="simple">
<li>Prefix all your classes with <em>o_&lt;module_name&gt;</em> where <em>module_name</em> is the
technical name of the module (‘sale’, ‘im_chat’, …) or the main route
reserved by the module (for website module mainly, i.e. : ‘o_forum’ for
<em>website_forum</em> module). The only exception for this rule is the
webclient: it simply uses <em>o_</em> prefix.</li>
<li>Avoid using id</li>
<li>Use Bootstrap native classes</li>
<li>Use underscore lowercase notation to name class</li>
</ul>
</div>
<div class="section" id="git">
<h2>Git<a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h2>
<div class="section" id="commit-message">
<h3>Commit message<a class="headerlink" href="#commit-message" title="Permalink to this headline">¶</a></h3>
<p>Prefix your commit with</p>
<ul class="simple">
<li><strong>[IMP]</strong> for improvements</li>
<li><strong>[FIX]</strong> for bug fixes</li>
<li><strong>[REF]</strong> for refactoring</li>
<li><strong>[ADD]</strong> for adding new resources</li>
<li><strong>[REM]</strong> for removing of resources</li>
<li><strong>[MOV]</strong> for moving files (Do not change content of moved file, otherwise
Git will loose track, and the history will be lost !), or simply moving code
from a file to another one.</li>
<li><strong>[MERGE]</strong> for merge commits (only for forward/back-port)</li>
<li><strong>[CLA]</strong> for signing the Odoo Individual Contributor License</li>
</ul>
<p>Then, in the message itself, specify the part of the code impacted by
your changes (module name, lib, transversal object, …) and a description
of the changes.</p>
<ul class="simple">
<li>Always include a meaningful commit message: it should be self explanatory
(long enough) including the name of the module that has been changed and the
reason behind the change. Do not use single words like “bugfix” or
“improvements”.</li>
<li>Avoid commits which simultaneously impact multiple modules. Try to
split into different commits where impacted modules are different
(It will be helpful if we need to revert a module separately).</li>
</ul>
<div class="highlight-text"><div class="highlight"><pre><span></span>[FIX] website, website_mail: remove unused alert div, fixes look of input-group-btn

Bootstrap&#39;s CSS depends on the input-group-btn
element being the first/last child of its parent.
This was not the case because of the invisible
and useless alert.

[IMP] fields: reduce memory footprint of list/set field attributes

[REF] web: add module system to the web client

This commit introduces a new module system for the javascript code.
Instead of using global ...
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the long description to explain the <em>why</em> not the
<em>what</em>, the <em>what</em> can be seen in the diff</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../reference.html">Reference</a><ul>
      <li>Previous: <a href="mixins.html" title="previous chapter">Mixins and Useful Classes</a></li>
      <li>Next: <a href="mobile.html" title="next chapter">Mobile JavaScript</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Gahan Corporation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/reference/guidelines.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>