
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Building a Module &#8212; gerp v0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'v0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="building-a-module">
<h1>Building a Module<a class="headerlink" href="#building-a-module" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This tutorial requires <a class="reference internal" href="../setup/install.html#setup-install"><span class="std std-ref">having installed Gerp</span></a></p>
</div>
<div class="section" id="start-stop-the-gerp-server">
<h2>Start/Stop the Gerp server<a class="headerlink" href="#start-stop-the-gerp-server" title="Permalink to this headline">¶</a></h2>
<p>Gerp uses a client/server architecture in which clients are web browsers
accessing the Gerp server via RPC.</p>
<p>Business logic and extension is generally performed on the server side,
although supporting client features (e.g. new data representation such as
interactive maps) can be added to the client.</p>
<p>In order to start the server, simply invoke the command <a class="reference internal" href="../reference/cmdline.html#reference-cmdline"><span class="std std-ref">gerp-bin</span></a> in the shell, adding the full path to the file if
necessary:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">gerp</span><span class="o">-</span><span class="nb">bin</span>
</pre></div>
</div>
<p>The server is stopped by hitting <code class="docutils literal"><span class="pre">Ctrl-C</span></code> twice from the terminal, or by
killing the corresponding OS process.</p>
</div>
<div class="section" id="build-an-gerp-module">
<h2>Build an Gerp module<a class="headerlink" href="#build-an-gerp-module" title="Permalink to this headline">¶</a></h2>
<p>Both server and client extensions are packaged as <em>modules</em> which are
optionally loaded in a <em>database</em>.</p>
<p>Gerp modules can either add brand new business logic to an Gerp system, or
alter and extend existing business logic: a module can be created to add your
country’s accounting rules to Gerp’s generic accounting support, while the
next module adds support for real-time visualisation of a bus fleet.</p>
<p>Everything in Gerp thus starts and ends with modules.</p>
<div class="section" id="composition-of-a-module">
<h3>Composition of a module<a class="headerlink" href="#composition-of-a-module" title="Permalink to this headline">¶</a></h3>
<p>An Gerp module can contain a number of elements:</p>
<dl class="docutils">
<dt>Business objects</dt>
<dd>Declared as Python classes, these resources are automatically persisted
by Gerp based on their configuration</dd>
<dt>Data files</dt>
<dd>XML or CSV files declaring metadata (views or reports), configuration
data (modules parameterization), demonstration data and more</dd>
<dt>Web controllers</dt>
<dd>Handle requests from web browsers</dd>
<dt>Static web data</dt>
<dd>Images, CSS or javascript files used by the web interface or website</dd>
</dl>
</div>
<div class="section" id="module-structure">
<h3>Module structure<a class="headerlink" href="#module-structure" title="Permalink to this headline">¶</a></h3>
<p>Each module is a directory within a <em>module directory</em>. Module directories
are specified by using the <a class="reference internal" href="../reference/cmdline.html#cmdoption-gerp-bin-addons-path"><code class="xref std std-option docutils literal"><span class="pre">--addons-path</span></code></a>
option.</p>
<div class="aphorism admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">most command-line options can also be set using <a class="reference internal" href="../reference/cmdline.html#reference-cmdline-config"><span class="std std-ref">a configuration
file</span></a></p>
</div>
<p>An Gerp module is declared by its <a class="reference internal" href="../reference/module.html#reference-module-manifest"><span class="std std-ref">manifest</span></a>.
See the <a class="reference internal" href="../reference/module.html#reference-module-manifest"><span class="std std-ref">manifest documentation</span></a> about it.</p>
<p>A module is also a
<a class="reference external" href="http://docs.python.org/2/tutorial/modules.html#packages">Python package</a>
with a <code class="docutils literal"><span class="pre">__init__.py</span></code> file, containing import instructions for various Python
files in the module.</p>
<p>For instance, if the module has a single <code class="docutils literal"><span class="pre">mymodule.py</span></code> file <code class="docutils literal"><span class="pre">__init__.py</span></code>
might contain:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">mymodule</span>
</pre></div>
</div>
<p>Gerp provides a mechanism to help set up a new module, <a class="reference internal" href="../reference/cmdline.html#reference-cmdline-server"><span class="std std-ref">gerp-bin</span></a> has a subcommand <a class="reference internal" href="../reference/cmdline.html#reference-cmdline-scaffold"><span class="std std-ref">scaffold</span></a> to create an empty module:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> gerp-bin scaffold &lt;module name&gt; &lt;where to put it&gt;
</pre></div>
</div>
<p>The command creates a subdirectory for your module, and automatically creates a
bunch of standard files for a module. Most of them simply contain commented code
or XML. The usage of most of those files will be explained along this tutorial.</p>
</div>
<div class="section" id="object-relational-mapping">
<h3>Object-Relational Mapping<a class="headerlink" href="#object-relational-mapping" title="Permalink to this headline">¶</a></h3>
<p>A key component of Gerp is the <abbr title="Object-Relational Mapping">ORM</abbr> layer.
This layer avoids having to write most <abbr title="Structured Query Language">SQL</abbr>
by hand and provides extensibility and security services<a class="footnote-reference" href="#rawsql" id="id1">[2]</a>.</p>
<p>Business objects are declared as Python classes extending
<code class="xref py py-class docutils literal"><span class="pre">Model</span></code> which integrates them into the automated
persistence system.</p>
<p>Models can be configured by setting a number of attributes at their
definition. The most important attribute is
<code class="xref py py-attr docutils literal"><span class="pre">_name</span></code> which is required and defines the name for
the model in the Gerp system. Here is a minimally complete definition of a
model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerp</span> <span class="k">import</span> <span class="n">models</span>
<span class="k">class</span> <span class="nc">MinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.model&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="model-fields">
<h3>Model fields<a class="headerlink" href="#model-fields" title="Permalink to this headline">¶</a></h3>
<p>Fields are used to define what the model can store and where. Fields are
defined as attributes on the model class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerp</span> <span class="k">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">LessMinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.model2&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="common-attributes">
<h4>Common Attributes<a class="headerlink" href="#common-attributes" title="Permalink to this headline">¶</a></h4>
<p>Much like the model itself, its fields can be configured, by passing
configuration attributes as parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Some attributes are available on all fields, here are the most common ones:</p>
<dl class="docutils">
<dt><code class="xref py py-attr docutils literal"><span class="pre">string</span></code> (<code class="docutils literal"><span class="pre">unicode</span></code>, default: field’s name)</dt>
<dd>The label of the field in UI (visible by users).</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">required</span></code> (<code class="docutils literal"><span class="pre">bool</span></code>, default: <code class="docutils literal"><span class="pre">False</span></code>)</dt>
<dd>If <code class="docutils literal"><span class="pre">True</span></code>, the field can not be empty, it must either have a default
value or always be given a value when creating a record.</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">help</span></code> (<code class="docutils literal"><span class="pre">unicode</span></code>, default: <code class="docutils literal"><span class="pre">''</span></code>)</dt>
<dd>Long-form, provides a help tooltip to users in the UI.</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">index</span></code> (<code class="docutils literal"><span class="pre">bool</span></code>, default: <code class="docutils literal"><span class="pre">False</span></code>)</dt>
<dd>Requests that Gerp create a <a class="reference external" href="http://use-the-index-luke.com/sql/preface">database index</a> on the column.</dd>
</dl>
</div>
<div class="section" id="simple-fields">
<h4>Simple fields<a class="headerlink" href="#simple-fields" title="Permalink to this headline">¶</a></h4>
<p>There are two broad categories of fields: “simple” fields which are atomic
values stored directly in the model’s table and “relational” fields linking
records (of the same model or of different models).</p>
<p>Example of simple fields are <code class="xref py py-class docutils literal"><span class="pre">Boolean</span></code>,
<code class="xref py py-class docutils literal"><span class="pre">Date</span></code>, <code class="xref py py-class docutils literal"><span class="pre">Char</span></code>.</p>
</div>
<div class="section" id="reserved-fields">
<h4>Reserved fields<a class="headerlink" href="#reserved-fields" title="Permalink to this headline">¶</a></h4>
<p>Gerp creates a few fields in all models<a class="footnote-reference" href="#autofields" id="id2">[1]</a>. These fields are
managed by the system and shouldn’t be written to. They can be read if
useful or necessary:</p>
<dl class="docutils">
<dt><code class="xref py py-attr docutils literal"><span class="pre">id</span></code> (<code class="xref py py-class docutils literal"><span class="pre">Id</span></code>)</dt>
<dd>The unique identifier for a record in its model.</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">create_date</span></code> (<code class="xref py py-class docutils literal"><span class="pre">Datetime</span></code>)</dt>
<dd>Creation date of the record.</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">create_uid</span></code> (<code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code>)</dt>
<dd>User who created the record.</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">write_date</span></code> (<code class="xref py py-class docutils literal"><span class="pre">Datetime</span></code>)</dt>
<dd>Last modification date of the record.</dd>
<dt><code class="xref py py-attr docutils literal"><span class="pre">write_uid</span></code> (<code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code>)</dt>
<dd>user who last modified the record.</dd>
</dl>
</div>
<div class="section" id="special-fields">
<h4>Special fields<a class="headerlink" href="#special-fields" title="Permalink to this headline">¶</a></h4>
<p>By default, Gerp also requires a <code class="docutils literal"><span class="pre">name</span></code> field on all models for various
display and search behaviors. The field used for these purposes can be
overridden by setting <code class="xref py py-attr docutils literal"><span class="pre">_rec_name</span></code>.</p>
</div>
</div>
<div class="section" id="data-files">
<h3>Data files<a class="headerlink" href="#data-files" title="Permalink to this headline">¶</a></h3>
<p>Gerp is a highly data driven system. Although behavior is customized using
<a class="reference external" href="http://python.org">Python</a> code part of a module’s value is in the data it sets up when loaded.</p>
<div class="aphorism admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">some modules exist solely to add data into Gerp</p>
</div>
<p>Module data is declared via <a class="reference internal" href="../reference/data.html#reference-data"><span class="std std-ref">data files</span></a>, XML files with
<code class="docutils literal"><span class="pre">&lt;record&gt;</span></code> elements. Each <code class="docutils literal"><span class="pre">&lt;record&gt;</span></code> element creates or updates a database
record.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;gerp&gt;</span>

        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;{model name}&quot;</span> <span class="na">id=</span><span class="s">&quot;{record identifier}&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;{a field name}&quot;</span><span class="nt">&gt;</span>{a value}<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;/gerp&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">model</span></code> is the name of the Gerp model for the record.</li>
<li><code class="docutils literal"><span class="pre">id</span></code> is an <a class="reference internal" href="../glossary.html#term-external-identifier"><span class="xref std std-term">external identifier</span></a>, it allows referring to the record
(without having to know its in-database identifier).</li>
<li><code class="docutils literal"><span class="pre">&lt;field&gt;</span></code> elements have a <code class="docutils literal"><span class="pre">name</span></code> which is the name of the field in the
model (e.g. <code class="docutils literal"><span class="pre">description</span></code>). Their body is the field’s value.</li>
</ul>
<p>Data files have to be declared in the manifest file to be loaded, they can
be declared in the <code class="docutils literal"><span class="pre">'data'</span></code> list (always loaded) or in the <code class="docutils literal"><span class="pre">'demo'</span></code> list
(only loaded in demonstration mode).</p>
</div>
<div class="section" id="actions-and-menus">
<h3>Actions and Menus<a class="headerlink" href="#actions-and-menus" title="Permalink to this headline">¶</a></h3>
<p>Actions and menus are regular records in database, usually declared through
data files. Actions can be triggered in three ways:</p>
<ol class="arabic simple">
<li>by clicking on menu items (linked to specific actions)</li>
<li>by clicking on buttons in views (if these are connected to actions)</li>
<li>as contextual actions on object</li>
</ol>
<p>Because menus are somewhat complex to declare there is a <code class="docutils literal"><span class="pre">&lt;menuitem&gt;</span></code>
shortcut to declare an <code class="docutils literal"><span class="pre">ir.ui.menu</span></code> and connect it to the corresponding
action more easily.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Ideas<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>idea.idea<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
<span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;menu_ideas&quot;</span> <span class="na">parent=</span><span class="s">&quot;menu_root&quot;</span> <span class="na">name=</span><span class="s">&quot;Ideas&quot;</span> <span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
          <span class="na">action=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="aphorism admonition danger">
<p class="first admonition-title">Danger</p>
<p>The action must be declared before its corresponding menu in the XML file.</p>
<p class="last">Data files are executed sequentially, the action’s <code class="docutils literal"><span class="pre">id</span></code> must be present
in the database before the menu can be created.</p>
</div>
</div>
</div>
<div class="section" id="basic-views">
<h2>Basic views<a class="headerlink" href="#basic-views" title="Permalink to this headline">¶</a></h2>
<p>Views define the way the records of a model are displayed. Each type of view
represents a mode of visualization (a list of records, a graph of their
aggregation, …). Views can either be requested generically via their type
(e.g. <em>a list of partners</em>) or specifically via their id. For generic
requests, the view with the correct type and the lowest priority will be
used (so the lowest-priority view of each type is the default view for that
type).</p>
<p><a class="reference internal" href="../reference/views.html#reference-views-inheritance"><span class="std std-ref">View inheritance</span></a> allows altering views
declared elsewhere (adding or removing content).</p>
<div class="section" id="generic-view-declaration">
<h3>Generic view declaration<a class="headerlink" href="#generic-view-declaration" title="Permalink to this headline">¶</a></h3>
<p>A view is declared as a record of the model <code class="docutils literal"><span class="pre">ir.ui.view</span></code>. The view type
is implied by the root element of the <code class="docutils literal"><span class="pre">arch</span></code> field:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;view_id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;priority&quot;</span> <span class="na">eval=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- view content: &lt;form&gt;, &lt;tree&gt;, &lt;graph&gt;, ... --&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div class="aphorism admonition danger">
<p class="first admonition-title">Danger</p>
<p>The view’s content is XML.</p>
<p class="last">The <code class="docutils literal"><span class="pre">arch</span></code> field must thus be declared as <code class="docutils literal"><span class="pre">type=&quot;xml&quot;</span></code> to be parsed
correctly.</p>
</div>
</div>
<div class="section" id="tree-views">
<h3>Tree views<a class="headerlink" href="#tree-views" title="Permalink to this headline">¶</a></h3>
<p>Tree views, also called list views, display records in a tabular form.</p>
<p>Their root element is <code class="docutils literal"><span class="pre">&lt;tree&gt;</span></code>. The simplest form of the tree view simply
lists all the fields to display in the table (each field as a column):</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Idea list&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="form-views">
<h3>Form views<a class="headerlink" href="#form-views" title="Permalink to this headline">¶</a></h3>
<p>Forms are used to create and edit single records.</p>
<p>Their root element is <code class="docutils literal"><span class="pre">&lt;form&gt;</span></code>. They are composed of high-level structure
elements (groups, notebooks) and interactive elements (buttons and fields):</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Idea form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;General stuff&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;Dates&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;invent_date&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;notebook</span> <span class="na">colspan=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Description&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">nolabel=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/page&gt;</span>
        <span class="nt">&lt;/notebook&gt;</span>

        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>Form views can also use plain HTML for more flexible layouts:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Idea Form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Confirm&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_confirm&quot;</span>
                <span class="na">states=</span><span class="s">&quot;draft&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Mark as done&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_done&quot;</span>
                <span class="na">states=</span><span class="s">&quot;confirmed&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Reset to draft&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_draft&quot;</span>
                <span class="na">states=</span><span class="s">&quot;confirmed,done&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span> <span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;sheet&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_title&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_edit_only&quot;</span> <span class="na">string=</span><span class="s">&quot;Idea Name&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;h1&gt;&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;General&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Idea description...&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>
    <span class="nt">&lt;/sheet&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="search-views">
<h3>Search views<a class="headerlink" href="#search-views" title="Permalink to this headline">¶</a></h3>
<p>Search views customize the search field associated with the list view (and
other aggregated views). Their root element is <code class="docutils literal"><span class="pre">&lt;search&gt;</span></code> and they’re
composed of fields defining which fields can be searched on:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;search&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
</div>
<p>If no search view exists for the model, Gerp generates one which only allows
searching on the <code class="docutils literal"><span class="pre">name</span></code> field.</p>
</div>
</div>
<div class="section" id="relations-between-models">
<h2>Relations between models<a class="headerlink" href="#relations-between-models" title="Permalink to this headline">¶</a></h2>
<p>A record from a model may be related to a record from another model. For
instance, a sale order record is related to a client record that contains the
client data; it is also related to its sale order line records.</p>
<div class="section" id="relational-fields">
<h3>Relational fields<a class="headerlink" href="#relational-fields" title="Permalink to this headline">¶</a></h3>
<p>Relational fields link records, either of the same model (hierarchies) or
between different models.</p>
<p>Relational field types are:</p>
<dl class="docutils">
<dt><code class="xref py py-class docutils literal"><span class="pre">Many2one(other_model,</span> <span class="pre">ondelete='set</span> <span class="pre">null')</span></code></dt>
<dd><p class="first">A simple link to an other object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_id</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div class="last admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://www.postgresql.org/docs/9.3/static/tutorial-fk.html">foreign keys</a></p>
</div>
</dd>
<dt><code class="xref py py-class docutils literal"><span class="pre">One2many(other_model,</span> <span class="pre">related_field)</span></code></dt>
<dd><p class="first">A virtual relationship, inverse of a <code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code>.
A <code class="xref py py-class docutils literal"><span class="pre">One2many</span></code> behaves as a container of records,
accessing it results in a (possibly empty) set of records:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div class="last admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Because a <code class="xref py py-class docutils literal"><span class="pre">One2many</span></code> is a virtual relationship,
there <em>must</em> be a <code class="xref py py-class docutils literal"><span class="pre">Many2one</span></code> field in the
<code class="samp docutils literal"><em><span class="pre">other_model</span></em></code>, and its name <em>must</em> be <code class="samp docutils literal"><em><span class="pre">related_field</span></em></code></p>
</div>
</dd>
<dt><code class="xref py py-class docutils literal"><span class="pre">Many2many(other_model)</span></code></dt>
<dd><p class="first">Bidirectional multiple relationship, any record on one side can be related
to any number of records on the other side. Behaves as a container of
records, accessing it also results in a possibly empty set of records:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="inheritance">
<h2>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h2>
<div class="section" id="model-inheritance">
<h3>Model inheritance<a class="headerlink" href="#model-inheritance" title="Permalink to this headline">¶</a></h3>
<p>Gerp provides two <em>inheritance</em> mechanisms to extend an existing model in a
modular way.</p>
<p>The first inheritance mechanism allows a module to modify the behavior of a
model defined in another module:</p>
<ul class="simple">
<li>add fields to a model,</li>
<li>override the definition of fields on a model,</li>
<li>add constraints to a model,</li>
<li>add methods to a model,</li>
<li>override existing methods on a model.</li>
</ul>
<p>The second inheritance mechanism (delegation) allows to link every record of a
model to a record in a parent model, and provides transparent access to the
fields of the parent record.</p>
<img alt="../_images/inheritance_methods.png" class="align-center" src="../_images/inheritance_methods.png" />
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><code class="xref py py-attr docutils literal"><span class="pre">_inherit</span></code></li>
<li><code class="xref py py-attr docutils literal"><span class="pre">_inherits</span></code></li>
</ul>
</div>
</div>
<div class="section" id="view-inheritance">
<h3>View inheritance<a class="headerlink" href="#view-inheritance" title="Permalink to this headline">¶</a></h3>
<p>Instead of modifying existing views in place (by overwriting them), Gerp
provides view inheritance where children “extension” views are applied on top of
root views, and can add or remove content from their parent.</p>
<p>An extension view references its parent using the <code class="docutils literal"><span class="pre">inherit_id</span></code> field, and
instead of a single view its <code class="docutils literal"><span class="pre">arch</span></code> field is composed of any number of
<code class="docutils literal"><span class="pre">xpath</span></code> elements selecting and altering the content of their parent view:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- improved idea categories list --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;idea_category_list2&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>id.category.list2<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>idea.category<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;id_category_list&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- find field description and add the field</span>
<span class="c">             idea_ids after it --&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;description&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="na">string=</span><span class="s">&quot;Number of ideas&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">expr</span></code></dt>
<dd>An <a class="reference external" href="http://w3.org/TR/xpath">XPath</a> expression selecting a single element in the parent view.
Raises an error if it matches no element or more than one</dd>
<dt><code class="docutils literal"><span class="pre">position</span></code></dt>
<dd><p class="first">Operation to apply to the matched element:</p>
<dl class="last docutils">
<dt><code class="docutils literal"><span class="pre">inside</span></code></dt>
<dd>appends <code class="docutils literal"><span class="pre">xpath</span></code>’s body at the end of the matched element</dd>
<dt><code class="docutils literal"><span class="pre">replace</span></code></dt>
<dd>replaces the matched element with the <code class="docutils literal"><span class="pre">xpath</span></code>’s body, replacing any <code class="docutils literal"><span class="pre">$0</span></code> node occurrence
in the new body with the original element</dd>
<dt><code class="docutils literal"><span class="pre">before</span></code></dt>
<dd>inserts the <code class="docutils literal"><span class="pre">xpath</span></code>’s body as a sibling before the matched element</dd>
<dt><code class="docutils literal"><span class="pre">after</span></code></dt>
<dd>inserts the <code class="docutils literal"><span class="pre">xpaths</span></code>’s body as a sibling after the matched element</dd>
<dt><code class="docutils literal"><span class="pre">attributes</span></code></dt>
<dd>alters the attributes of the matched element using special
<code class="docutils literal"><span class="pre">attribute</span></code> elements in the <code class="docutils literal"><span class="pre">xpath</span></code>’s body</dd>
</dl>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When matching a single element, the <code class="docutils literal"><span class="pre">position</span></code> attribute can be set directly
on the element to be found. Both inheritances below will give the same result.</p>
<div class="last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;description&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/xpath&gt;</span>

<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="domains">
<h4>Domains<a class="headerlink" href="#domains" title="Permalink to this headline">¶</a></h4>
<p>In Gerp, <a class="reference internal" href="../reference/orm.html#reference-orm-domains"><span class="std std-ref">Domains</span></a> are values that encode conditions on
records. A domain is a  list of criteria used to select a subset of a model’s
records. Each criteria is a triple with a field name, an operator and a value.</p>
<p>For instance, when used on the <em>Product</em> model the following domain selects
all <em>services</em> with a unit price over <em>1000</em>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;product_type&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;service&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>
</div>
<p>By default criteria are combined with an implicit AND. The logical operators
<code class="docutils literal"><span class="pre">&amp;</span></code> (AND), <code class="docutils literal"><span class="pre">|</span></code> (OR) and <code class="docutils literal"><span class="pre">!</span></code> (NOT) can be used to explicitly combine
criteria. They are used in prefix position (the operator is inserted before
its arguments rather than between). For instance to select products “which are
services <em>OR</em> have a unit price which is <em>NOT</em> between 1000 and 2000”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;product_type&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;service&#39;</span><span class="p">),</span>
    <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)]</span>
</pre></div>
</div>
<p>A <code class="docutils literal"><span class="pre">domain</span></code> parameter can be added to relational fields to limit valid
records for the relation when trying to select records in the client interface.</p>
</div>
</div>
</div>
<div class="section" id="computed-fields-and-default-values">
<h2>Computed fields and default values<a class="headerlink" href="#computed-fields-and-default-values" title="Permalink to this headline">¶</a></h2>
<p>So far fields have been stored directly in and retrieved directly from the
database. Fields can also be <em>computed</em>. In that case, the field’s value is not
retrieved from the database but computed on-the-fly by calling a method of the
model.</p>
<p>To create a computed field, create a field and set its attribute
<code class="xref py py-attr docutils literal"><span class="pre">compute</span></code> to the name of a method. The computation
method should simply set the value of the field to compute on every record in
<code class="docutils literal"><span class="pre">self</span></code>.</p>
<div class="aphorism admonition danger">
<p class="first admonition-title">Danger</p>
<p><code class="docutils literal"><span class="pre">self</span></code> is a collection</p>
<p>The object <code class="docutils literal"><span class="pre">self</span></code> is a <em>recordset</em>, i.e., an ordered collection of
records. It supports the standard Python operations on collections, like
<code class="docutils literal"><span class="pre">len(self)</span></code> and <code class="docutils literal"><span class="pre">iter(self)</span></code>, plus extra set operations like <code class="docutils literal"><span class="pre">recs1</span> <span class="pre">+</span>
<span class="pre">recs2</span></code>.</p>
<p class="last">Iterating over <code class="docutils literal"><span class="pre">self</span></code> gives the records one by one, where each record is
itself a collection of size 1. You can access/assign fields on single
records by using the dot notation, like <code class="docutils literal"><span class="pre">record.name</span></code>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">gerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.computed&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">)</span>

    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>The value of a computed field usually depends on the values of other fields on
the computed record. The ORM expects the developer to specify those dependencies
on the compute method with the decorator <code class="xref py py-func docutils literal"><span class="pre">depends()</span></code>.
The given dependencies are used by the ORM to trigger the recomputation of the
field whenever some of its dependencies have been modified:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerp</span> <span class="k">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.computed&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Record with value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
<div class="section" id="default-values">
<h3>Default values<a class="headerlink" href="#default-values" title="Permalink to this headline">¶</a></h3>
<p>Any field can be given a default value. In the field definition, add the option
<code class="docutils literal"><span class="pre">default=X</span></code> where <code class="docutils literal"><span class="pre">X</span></code> is either a Python literal value (boolean, integer,
float, string), or a function taking a recordset and returning a value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The object <code class="docutils literal"><span class="pre">self.env</span></code> gives access to request parameters and other useful
things:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">self.env.cr</span></code> or <code class="docutils literal"><span class="pre">self._cr</span></code> is the database <em>cursor</em> object; it is
used for querying the database</li>
<li><code class="docutils literal"><span class="pre">self.env.uid</span></code> or <code class="docutils literal"><span class="pre">self._uid</span></code> is the current user’s database id</li>
<li><code class="docutils literal"><span class="pre">self.env.user</span></code> is the current user’s record</li>
<li><code class="docutils literal"><span class="pre">self.env.context</span></code> or <code class="docutils literal"><span class="pre">self._context</span></code> is the context dictionary</li>
<li><code class="docutils literal"><span class="pre">self.env.ref(xml_id)</span></code> returns the record corresponding to an XML id</li>
<li><code class="docutils literal"><span class="pre">self.env[model_name]</span></code> returns an instance of the given model</li>
</ul>
</div>
</div>
</div>
<div class="section" id="onchange">
<h2>Onchange<a class="headerlink" href="#onchange" title="Permalink to this headline">¶</a></h2>
<p>The “onchange” mechanism provides a way for the client interface to update a
form whenever the user has filled in a value in a field, without saving anything
to the database.</p>
<p>For instance, suppose a model has three fields <code class="docutils literal"><span class="pre">amount</span></code>, <code class="docutils literal"><span class="pre">unit_price</span></code> and
<code class="docutils literal"><span class="pre">price</span></code>, and you want to update the price on the form when any of the other
fields is modified. To achieve this, define a method where <code class="docutils literal"><span class="pre">self</span></code> represents
the record in the form view, and decorate it with <code class="xref py py-func docutils literal"><span class="pre">onchange()</span></code>
to specify on which field it has to be triggered. Any change you make on
<code class="docutils literal"><span class="pre">self</span></code> will be reflected on the form.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- content of form view --&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;amount&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;unit_price&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># onchange handler</span>
<span class="nd">@api.onchange</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_price&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_onchange_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># set auto-changing field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span>
    <span class="c1"># Can optionally return a warning and domains</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Something bad happened&quot;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;It was very bad indeed&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>For computed fields, valued <code class="docutils literal"><span class="pre">onchange</span></code> behavior is built-in as can be seen by
playing with the <em>Session</em> form: change the number of seats or participants, and
the <code class="docutils literal"><span class="pre">taken_seats</span></code> progressbar is automatically updated.</p>
</div>
<div class="section" id="model-constraints">
<h2>Model constraints<a class="headerlink" href="#model-constraints" title="Permalink to this headline">¶</a></h2>
<p>Gerp provides two ways to set up automatically verified invariants:
<code class="xref py py-func docutils literal"><span class="pre">Python</span> <span class="pre">constraints</span></code> and
<code class="xref py py-attr docutils literal"><span class="pre">SQL</span> <span class="pre">constraints</span></code>.</p>
<p>A Python constraint is defined as a method decorated with
<code class="xref py py-func docutils literal"><span class="pre">constrains()</span></code>, and invoked on a recordset. The decorator
specifies which fields are involved in the constraint, so that the constraint is
automatically evaluated when one of them is modified. The method is expected to
raise an exception if its invariant is not satisfied:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerp.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_check_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Your record is too old: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="c1"># all records passed the test, don&#39;t return anything</span>
</pre></div>
</div>
<p>SQL constraints are defined through the model attribute
<code class="xref py py-attr docutils literal"><span class="pre">_sql_constraints</span></code>. The latter is assigned to a list
of triples of strings <code class="docutils literal"><span class="pre">(name,</span> <span class="pre">sql_definition,</span> <span class="pre">message)</span></code>, where <code class="docutils literal"><span class="pre">name</span></code> is a
valid SQL constraint name, <code class="docutils literal"><span class="pre">sql_definition</span></code> is a <a class="reference external" href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html">table_constraint</a> expression,
and <code class="docutils literal"><span class="pre">message</span></code> is the error message.</p>
</div>
<div class="section" id="advanced-views">
<h2>Advanced Views<a class="headerlink" href="#advanced-views" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Tree views<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Tree views can take supplementary attributes to further customize their
behavior:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">decoration-{$name}</span></code></dt>
<dd><p class="first">allow changing the style of a row’s text based on the corresponding
record’s attributes.</p>
<p>Values are Python expressions. For each record, the expression is evaluated
with the record’s attributes as context values and if <code class="docutils literal"><span class="pre">true</span></code>, the
corresponding style is applied to the row. Other context values are
<code class="docutils literal"><span class="pre">uid</span></code> (the id of the current user) and <code class="docutils literal"><span class="pre">current_date</span></code> (the current date
as a string of the form <code class="docutils literal"><span class="pre">yyyy-MM-dd</span></code>).</p>
<p><code class="docutils literal"><span class="pre">{$name}</span></code> can be <code class="docutils literal"><span class="pre">bf</span></code> (<code class="docutils literal"><span class="pre">font-weight:</span> <span class="pre">bold</span></code>), <code class="docutils literal"><span class="pre">it</span></code>
(<code class="docutils literal"><span class="pre">font-style:</span> <span class="pre">italic</span></code>), or any <a class="reference external" href="http://getbootstrap.com/components/#available-variations">bootstrap contextual color</a> (<code class="docutils literal"><span class="pre">danger</span></code>,
<code class="docutils literal"><span class="pre">info</span></code>, <code class="docutils literal"><span class="pre">muted</span></code>, <code class="docutils literal"><span class="pre">primary</span></code>, <code class="docutils literal"><span class="pre">success</span></code> or <code class="docutils literal"><span class="pre">warning</span></code>).</p>
<div class="last highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Idea Categories&quot;</span> <span class="na">decoration-info=</span><span class="s">&quot;state==&#39;draft&#39;&quot;</span>
    <span class="na">decoration-danger=</span><span class="s">&quot;state==&#39;trashed&#39;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal"><span class="pre">editable</span></code></dt>
<dd>Either <code class="docutils literal"><span class="pre">&quot;top&quot;</span></code> or <code class="docutils literal"><span class="pre">&quot;bottom&quot;</span></code>. Makes the tree view editable in-place
(rather than having to go through the form view), the value is the
position where new rows appear.</dd>
</dl>
</div>
<div class="section" id="calendars">
<h3>Calendars<a class="headerlink" href="#calendars" title="Permalink to this headline">¶</a></h3>
<p>Displays records as calendar events. Their root element is <code class="docutils literal"><span class="pre">&lt;calendar&gt;</span></code> and
their most common attributes are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">color</span></code></dt>
<dd>The name of the field used for <em>color segmentation</em>. Colors are
automatically distributed to events, but events in the same color segment
(records which have the same value for their <code class="docutils literal"><span class="pre">&#64;color</span></code> field) will be
given the same color.</dd>
<dt><code class="docutils literal"><span class="pre">date_start</span></code></dt>
<dd>record’s field holding the start date/time for the event</dd>
<dt><code class="docutils literal"><span class="pre">date_stop</span></code> (optional)</dt>
<dd>record’s field holding the end date/time for the event</dd>
</dl>
<p>field (to define the label for each calendar event)</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;calendar</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span> <span class="na">date_start=</span><span class="s">&quot;invent_date&quot;</span> <span class="na">color=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/calendar&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Search views<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Search view <code class="docutils literal"><span class="pre">&lt;field&gt;</span></code> elements can have a <code class="docutils literal"><span class="pre">&#64;filter_domain</span></code> that overrides
the domain generated for searching on the given field. In the given domain,
<code class="docutils literal"><span class="pre">self</span></code> represents the value entered by the user. In the example below, it is
used to search on both fields <code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">description</span></code>.</p>
<p>Search views can also contain <code class="docutils literal"><span class="pre">&lt;filter&gt;</span></code> elements, which act as toggles for
predefined searches. Filters must have one of the following attributes:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">domain</span></code></dt>
<dd>add the given domain to the current search</dd>
<dt><code class="docutils literal"><span class="pre">context</span></code></dt>
<dd>add some context to the current search; use the key <code class="docutils literal"><span class="pre">group_by</span></code> to group
results on the given field name</dd>
</dl>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;search</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">string=</span><span class="s">&quot;Name and description&quot;</span>
           <span class="na">filter_domain=</span><span class="s">&quot;[&#39;|&#39;, (&#39;name&#39;, &#39;ilike&#39;, self), (&#39;description&#39;, &#39;ilike&#39;, self)]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;country_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;my_ideas&quot;</span> <span class="na">string=</span><span class="s">&quot;My Ideas&quot;</span>
            <span class="na">domain=</span><span class="s">&quot;[(&#39;inventor_id&#39;, &#39;=&#39;, uid)]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;Group By&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;group_by_inventor&quot;</span> <span class="na">string=</span><span class="s">&quot;Inventor&quot;</span>
                <span class="na">context=</span><span class="s">&quot;{&#39;group_by&#39;: &#39;inventor_id&#39;}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
</div>
<p>To use a non-default search view in an action, it should be linked using the
<code class="docutils literal"><span class="pre">search_view_id</span></code> field of the action record.</p>
<p>The action can also set default values for search fields through its
<code class="docutils literal"><span class="pre">context</span></code> field: context keys of the form
<code class="samp docutils literal"><span class="pre">search_default_</span><em><span class="pre">field_name</span></em></code> will initialize <em>field_name</em> with the
provided value. Search filters must have an optional <code class="docutils literal"><span class="pre">&#64;name</span></code> to have a
default and behave as booleans (they can only be enabled by default).</p>
</div>
<div class="section" id="gantt">
<h3>Gantt<a class="headerlink" href="#gantt" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The gantt view requires the web_gantt module which is present in
<a class="reference internal" href="../setup/install.html#setup-install-editions"><span class="std std-ref">the enterprise edition</span></a> version.</p>
</div>
<p>Horizontal bar charts typically used to show project planning and advancement,
their root element is <code class="docutils literal"><span class="pre">&lt;gantt&gt;</span></code>.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;gantt</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span>
       <span class="na">date_start=</span><span class="s">&quot;invent_date&quot;</span>
       <span class="na">date_stop=</span><span class="s">&quot;date_finished&quot;</span>
       <span class="na">progress=</span><span class="s">&quot;progress&quot;</span>
       <span class="na">default_group_by=</span><span class="s">&quot;inventor_id&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="graph-views">
<h3>Graph views<a class="headerlink" href="#graph-views" title="Permalink to this headline">¶</a></h3>
<p>Graph views allow aggregated overview and analysis of models, their root
element is <code class="docutils literal"><span class="pre">&lt;graph&gt;</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pivot views (element <code class="docutils literal"><span class="pre">&lt;pivot&gt;</span></code>) a multidimensional table, allows the
selection of filers and dimensions to get the right aggregated dataset
before moving to a more graphical overview. The pivot view shares the same
content definition as graph views.</p>
</div>
<p>Graph views have 4 display modes, the default mode is selected using the
<code class="docutils literal"><span class="pre">&#64;type</span></code> attribute.</p>
<dl class="docutils">
<dt>Bar (default)</dt>
<dd><p class="first">a bar chart, the first dimension is used to define groups on the
horizontal axis, other dimensions define aggregated bars within each group.</p>
<p class="last">By default bars are side-by-side, they can be stacked by using
<code class="docutils literal"><span class="pre">&#64;stacked=&quot;True&quot;</span></code> on the <code class="docutils literal"><span class="pre">&lt;graph&gt;</span></code></p>
</dd>
<dt>Line</dt>
<dd>2-dimensional line chart</dd>
<dt>Pie</dt>
<dd>2-dimensional pie</dd>
</dl>
<p>Graph views contain <code class="docutils literal"><span class="pre">&lt;field&gt;</span></code> with a mandatory <code class="docutils literal"><span class="pre">&#64;type</span></code> attribute taking
the values:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">row</span></code> (default)</dt>
<dd>the field should be aggregated by default</dd>
<dt><code class="docutils literal"><span class="pre">measure</span></code></dt>
<dd>the field should be aggregated rather than grouped on</dd>
</dl>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;graph</span> <span class="na">string=</span><span class="s">&quot;Total idea score by Inventor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;score&quot;</span> <span class="na">type=</span><span class="s">&quot;measure&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/graph&gt;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Graph views perform aggregations on database values, they do not work
with non-stored computed fields.</p>
</div>
</div>
<div class="section" id="kanban">
<h3>Kanban<a class="headerlink" href="#kanban" title="Permalink to this headline">¶</a></h3>
<p>Used to organize tasks, production processes, etc… their root element is
<code class="docutils literal"><span class="pre">&lt;kanban&gt;</span></code>.</p>
<p>A kanban view shows a set of cards possibly grouped in columns. Each card
represents a record, and each column the values of an aggregation field.</p>
<p>For instance, project tasks may be organized by stage (each column is a
stage), or by responsible (each column is a user), and so on.</p>
<p>Kanban views define the structure of each card as a mix of form elements
(including basic HTML) and <a class="reference internal" href="../reference/qweb.html#reference-qweb"><span class="std std-ref">QWeb</span></a>.</p>
</div>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>Access control mechanisms must be configured to achieve a coherent security
policy.</p>
<div class="section" id="group-based-access-control-mechanisms">
<h3>Group-based access control mechanisms<a class="headerlink" href="#group-based-access-control-mechanisms" title="Permalink to this headline">¶</a></h3>
<p>Groups are created as normal records on the model <code class="docutils literal"><span class="pre">res.groups</span></code>, and granted
menu access via menu definitions. However even without a menu, objects may
still be accessible indirectly, so actual object-level permissions (read,
write, create, unlink) must be defined for groups. They are usually inserted
via CSV files inside modules. It is also possible to restrict access to
specific fields on a view or object using the field’s groups attribute.</p>
</div>
<div class="section" id="access-rights">
<h3>Access rights<a class="headerlink" href="#access-rights" title="Permalink to this headline">¶</a></h3>
<p>Access rights are defined as records of the model <code class="docutils literal"><span class="pre">ir.model.access</span></code>. Each
access right is associated to a model, a group (or no group for global
access), and a set of permissions: read, write, create, unlink. Such access
rights are usually created by a CSV file named after its model:
<code class="docutils literal"><span class="pre">ir.model.access.csv</span></code>.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_idea_idea,idea.idea,model_idea_idea,base.group_user,1,1,1,0
access_idea_vote,idea.vote,model_idea_vote,base.group_user,1,1,1,0
</pre></div>
</div>
</div>
<div class="section" id="record-rules">
<h3>Record rules<a class="headerlink" href="#record-rules" title="Permalink to this headline">¶</a></h3>
<p>A record rule restricts the access rights to a subset of records of the given
model. A rule is a record of the model <code class="docutils literal"><span class="pre">ir.rule</span></code>, and is associated to a
model, a number of groups (many2many field), permissions to which the
restriction applies, and a domain. The domain specifies to which records the
access rights are limited.</p>
<p>Here is an example of a rule that prevents the deletion of leads that are not
in state <code class="docutils literal"><span class="pre">cancel</span></code>. Notice that the value of the field <code class="docutils literal"><span class="pre">groups</span></code> must follow
the same convention as the method <code class="xref py py-meth docutils literal"><span class="pre">write()</span></code> of the ORM.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;delete_cancelled_only&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Only cancelled leads may be deleted<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;crm.model_crm_lead&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span> <span class="na">eval=</span><span class="s">&quot;[(4, ref(&#39;sales_team.group_sale_manager&#39;))]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_read&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_write&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_create&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_unlink&quot;</span> <span class="na">eval=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;domain_force&quot;</span><span class="nt">&gt;</span>[(&#39;state&#39;,&#39;=&#39;,&#39;cancel&#39;)]<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="wizards">
<h2>Wizards<a class="headerlink" href="#wizards" title="Permalink to this headline">¶</a></h2>
<p>Wizards describe interactive sessions with the user (or dialog boxes) through
dynamic forms. A wizard is simply a model that extends the class
<code class="xref py py-class docutils literal"><span class="pre">TransientModel</span></code> instead of
<code class="xref py py-class docutils literal"><span class="pre">Model</span></code>. The class
<code class="xref py py-class docutils literal"><span class="pre">TransientModel</span></code> extends <code class="xref py py-class docutils literal"><span class="pre">Model</span></code>
and reuse all its existing mechanisms, with the following particularities:</p>
<ul class="simple">
<li>Wizard records are not meant to be persistent; they are automatically deleted
from the database after a certain time. This is why they are called
<em>transient</em>.</li>
<li>Wizard models do not require explicit access rights: users have all
permissions on wizard records.</li>
<li>Wizard records may refer to regular records or wizard records through many2one
fields, but regular records <em>cannot</em> refer to wizard records through a
many2one field.</li>
</ul>
<p>We want to create a wizard that allow users to create attendees for a particular
session, or for a list of sessions at once.</p>
<div class="section" id="launching-wizards">
<h3>Launching wizards<a class="headerlink" href="#launching-wizards" title="Permalink to this headline">¶</a></h3>
<p>Wizards are launched by <code class="docutils literal"><span class="pre">ir.actions.act_window</span></code> records, with the field
<code class="docutils literal"><span class="pre">target</span></code> set to the value <code class="docutils literal"><span class="pre">new</span></code>. The latter opens the wizard view into a
popup window. The action may be triggered by a menu item.</p>
<p>There is another way to launch the wizard: using an <code class="docutils literal"><span class="pre">ir.actions.act_window</span></code>
record like above, but with an extra field <code class="docutils literal"><span class="pre">src_model</span></code> that specifies in the
context of which model the action is available. The wizard will appear in the
contextual actions of the model, above the main view. Because of some internal
hooks in the ORM, such an action is declared in XML with the tag <code class="docutils literal"><span class="pre">act_window</span></code>.</p>
<div class="code xml highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">act_window</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;launch_the_wizard&quot;</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Launch the Wizard&quot;</span>
            <span class="n">src_model</span><span class="o">=</span><span class="s2">&quot;context.model.name&quot;</span>
            <span class="n">res_model</span><span class="o">=</span><span class="s2">&quot;wizard.model.name&quot;</span>
            <span class="n">view_mode</span><span class="o">=</span><span class="s2">&quot;form&quot;</span>
            <span class="n">target</span><span class="o">=</span><span class="s2">&quot;new&quot;</span>
            <span class="n">key2</span><span class="o">=</span><span class="s2">&quot;client_action_multi&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>Wizards use regular views and their buttons may use the attribute
<code class="docutils literal"><span class="pre">special=&quot;cancel&quot;</span></code> to close the wizard window without saving.</p>
</div>
</div>
<div class="section" id="internationalization">
<h2>Internationalization<a class="headerlink" href="#internationalization" title="Permalink to this headline">¶</a></h2>
<p>Each module can provide its own translations within the i18n directory, by
having files named LANG.po where LANG is the locale code for the language, or
the language and country combination when they differ (e.g. pt.po or
pt_BR.po). Translations will be loaded automatically by Gerp for all
enabled languages. Developers always use English when creating a module, then
export the module terms using Gerp’s gettext POT export feature
(<span class="menuselection">Settings ‣ Translations ‣ Import/Export ‣ Export
Translation</span> without specifying a language), to create the module template POT
file, and then derive the translated PO files. Many IDE’s have plugins or modes
for editing and merging PO/POT files.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The Portable Object files generated by Gerp are published on
<a class="reference external" href="https://www.transifex.com/gerp/public/">Transifex</a>, making it
easy to translate the software.</p>
</div>
<div class="highlight-text"><div class="highlight"><pre><span></span>|- idea/ # The module directory
   |- i18n/ # Translation files
      | - idea.pot # Translation Template (exported from Gerp)
      | - fr.po # French translation
      | - pt_BR.po # Brazilian Portuguese translation
      | (...)
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">By default Gerp’s POT export only extracts labels inside XML files or
inside field definitions in Python code, but any Python string can be
translated this way by surrounding it with the function <code class="xref py py-func docutils literal"><span class="pre">gerp._()</span></code>
(e.g. <code class="docutils literal"><span class="pre">_(&quot;Label&quot;)</span></code>)</p>
</div>
</div>
<div class="section" id="reporting">
<h2>Reporting<a class="headerlink" href="#reporting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="printed-reports">
<h3>Printed reports<a class="headerlink" href="#printed-reports" title="Permalink to this headline">¶</a></h3>
<p>Gerp 11.0 uses a report engine based on <a class="reference internal" href="../reference/qweb.html#reference-qweb"><span class="std std-ref">QWeb</span></a>,
<a class="reference external" href="http://getbootstrap.com">Twitter Bootstrap</a> and <a class="reference external" href="http://wkhtmltopdf.org">Wkhtmltopdf</a>.</p>
<p>A report is a combination two elements:</p>
<ul>
<li><p class="first">an <code class="docutils literal"><span class="pre">ir.actions.report</span></code>, for which a <code class="docutils literal"><span class="pre">&lt;report&gt;</span></code> shortcut element is
provided, it sets up various basic parameters for the report (default
type, whether the report should be saved to the database after generation,…)</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;report</span>
    <span class="na">id=</span><span class="s">&quot;account_invoices&quot;</span>
    <span class="na">model=</span><span class="s">&quot;account.invoice&quot;</span>
    <span class="na">string=</span><span class="s">&quot;Invoices&quot;</span>
    <span class="na">report_type=</span><span class="s">&quot;qweb-pdf&quot;</span>
    <span class="na">name=</span><span class="s">&quot;account.report_invoice&quot;</span>
    <span class="na">file=</span><span class="s">&quot;account.report_invoice&quot;</span>
    <span class="na">attachment_use=</span><span class="s">&quot;True&quot;</span>
    <span class="na">attachment=</span><span class="s">&quot;(object.state in (&#39;open&#39;,&#39;paid&#39;)) and</span>
<span class="s">        (&#39;INV&#39;+(object.number or &#39;&#39;).replace(&#39;/&#39;,&#39;&#39;)+&#39;.pdf&#39;)&quot;</span>
<span class="nt">/&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">A standard <a class="reference internal" href="../reference/views.html#reference-views-qweb"><span class="std std-ref">QWeb view</span></a> for the actual report:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;web.html_container&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;docs&quot;</span> <span class="na">t-as=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;web.external_layout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>Report title<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/t&gt;</span>

the standard rendering context provides a number of elements, the most
important being:

``docs``
    the records for which the report is printed
``user``
    the user printing the report
</pre></div>
</div>
</li>
</ul>
<p>Because reports are standard web pages, they are available through a URL and
output parameters can be manipulated through this URL, for instance the HTML
version of the <em>Invoice</em> report is available through
<a class="reference external" href="http://localhost:8069/report/html/account.report_invoice/1">http://localhost:8069/report/html/account.report_invoice/1</a> (if <code class="docutils literal"><span class="pre">account</span></code> is
installed) and the PDF version through
<a class="reference external" href="http://localhost:8069/report/pdf/account.report_invoice/1">http://localhost:8069/report/pdf/account.report_invoice/1</a>.</p>
<div class="admonition danger" id="reference-backend-reporting-printed-reports-pdf-without-styles">
<p class="first admonition-title">Danger</p>
<p>If it appears that your PDF report is missing the styles (i.e. the text
appears but the style/layout is different from the html version), probably
your <a class="reference external" href="http://wkhtmltopdf.org">wkhtmltopdf</a> process cannot reach your web server to download them.</p>
<p>If you check your server logs and see that the CSS styles are not being
downloaded when generating a PDF report, most surely this is the problem.</p>
<p>The <a class="reference external" href="http://wkhtmltopdf.org">wkhtmltopdf</a> process will use the <code class="docutils literal"><span class="pre">web.base.url</span></code> system parameter as
the <em>root path</em> to all linked files, but this parameter is automatically
updated each time the Administrator is logged in. If your server resides
behind some kind of proxy, that could not be reachable. You can fix this by
adding one of these system parameters:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">report.url</span></code>, pointing to an URL reachable from your server
(probably <code class="docutils literal"><span class="pre">http://localhost:8069</span></code> or something similar). It will be
used for this particular purpose only.</li>
<li><code class="docutils literal"><span class="pre">web.base.url.freeze</span></code>, when set to <code class="docutils literal"><span class="pre">True</span></code>, will stop the
automatic updates to <code class="docutils literal"><span class="pre">web.base.url</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="dashboards">
<h3>Dashboards<a class="headerlink" href="#dashboards" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="webservices">
<h2>WebServices<a class="headerlink" href="#webservices" title="Permalink to this headline">¶</a></h2>
<p>The web-service module offer a common interface for all web-services :</p>
<ul class="simple">
<li>XML-RPC</li>
<li>JSON-RPC</li>
</ul>
<p>Business objects can also be accessed via the distributed object
mechanism. They can all be modified via the client interface with contextual
views.</p>
<p>Gerp is accessible through XML-RPC/JSON-RPC interfaces, for which libraries
exist in many languages.</p>
<div class="section" id="xml-rpc-library">
<h3>XML-RPC Library<a class="headerlink" href="#xml-rpc-library" title="Permalink to this headline">¶</a></h3>
<p>The following example is a Python 3 program that interacts with an Gerp
server with the library <code class="docutils literal"><span class="pre">xmlrpc.client</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xmlrpc.client</span>

<span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;http://</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">/xmlrpc/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="n">uid</span> <span class="o">=</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;common&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logged in as </span><span class="si">%s</span><span class="s2"> (uid: </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">USER</span><span class="p">,</span> <span class="n">uid</span><span class="p">))</span>

<span class="c1"># Create a new note</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">xmlrpc</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;memo&#39;</span> <span class="p">:</span> <span class="s1">&#39;This is a note&#39;</span><span class="p">,</span>
    <span class="s1">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s1">&#39;note.note&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="json-rpc-library">
<h3>JSON-RPC Library<a class="headerlink" href="#json-rpc-library" title="Permalink to this headline">¶</a></h3>
<p>The following example is a Python 3 program that interacts with an Gerp server
with the standard Python libraries <code class="docutils literal"><span class="pre">urllib.request</span></code> and <code class="docutils literal"><span class="pre">json</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="k">def</span> <span class="nf">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reply</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span><span class="p">})</span>

<span class="c1"># log in the given database</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">/jsonrpc&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;common&quot;</span><span class="p">,</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>

<span class="c1"># create a new note</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s1">&#39;memo&#39;</span><span class="p">:</span> <span class="s1">&#39;This is another note&#39;</span><span class="p">,</span>
    <span class="s1">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;execute&quot;</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s1">&#39;note.note&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>Examples can be easily adapted from XML-RPC to JSON-RPC.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>There are a number of high-level APIs in various languages to access Gerp
systems without <em>explicitly</em> going through XML-RPC or JSON-RPC, such as:</p>
<ul class="last simple">
<li><a class="reference external" href="https://github.com/akretion/ooor">https://github.com/akretion/ooor</a></li>
<li><a class="reference external" href="https://github.com/syleam/openobject-library">https://github.com/syleam/openobject-library</a></li>
<li><a class="reference external" href="https://github.com/nicolas-van/openerp-client-lib">https://github.com/nicolas-van/openerp-client-lib</a></li>
<li><a class="reference external" href="http://pythonhosted.org/GerpRPC">http://pythonhosted.org/GerpRPC</a></li>
<li><a class="reference external" href="https://github.com/abhishek-jaiswal/php-openerp-lib">https://github.com/abhishek-jaiswal/php-openerp-lib</a></li>
</ul>
</div>
<table class="docutils footnote" frame="void" id="autofields" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>it is possible to <code class="xref py py-attr docutils literal"><span class="pre">disable</span> <span class="pre">the</span> <span class="pre">automatic</span> <span class="pre">creation</span> <span class="pre">of</span> <span class="pre">some</span>
<span class="pre">fields</span></code></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="rawsql" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[2]</a></td><td>writing raw SQL queries is possible, but requires care as it
bypasses all Gerp authentication and security mechanisms.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Gahan Corporation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/howtos/backend.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>