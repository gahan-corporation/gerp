
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Javascript &#8212; gerp v0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'v0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="javascript">
<h1>Javascript<a class="headerlink" href="#javascript" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="widgets">
<h1>Widgets<a class="headerlink" href="#widgets" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Widget">
<em class="property">class </em><code class="descname">Widget</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget" title="Permalink to this definition">¶</a></dt>
<dd><p>Exported in <code class="docutils literal"><span class="pre">web.Widget</span></code>, the base class for all visual components.
It corresponds to an MVC view, and provides a number of service to
simplify handling of a section of a page:</p>
<ul class="simple">
<li>Handles parent/child relationships between widgets</li>
<li>Provides extensive lifecycle management with safety features (e.g.
automatically destroying children widgets during the destruction of a
parent)</li>
<li>Automatic rendering with <a class="reference internal" href="qweb.html#reference-qweb"><span class="std std-ref">qweb</span></a></li>
<li>Backbone-compatible shortcuts</li>
</ul>
</dd></dl>

<div class="section" id="dom-root">
<h2>DOM Root<a class="headerlink" href="#dom-root" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="#Widget" title="Widget"><code class="xref js js-class docutils literal"><span class="pre">Widget()</span></code></a> is responsible for a section of the page
materialized by the DOM root of the widget.</p>
<p>A widget’s DOM root is available via two attributes:</p>
<dl class="attribute">
<dt id="Widget.el">
<code class="descclassname">Widget.</code><code class="descname">el</code><a class="headerlink" href="#Widget.el" title="Permalink to this definition">¶</a></dt>
<dd><p>raw DOM element set as root to the widget</p>
</dd></dl>

<dl class="attribute">
<dt id="Widget._S_el">
<code class="descclassname">Widget.</code><code class="descname">$el</code><a class="headerlink" href="#Widget._S_el" title="Permalink to this definition">¶</a></dt>
<dd><p>jQuery wrapper around <a class="reference internal" href="#Widget.el" title="Widget.el"><code class="xref js js-attr docutils literal"><span class="pre">el</span></code></a></p>
</dd></dl>

<p>There are two main ways to define and generate this DOM root:</p>
<dl class="attribute">
<dt id="Widget.template">
<code class="descclassname">Widget.</code><code class="descname">template</code><a class="headerlink" href="#Widget.template" title="Permalink to this definition">¶</a></dt>
<dd><p>Should be set to the name of a <a class="reference internal" href="qweb.html#reference-qweb"><span class="std std-ref">QWeb template</span></a>.
If set, the template will be rendered after the widget has been
initialized but before it has been started. The root element generated by
the template will be set as the DOM root of the widget.</p>
</dd></dl>

<dl class="attribute">
<dt id="Widget.tagName">
<code class="descclassname">Widget.</code><code class="descname">tagName</code><a class="headerlink" href="#Widget.tagName" title="Permalink to this definition">¶</a></dt>
<dd><p>Used if the widget has no template defined. Defaults to <code class="docutils literal"><span class="pre">div</span></code>,
will be used as the tag name to create the DOM element to set as
the widget’s DOM root. It is possible to further customize this
generated DOM root with the following attributes:</p>
<dl class="attribute">
<dt id="Widget.Widget.id">
<code class="descclassname">Widget.Widget.</code><code class="descname">id</code><a class="headerlink" href="#Widget.Widget.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to generate an <code class="docutils literal"><span class="pre">id</span></code> attribute on the generated DOM
root.</p>
</dd></dl>

<dl class="attribute">
<dt id="Widget.className">
<code class="descclassname">Widget.</code><code class="descname">className</code><a class="headerlink" href="#Widget.className" title="Permalink to this definition">¶</a></dt>
<dd><p>Used to generate a <code class="docutils literal"><span class="pre">class</span></code> attribute on the generated DOM root.</p>
</dd></dl>

<dl class="attribute">
<dt id="Widget.attributes">
<code class="descclassname">Widget.</code><code class="descname">attributes</code><a class="headerlink" href="#Widget.attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Mapping (object literal) of attribute names to attribute
values. Each of these k:v pairs will be set as a DOM attribute
on the generated DOM root.</p>
</dd></dl>

<p>None of these is used in case a template is specified on the widget.</p>
</dd></dl>

<p>The DOM root can also be defined programmatically by overridding</p>
<dl class="function">
<dt id="Widget.renderElement">
<code class="descclassname">Widget.</code><code class="descname">renderElement</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.renderElement" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the widget’s DOM root and sets it. The default
implementation will render a set template or generate an element
as described above, and will call
<a class="reference internal" href="#Widget.setElement" title="Widget.setElement"><code class="xref js js-func docutils literal"><span class="pre">setElement()</span></code></a> on the result.</p>
<p>Any override to <a class="reference internal" href="#Widget.renderElement" title="Widget.renderElement"><code class="xref js js-func docutils literal"><span class="pre">renderElement()</span></code></a> which
does not call its <code class="docutils literal"><span class="pre">_super</span></code> <strong>must</strong> call
<a class="reference internal" href="#Widget.setElement" title="Widget.setElement"><code class="xref js js-func docutils literal"><span class="pre">setElement()</span></code></a> with whatever it
generated or the widget’s behavior is undefined.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default <a class="reference internal" href="#Widget.renderElement" title="Widget.renderElement"><code class="xref js js-func docutils literal"><span class="pre">renderElement()</span></code></a> can
be called repeatedly, it will <em>replace</em> the previous DOM root
(using <code class="docutils literal"><span class="pre">replaceWith</span></code>). However, this requires that the
widget correctly sets and unsets its events (and children
widgets). Generally, <a class="reference internal" href="#Widget.renderElement" title="Widget.renderElement"><code class="xref js js-func docutils literal"><span class="pre">renderElement()</span></code></a> should
not be called repeatedly unless the widget advertizes this feature.</p>
</div>
</dd></dl>

<div class="section" id="using-a-widget">
<h3>Using a widget<a class="headerlink" href="#using-a-widget" title="Permalink to this headline">¶</a></h3>
<p>A widget’s lifecycle has 3 main phases:</p>
<ul>
<li><p class="first">creation and initialization of the widget instance</p>
<dl class="function">
<dt id="Widget.init">
<code class="descclassname">Widget.</code><code class="descname">init</code><span class="sig-paren">(</span><em>parent</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget.init" title="Permalink to this definition">¶</a></dt>
<dd><p>initialization method of widgets, synchronous, can be overridden to
take more parameters from the widget’s creator/parent</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>parent</strong> (<a class="reference internal" href="#Widget" title="Widget"><code class="xref js js-class docutils literal"><span class="pre">Widget()</span></code></a>) – the new widget’s parent, used to handle automatic
destruction and event propagation. Can be <code class="docutils literal"><span class="pre">null</span></code> for
the widget to have no parent.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</li>
<li><p class="first">DOM injection and startup, this is done by calling one of:</p>
<dl class="function">
<dt id="Widget.appendTo">
<code class="descclassname">Widget.</code><code class="descname">appendTo</code><span class="sig-paren">(</span><em>element</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget.appendTo" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the widget and inserts it as the last child of the target, uses
<a class="reference external" href="http://api.jquery.com/appendTo/">.appendTo()</a></p>
</dd></dl>

<dl class="function">
<dt id="Widget.prependTo">
<code class="descclassname">Widget.</code><code class="descname">prependTo</code><span class="sig-paren">(</span><em>element</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget.prependTo" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the widget and inserts it as the first child of the target, uses
<a class="reference external" href="http://api.jquery.com/prependTo/">.prependTo()</a></p>
</dd></dl>

<dl class="function">
<dt id="Widget.insertAfter">
<code class="descclassname">Widget.</code><code class="descname">insertAfter</code><span class="sig-paren">(</span><em>element</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget.insertAfter" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the widget and inserts it as the preceding sibling of the target,
uses <a class="reference external" href="http://api.jquery.com/insertAfter/">.insertAfter()</a></p>
</dd></dl>

<dl class="function">
<dt id="Widget.insertBefore">
<code class="descclassname">Widget.</code><code class="descname">insertBefore</code><span class="sig-paren">(</span><em>element</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget.insertBefore" title="Permalink to this definition">¶</a></dt>
<dd><p>Renders the widget and inserts it as the following sibling of the target,
uses <a class="reference external" href="http://api.jquery.com/insertBefore/">.insertBefore()</a></p>
</dd></dl>

<p>All of these methods accept whatever the corresponding jQuery method accepts
(CSS selectors, DOM nodes or jQuery objects). They all return a <a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a>
and are charged with three tasks:</p>
<ul>
<li><p class="first">rendering the widget’s root element via
<a class="reference internal" href="#Widget.renderElement" title="Widget.renderElement"><code class="xref js js-func docutils literal"><span class="pre">renderElement()</span></code></a></p>
</li>
<li><p class="first">inserting the widget’s root element in the DOM using whichever jQuery
method they match</p>
</li>
<li><p class="first">starting the widget, and returning the result of starting it</p>
<dl class="function">
<dt id="Widget.start">
<code class="descclassname">Widget.</code><code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.start" title="Permalink to this definition">¶</a></dt>
<dd><p>asynchronous startup of the widget once it’s been injected in the DOM,
generally used to perform asynchronous RPC calls to fetch whatever
remote data is necessary for the widget to do its work.</p>
<p>Must return a <a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a> to indicate when its work is done.</p>
<p>A widget is <em>not guaranteed</em> to work correctly until its
<a class="reference internal" href="#Widget.start" title="Widget.start"><code class="xref js js-func docutils literal"><span class="pre">start()</span></code></a> method has finished executing. The
widget’s parent/creator must wait for a widget to be fully started
before interacting with it</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a> object</td>
</tr>
</tbody>
</table>
</dd></dl>

</li>
</ul>
</li>
<li><p class="first">widget destruction and cleanup</p>
<dl class="function">
<dt id="Widget.destroy">
<code class="descclassname">Widget.</code><code class="descname">destroy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.destroy" title="Permalink to this definition">¶</a></dt>
<dd><p>destroys the widget’s children, unbinds its events and removes its root
from the DOM. Automatically called when the widget’s parent is destroyed,
must be called explicitly if the widget has no parents or if it is
removed but its parent remains.</p>
<p>A widget being destroyed is automatically unlinked from its parent.</p>
</dd></dl>

</li>
</ul>
<p>Related to widget destruction is an important utility method:</p>
<dl class="function">
<dt id="Widget.alive">
<code class="descclassname">Widget.</code><code class="descname">alive</code><span class="sig-paren">(</span><em>deferred</em><span class="optional">[</span>, <em>reject=false</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.alive" title="Permalink to this definition">¶</a></dt>
<dd><p>A significant issue with RPC and destruction is that an RPC call may take
a long time to execute and return while a widget is being destroyed or
after it has been destroyed, trying to execute its operations on a widget
in a broken/invalid state.</p>
<p>This is a frequent source of errors or strange behaviors.</p>
<p><a class="reference internal" href="#Widget.alive" title="Widget.alive"><code class="xref js js-func docutils literal"><span class="pre">alive()</span></code></a> can be used to wrap an RPC call,
ensuring that whatever operations should be executed when the call ends
are only executed if the widget is still alive:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">alive</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">all</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// would break if executed after the widget is destroyed, wrapping</span>
    <span class="c1">// rpc in alive() prevents execution</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">records</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">record</span><span class="p">));</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>deferred</strong> – a <a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a> object to wrap</li>
<li><strong>reject</strong> – by default, if the RPC call returns after the widget has
been destroyed the returned <a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a> is left in limbo
(neither resolved nor rejected). If <code class="docutils literal"><span class="pre">reject</span></code> is set to
<code class="docutils literal"><span class="pre">true</span></code>, the <a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a> will be rejected instead.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference external" href="http://api.jquery.com/category/deferred-object/">deferred</a> object</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Widget.isDestroyed">
<code class="descclassname">Widget.</code><code class="descname">isDestroyed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.isDestroyed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal"><span class="pre">true</span></code> if the widget is being or has been destroyed, <code class="docutils literal"><span class="pre">false</span></code>
otherwise</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="accessing-dom-content">
<h3>Accessing DOM content<a class="headerlink" href="#accessing-dom-content" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Because a widget is only responsible for the content below its DOM root, there</dt>
<dd>is a shortcut for selecting sub-sections of a widget’s DOM:</dd>
</dl>
<dl class="function">
<dt id="Widget._S_">
<code class="descclassname">Widget.</code><code class="descname">$</code><span class="sig-paren">(</span><em>selector</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget._S_" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies the CSS selector specified as parameter to the widget’s
DOM root:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</pre></div>
</div>
<p>is functionally identical to:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>selector</strong> (<em>String</em>) – CSS selector</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">jQuery object</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this helper method is similar to <code class="docutils literal"><span class="pre">Backbone.View.$</span></code></p>
</div>
</dd></dl>

</div>
<div class="section" id="resetting-the-dom-root">
<h3>Resetting the DOM root<a class="headerlink" href="#resetting-the-dom-root" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="Widget.setElement">
<code class="descclassname">Widget.</code><code class="descname">setElement</code><span class="sig-paren">(</span><em>element</em><span class="sig-paren">)</span><a class="headerlink" href="#Widget.setElement" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-sets the widget’s DOM root to the provided element, also
handles re-setting the various aliases of the DOM root as well as
unsetting and re-setting delegated events.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>element</strong> (<em>Element</em>) – a DOM element or jQuery object to set as
the widget’s DOM root</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">should be mostly compatible with <a class="reference external" href="http://backbonejs.org/#View-setElement">Backbone’s
setElement</a></p>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="dom-events-handling">
<h2>DOM events handling<a class="headerlink" href="#dom-events-handling" title="Permalink to this headline">¶</a></h2>
<p>A widget will generally need to respond to user action within its
section of the page. This entails binding events to DOM elements.</p>
<p>To this end, <a class="reference internal" href="#Widget" title="Widget"><code class="xref js js-class docutils literal"><span class="pre">Widget()</span></code></a> provides a shortcut:</p>
<dl class="attribute">
<dt id="Widget.events">
<code class="descclassname">Widget.</code><code class="descname">events</code><a class="headerlink" href="#Widget.events" title="Permalink to this definition">¶</a></dt>
<dd><p>Events are a mapping of an event selector (an event name and an optional
CSS selector separated by a space) to a callback. The callback can
be the name of a widget’s method or a function object. In either case, the
<code class="docutils literal"><span class="pre">this</span></code> will be set to the widget:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click p.oe_some_class a&#39;</span><span class="o">:</span> <span class="s1">&#39;some_method&#39;</span><span class="p">,</span>
    <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
<p>The selector is used for jQuery’s <a class="reference external" href="http://api.jquery.com/delegate/">event delegation</a>, the
callback will only be triggered for descendants of the DOM root
matching the selector<a class="footnote-reference" href="#eventsdelegation" id="id1">[1]</a>. If the selector is left out
(only an event name is specified), the event will be set directly on the
widget’s DOM root.</p>
</dd></dl>

<dl class="function">
<dt id="Widget.delegateEvents">
<code class="descclassname">Widget.</code><code class="descname">delegateEvents</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.delegateEvents" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is in charge of binding <a class="reference internal" href="#Widget.events" title="Widget.events"><code class="xref js js-attr docutils literal"><span class="pre">events</span></code></a> to the
DOM. It is automatically called after setting the widget’s DOM root.</p>
<p>It can be overridden to set up more complex events than the
<a class="reference internal" href="#Widget.events" title="Widget.events"><code class="xref js js-attr docutils literal"><span class="pre">events</span></code></a> map allows, but the parent should always be
called (or <a class="reference internal" href="#Widget.events" title="Widget.events"><code class="xref js js-attr docutils literal"><span class="pre">events</span></code></a> won’t be handled correctly).</p>
</dd></dl>

<dl class="function">
<dt id="Widget.undelegateEvents">
<code class="descclassname">Widget.</code><code class="descname">undelegateEvents</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Widget.undelegateEvents" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is in charge of unbinding <a class="reference internal" href="#Widget.events" title="Widget.events"><code class="xref js js-attr docutils literal"><span class="pre">events</span></code></a> from
the DOM root when the widget is destroyed or the DOM root is reset, in
order to avoid leaving “phantom” events.</p>
<p>It should be overridden to un-set any event set in an override of
<a class="reference internal" href="#Widget.delegateEvents" title="Widget.delegateEvents"><code class="xref js js-func docutils literal"><span class="pre">delegateEvents()</span></code></a>.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this behavior should be compatible with <a class="reference external" href="http://backbonejs.org/#View-delegateEvents">Backbone’s
delegateEvents</a>, apart from not accepting any argument.</p>
</div>
</div>
<div class="section" id="subclassing-widget">
<h2>Subclassing Widget<a class="headerlink" href="#subclassing-widget" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#Widget" title="Widget"><code class="xref js js-class docutils literal"><span class="pre">Widget()</span></code></a> is subclassed in the standard manner (via the
<code class="xref js js-func docutils literal"><span class="pre">extend()</span></code> method), and provides a number of
abstract properties and concrete methods (which you may or may not want to
override). Creating a subclass looks like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="c1">// QWeb template to use when rendering the object</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;MyQWebTemplate&quot;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// events binding example</span>
        <span class="s1">&#39;click .my-button&#39;</span><span class="o">:</span> <span class="s1">&#39;handle_click&#39;</span><span class="p">,</span>
    <span class="p">},</span>

    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="c1">// insert code to execute before rendering, for object</span>
        <span class="c1">// initialization</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">sup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="c1">// post-rendering initialization code, at this point</span>

        <span class="c1">// allows multiplexing deferred objects</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span>
            <span class="c1">// propagate asynchronous signal from parent class</span>
            <span class="nx">sup</span><span class="p">,</span>
            <span class="c1">// return own&#39;s asynchronous signal</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">rpc</span><span class="p">(</span><span class="cm">/* … */</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The new class can then be used in the following manner:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Create the instance</span>
<span class="kd">var</span> <span class="nx">my_widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="c1">// Render and insert into DOM</span>
<span class="nx">my_widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;.some-div&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>After these two lines have executed (and any promise returned by
<a class="reference internal" href="#Widget.appendTo" title="Widget.appendTo"><code class="xref js js-func docutils literal"><span class="pre">appendTo()</span></code></a> has been resolved if needed), the widget is
ready to be used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>the insertion methods will start the widget themselves, and will
return the result of <a class="reference internal" href="#Widget.start" title="Widget.start"><code class="xref js js-func docutils literal"><span class="pre">start()</span></code></a>.</p>
<p class="last">If for some reason you do not want to call these methods, you will
have to first call <code class="xref js js-func docutils literal"><span class="pre">render()</span></code> on the
widget, then insert it into your DOM and start it.</p>
</div>
<p>If the widget is not needed anymore (because it’s transient), simply terminate
it:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">my_widget</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
</div>
<p>will unbind all DOM events, remove the widget’s content from the DOM and
destroy all widget data.</p>
</div>
<div class="section" id="development-guidelines">
<h2>Development Guidelines<a class="headerlink" href="#development-guidelines" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Identifiers (<code class="docutils literal"><span class="pre">id</span></code> attribute) should be avoided. In generic applications
and modules, <code class="docutils literal"><span class="pre">id</span></code> limits the re-usability of components and tends to make
code more brittle. Most of the time, they can be replaced with nothing,
classes or keeping a reference to a DOM node or jQuery element.</p>
<p>If an <code class="docutils literal"><span class="pre">id</span></code> is absolutely necessary (because a third-party library requires
one), the id should be partially generated using <code class="docutils literal"><span class="pre">_.uniqueId()</span></code> e.g.:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">(</span><span class="s1">&#39;my-widget-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Avoid predictable/common CSS class names. Class names such as “content” or
“navigation” might match the desired meaning/semantics, but it is likely an
other developer will have the same need, creating a naming conflict and
unintended behavior. Generic class names should be prefixed with e.g. the
name of the component they belong to (creating “informal” namespaces, much
as in C or Objective-C).</p>
</li>
<li><p class="first">Global selectors should be avoided. Because a component may be used several
times in a single page (an example in Odoo is dashboards), queries should be
restricted to a given component’s scope. Unfiltered selections such as
<code class="docutils literal"><span class="pre">$(selector)</span></code> or <code class="docutils literal"><span class="pre">document.querySelectorAll(selector)</span></code> will generally
lead to unintended or incorrect behavior.  Odoo Web’s
<a class="reference internal" href="#Widget" title="Widget"><code class="xref js js-class docutils literal"><span class="pre">Widget()</span></code></a> has an attribute providing its DOM root
(<a class="reference internal" href="#Widget._S_el" title="Widget.$el"><code class="xref js js-attr docutils literal"><span class="pre">$el</span></code></a>), and a shortcut to select nodes directly
(<a class="reference internal" href="#Widget._S_" title="Widget.$"><code class="xref js js-func docutils literal"><span class="pre">$()</span></code></a>).</p>
</li>
<li><p class="first">More generally, never assume your components own or controls anything beyond
its own personal <a class="reference internal" href="#Widget._S_el" title="Widget.$el"><code class="xref js js-attr docutils literal"><span class="pre">$el</span></code></a></p>
</li>
<li><p class="first">html templating/rendering should use QWeb unless absolutely trivial.</p>
</li>
<li><p class="first">All interactive components (components displaying information to the screen
or intercepting DOM events) must inherit from <a class="reference internal" href="#Widget" title="Widget"><code class="xref js js-class docutils literal"><span class="pre">Widget()</span></code></a>
and correctly implement and use its API and life cycle.</p>
</li>
</ul>
<p>To display and interact with data, calls to the Odoo server are necessary.
This is performed using <abbr>RPC &lt;Remote Procedure Call&gt;</abbr>.</p>
<p>Odoo Web provides two primary APIs to handle this: a low-level
JSON-RPC based API communicating with the Python section of Odoo
Web (and of your module, if you have a Python part) and a high-level
API above that allowing your code to talk directly to high-level Odoo models.</p>
<p>All networking APIs are <a class="reference internal" href="async.html#reference-async"><span class="std std-ref">asynchronous</span></a>. As a result,
all of them will return <a class="reference external" href="http://api.jquery.com/category/deferred-object/">Deferred</a> objects (whether they resolve those with
values or not). Understanding how those work before before moving on is
probably necessary.</p>
</div>
<div class="section" id="high-level-api-calling-into-odoo-models">
<h2>High-level API: calling into Odoo models<a class="headerlink" href="#high-level-api-calling-into-odoo-models" title="Permalink to this headline">¶</a></h2>
<p>Access to Odoo object methods (made available through XML-RPC from the server)
is done via <a class="reference internal" href="#Model" title="Model"><code class="xref js js-class docutils literal"><span class="pre">Model()</span></code></a>. It maps onto the Odoo server objects via two primary
methods, <code class="xref js js-func docutils literal"><span class="pre">call()</span></code> (exported in <code class="docutils literal"><span class="pre">web.Model</span></code>) and <code class="xref js js-func docutils literal"><span class="pre">query()</span></code>
(exported in <code class="docutils literal"><span class="pre">web.DataModel</span></code>, only available in the backend client).</p>
<p><code class="xref js js-func docutils literal"><span class="pre">call()</span></code> is a direct mapping to the corresponding method of
the Odoo server object. Its usage is similar to that of the Odoo Model API,
with three differences:</p>
<ul>
<li><p class="first">The interface is <a class="reference internal" href="async.html#reference-async"><span class="std std-ref">asynchronous</span></a>, so instead of
returning results directly RPC method calls will return
<a class="reference external" href="http://api.jquery.com/category/deferred-object/">Deferred</a> instances, which will themselves resolve to the
result of the matching RPC call.</p>
</li>
<li><p class="first">Because ECMAScript 3/Javascript 1.5 doesnt feature any equivalent to
<code class="docutils literal"><span class="pre">__getattr__</span></code> or <code class="docutils literal"><span class="pre">method_missing</span></code>, there needs to be an explicit
method to dispatch RPC methods.</p>
</li>
<li><p class="first">No notion of pooler, the model proxy is instantiated where needed,
not fetched from an other (somewhat global) object:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">Users</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">);</span>

<span class="nx">Users</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;change_password&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;oldpassword&#39;</span><span class="p">,</span> <span class="s1">&#39;newpassword&#39;</span><span class="p">],</span>
                  <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="nx">some_context</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something with change_password result</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
<p><code class="xref js js-func docutils literal"><span class="pre">query()</span></code> is a shortcut for a builder-style
interface to searches (<code class="docutils literal"><span class="pre">search</span></code> + <code class="docutils literal"><span class="pre">read</span></code> in Odoo RPC terms). It
returns a <a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> object which is immutable but
allows building new <a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> instances from the
first one, adding new properties or modifiying the parent object’s:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">Users</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The query is only actually performed when calling one of the query
serialization methods, <code class="xref js js-func docutils literal"><span class="pre">all()</span></code> and
<code class="xref js js-func docutils literal"><span class="pre">first()</span></code>. These methods will perform a new
RPC call every time they are called.</p>
<p>For that reason, it’s actually possible to keep “intermediate” queries
around and use them differently/add new specifications on them.</p>
<dl class="class">
<dt id="Model">
<em class="property">class </em><code class="descname">Model</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#Model" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="Model.Model.name">
<code class="descclassname">Model.Model.</code><code class="descname">name</code><a class="headerlink" href="#Model.Model.name" title="Permalink to this definition">¶</a></dt>
<dd><p>name of the model this object is bound to</p>
</dd></dl>

<dl class="function">
<dt id="Model.Model.call">
<code class="descclassname">Model.Model.</code><code class="descname">call</code><span class="sig-paren">(</span><em>method[, args][, kwargs]</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.Model.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the <code class="docutils literal"><span class="pre">method</span></code> method of the current model, with the
provided positional and keyword arguments.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>method</strong> (<em>String</em>) – method to call over rpc on the
<code class="xref js js-attr docutils literal"><span class="pre">name</span></code></li>
<li><strong>args</strong> (<em>Array&lt;&gt;</em>) – positional arguments to pass to the
method, optional</li>
<li><strong>kwargs</strong> (<em>Object&lt;&gt;</em>) – keyword arguments to pass to the
method, optional</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Deferred&lt;&gt;</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Model.Model.query">
<code class="descclassname">Model.Model.</code><code class="descname">query</code><span class="sig-paren">(</span><em>fields</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.Model.query" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>fields</strong> (<em>Array&lt;String&gt;</em>) – list of fields to fetch during
the search</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a <a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> object
representing the search to perform</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="odoo.web.Query">
<em class="property">class </em><code class="descclassname">odoo.web.</code><code class="descname">Query</code><span class="sig-paren">(</span><em>fields</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query" title="Permalink to this definition">¶</a></dt>
<dd><p>The first set of methods is the “fetching” methods. They perform
RPC queries using the internal data of the object they’re called
on.</p>
<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.all">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">all</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.all" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches the result of the current <a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> object’s
search.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Deferred&lt;Array&lt;&gt;&gt;</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.first">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">first</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.first" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches the <strong>first</strong> result of the current
<a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a>, or <code class="docutils literal"><span class="pre">null</span></code> if the current
<a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> does have any result.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Deferred&lt;Object | null&gt;</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.count">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">count</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.count" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches the number of records the current
<a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> would retrieve.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">Deferred&lt;Number&gt;</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.group_by">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">group_by</code><span class="sig-paren">(</span><em>grouping...</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.group_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetches the groups for the query, using the first specified
grouping parameter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>grouping</strong> (<em>Array&lt;String&gt;</em>) – Lists the levels of grouping
asked of the server. Grouping
can actually be an array or
varargs.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Deferred&lt;Array&lt;odoo.web.QueryGroup&gt;&gt; | null</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>The second set of methods is the “mutator” methods, they create a
<strong>new</strong> <a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> object with the relevant
(internal) attribute either augmented or replaced.</p>
<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.context">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">context</code><span class="sig-paren">(</span><em>ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.context" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the provided <code class="docutils literal"><span class="pre">ctx</span></code> to the query, on top of any existing
context</p>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.filter">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">filter</code><span class="sig-paren">(</span><em>domain</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds the provided domain to the query, this domain is
<code class="docutils literal"><span class="pre">AND</span></code>-ed to the existing query domain.</p>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.opeenrp.web.Query.offset">
<code class="descclassname">odoo.web.Query.opeenrp.web.Query.</code><code class="descname">offset</code><span class="sig-paren">(</span><em>offset</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.opeenrp.web.Query.offset" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the provided offset on the query. The new offset
<em>replaces</em> the old one.</p>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.limit">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">limit</code><span class="sig-paren">(</span><em>limit</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the provided limit on the query. The new limit <em>replaces</em>
the old one.</p>
</dd></dl>

<dl class="function">
<dt id="odoo.web.Query.odoo.web.Query.order_by">
<code class="descclassname">odoo.web.Query.odoo.web.Query.</code><code class="descname">order_by</code><span class="sig-paren">(</span><em>fields…</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.Query.odoo.web.Query.order_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Overrides the model’s natural order with the provided field
specifications. Behaves much like Django’s <code class="xref py py-meth docutils literal"><span class="pre">QuerySet.order_by</span></code>:</p>
<ul class="simple">
<li>Takes 1..n field names, in order of most to least importance
(the first field is the first sorting key). Fields are
provided as strings.</li>
<li>A field specifies an ascending order, unless it is prefixed
with the minus sign “<code class="docutils literal"><span class="pre">-</span></code>” in which case the field is used
in the descending order</li>
</ul>
<p>Divergences from Django’s sorting include a lack of random sort
(<code class="docutils literal"><span class="pre">?</span></code> field) and the inability to “drill down” into relations
for sorting.</p>
</dd></dl>

</dd></dl>

<div class="section" id="aggregation-grouping">
<h3>Aggregation (grouping)<a class="headerlink" href="#aggregation-grouping" title="Permalink to this headline">¶</a></h3>
<p>Odoo has powerful grouping capacities, but they are kind-of strange
in that they’re recursive, and level n+1 relies on data provided
directly by the grouping at level n. As a result, while
<code class="xref py py-meth docutils literal"><span class="pre">odoo.models.Model.read_group()</span></code> works it’s not a very intuitive
API.</p>
<p>Odoo Web eschews direct calls to <code class="xref py py-meth docutils literal"><span class="pre">read_group()</span></code>
in favor of calling a method of <a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a>, <code class="xref py py-meth docutils literal"><span class="pre">much</span>
<span class="pre">in</span> <span class="pre">the</span> <span class="pre">way</span> <span class="pre">it</span> <span class="pre">is</span> <span class="pre">done</span> <span class="pre">in</span> <span class="pre">SQLAlchemy</span></code>
<a class="footnote-reference" href="#terminal" id="id2">[2]</a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">some_query</span><span class="p">.</span><span class="nx">group_by</span><span class="p">([</span><span class="s1">&#39;field1&#39;</span><span class="p">,</span> <span class="s1">&#39;field2&#39;</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">groups</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do things with the fetched groups</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This method is asynchronous when provided with 1..n fields (to group
on) as argument, but it can also be called without any field (empty
fields collection or nothing at all). In this case, instead of
returning a Deferred object it will return <code class="docutils literal"><span class="pre">null</span></code>.</p>
<p>When grouping criterion come from a third-party and may or may not
list fields (e.g. could be an empty list), this provides two ways to
test the presence of actual subgroups (versus the need to perform a
regular query for records):</p>
<ul>
<li><p class="first">A check on <code class="docutils literal"><span class="pre">group_by</span></code>’s result and two completely separate code
paths:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">groups</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">groups</span> <span class="o">=</span> <span class="nx">some_query</span><span class="p">.</span><span class="nx">group_by</span><span class="p">(</span><span class="nx">gby</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">groups</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">gs</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// groups</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="c1">// no groups</span>
</pre></div>
</div>
</li>
<li><p class="first">Or a more coherent code path using <a class="reference internal" href="async.html#when" title="when"><code class="xref js js-func docutils literal"><span class="pre">when()</span></code></a>’s ability to
coerce values into deferreds:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">some_query</span><span class="p">.</span><span class="nx">group_by</span><span class="p">(</span><span class="nx">gby</span><span class="p">)).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">groups</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">groups</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// No grouping</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// grouping, even if there are no groups (groups</span>
        <span class="c1">// itself could be an empty array)</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
<p>The result of a (successful) <code class="xref js js-func docutils literal"><span class="pre">group_by()</span></code> is
an array of <a class="reference internal" href="#odoo.web.QueryGroup" title="odoo.web.QueryGroup"><code class="xref js js-class docutils literal"><span class="pre">QueryGroup()</span></code></a>:</p>
<dl class="class">
<dt id="odoo.web.QueryGroup">
<em class="property">class </em><code class="descclassname">odoo.web.</code><code class="descname">QueryGroup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.QueryGroup" title="Permalink to this definition">¶</a></dt>
<dd><dl class="function">
<dt id="odoo.web.QueryGroup.odoo.web.QueryGroup.get">
<code class="descclassname">odoo.web.QueryGroup.odoo.web.QueryGroup.</code><code class="descname">get</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.QueryGroup.odoo.web.QueryGroup.get" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the group’s attribute <code class="docutils literal"><span class="pre">key</span></code>. Known attributes are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">grouped_on</span></code></dt>
<dd>which grouping field resulted from this group</dd>
<dt><code class="docutils literal"><span class="pre">value</span></code></dt>
<dd><code class="docutils literal"><span class="pre">grouped_on</span></code>’s value for this group</dd>
<dt><code class="docutils literal"><span class="pre">length</span></code></dt>
<dd>the number of records in the group</dd>
<dt><code class="docutils literal"><span class="pre">aggregates</span></code></dt>
<dd>a {field: value} mapping of aggregations for the group</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="odoo.web.QueryGroup.odoo.web.QueryGroup.query">
<code class="descclassname">odoo.web.QueryGroup.odoo.web.QueryGroup.</code><code class="descname">query</code><span class="sig-paren">(</span><span class="optional">[</span><em>fields...</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.QueryGroup.odoo.web.QueryGroup.query" title="Permalink to this definition">¶</a></dt>
<dd><p>equivalent to <code class="xref js js-func docutils literal"><span class="pre">Model.query()</span></code> but pre-filtered to
only include the records within this group. Returns a
<a class="reference internal" href="#odoo.web.Query" title="odoo.web.Query"><code class="xref js js-class docutils literal"><span class="pre">Query()</span></code></a> which can be further manipulated as
usual.</p>
</dd></dl>

<dl class="function">
<dt id="odoo.web.QueryGroup.odoo.web.QueryGroup.subgroups">
<code class="descclassname">odoo.web.QueryGroup.odoo.web.QueryGroup.</code><code class="descname">subgroups</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#odoo.web.QueryGroup.odoo.web.QueryGroup.subgroups" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a deferred to an array of <a class="reference internal" href="#odoo.web.QueryGroup" title="odoo.web.QueryGroup"><code class="xref js js-class docutils literal"><span class="pre">QueryGroup()</span></code></a>
below this one</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="low-level-api-rpc-calls-to-python-side">
<h2>Low-level API: RPC calls to Python side<a class="headerlink" href="#low-level-api-rpc-calls-to-python-side" title="Permalink to this headline">¶</a></h2>
<p>While the previous section is great for calling core OpenERP code
(models code), it does not work if you want to call the Python side of
Odoo Web.</p>
<p>For this, a lower-level API exists on on
<code class="xref js js-class docutils literal"><span class="pre">Session()</span></code> objects (the class is exported in <code class="docutils literal"><span class="pre">web.Session</span></code>, but
an instance isusually available through <code class="docutils literal"><span class="pre">web.session</span></code>): the <code class="docutils literal"><span class="pre">rpc</span></code> method.</p>
<p>This method simply takes an absolute path (the absolute URL of the JSON
<a class="reference internal" href="http.html#reference-http-routing"><span class="std std-ref">route</span></a> to call) and a mapping of attributes to
values (passed as keyword arguments to the Python method). This function
fetches the return value of the Python methods, converted to JSON.</p>
<p>For instance, to call the <code class="docutils literal"><span class="pre">resequence</span></code> of the
<code class="xref js js-class docutils literal"><span class="pre">DataSet()</span></code> controller:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">session</span><span class="p">.</span><span class="nx">rpc</span><span class="p">(</span><span class="s1">&#39;/web/dataset/resequence&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">model</span><span class="o">:</span> <span class="nx">some_model</span><span class="p">,</span>
    <span class="nx">ids</span><span class="o">:</span> <span class="nx">array_of_ids</span><span class="p">,</span>
    <span class="nx">offset</span><span class="o">:</span> <span class="mi">42</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// resequence didn&#39;t error out</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// an error occured during during call</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="javascript-module-system-overview">
<h2>Javascript module system overview<a class="headerlink" href="#javascript-module-system-overview" title="Permalink to this headline">¶</a></h2>
<p>A new module system (inspired from requirejs) has now been deployed.
It has many advantages over the Odoo version 8 system.</p>
<ul class="simple">
<li>loading order: dependencies are guaranteed to be loaded first, even if
files are not loaded in the correct order in the bundle files.</li>
<li>easier to split a file into smaller logical units.</li>
<li>no global variables: easier to reason.</li>
<li>it is possible to examine every dependencies and dependants.  This
makes refactoring much simpler, and less risky.</li>
</ul>
<p>It has also some disadvantages:</p>
<ul class="simple">
<li>files are required to use the module system if they want to interact
with odoo, since the various objects are only available in the module
system, and not in global variables</li>
<li>circular dependencies are not supported.  It makes sense, but it means
that one needs to be careful.</li>
</ul>
<p>This is obviously a very large change and will require everyone to
adopt new habits.  For example, the variable odoo does not exist
anymore.  The new way of doing things is to import explicitely the module
you need, and declaring explicitely the objects you export.  Here is a
simple example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;addon_name.service&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">utils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.utils&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web.Model&#39;</span><span class="p">);</span>

    <span class="c1">// do things with utils and Model</span>
    <span class="kd">var</span> <span class="nx">something_useful</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
    <span class="k">return</span>  <span class="p">{</span>
        <span class="nx">something_useful</span><span class="o">:</span> <span class="nx">something_useful</span><span class="p">,</span>
    <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This snippet shows a module named <code class="docutils literal"><span class="pre">addon_name.service</span></code>.  It is defined
with the <code class="docutils literal"><span class="pre">odoo.define</span></code> function.  <code class="docutils literal"><span class="pre">odoo.define</span></code> takes a name and a
function for arguments:</p>
<ul class="simple">
<li>The name is the concatenation of the name of the addon it is defined in
and a name describing its purpose.</li>
<li>The function is the place where the javascript module is actually
defined.  It takes a function <code class="docutils literal"><span class="pre">require</span></code> as first argument, and
returns something (or not, depending if it needs to export something).
The <code class="docutils literal"><span class="pre">require</span></code> function is used to get a handle on the dependencies.
In this case, it gives a handle on two javascript modules from the
<code class="docutils literal"><span class="pre">web</span></code> addon, namely <code class="docutils literal"><span class="pre">web.utils</span></code> and <code class="docutils literal"><span class="pre">web.Model</span></code>.</li>
</ul>
<p>The idea is that you define what you need to import (by using the
<code class="docutils literal"><span class="pre">require</span></code> function) and declare what you export (by returning
something).  The web client will then make sure that your code is loaded
properly.</p>
<p>Modules are contained in a file, but a file can define several modules
(however, it is better to keep them in separate files).</p>
<p>Each module can return a deferred. In that case, the module is marked as loaded
only when the deferred is resolved, and its value is equal to the resolved value.
The module can be rejected (unloaded). This will be logged in the console as info.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Missing</span> <span class="pre">dependencies</span></code>:
These modules do not appear in the page. It is possible that the JavaScript
file is not in the page or that the module name is wrong</li>
<li><code class="docutils literal"><span class="pre">Failed</span> <span class="pre">modules</span></code>:
A javascript error is detected</li>
<li><code class="docutils literal"><span class="pre">Rejected</span> <span class="pre">modules</span></code>:
The module returns a rejected deferred. It (and its dependent modules) is not
loaded.</li>
<li><code class="docutils literal"><span class="pre">Rejected</span> <span class="pre">linked</span> <span class="pre">modules</span></code>:
Modules who depend on a rejected module</li>
<li><code class="docutils literal"><span class="pre">Non</span> <span class="pre">loaded</span> <span class="pre">modules</span></code>:
Modules who depend on a missing or a failed module</li>
</ul>
</div>
<div class="section" id="web-client-structure">
<h2>Web client structure<a class="headerlink" href="#web-client-structure" title="Permalink to this headline">¶</a></h2>
<p>The web client files have been refactored into smaller and simpler files.
Here is a description of the current file structure:</p>
<ul class="simple">
<li>the <code class="docutils literal"><span class="pre">framework/</span></code> folder contains all basic low level modules.  The
modules here are supposed to be generic.  Some of them are:<ul>
<li><code class="docutils literal"><span class="pre">web.ajax</span></code> implements rpc calls</li>
<li><code class="docutils literal"><span class="pre">web.core</span></code> is a generic modules.  It exports various useful
objects and functions, such as <code class="docutils literal"><span class="pre">qweb</span></code>, <code class="docutils literal"><span class="pre">_t</span></code> or the main bus.</li>
<li><code class="docutils literal"><span class="pre">web.Widget</span></code> contains the widget class</li>
<li><code class="docutils literal"><span class="pre">web.Model</span></code> is an abstraction over <code class="docutils literal"><span class="pre">web.ajax</span></code> to make
calls to the server model methods</li>
<li><code class="docutils literal"><span class="pre">web.session</span></code> is the former <code class="docutils literal"><span class="pre">odoo.session</span></code></li>
<li><code class="docutils literal"><span class="pre">web.utils</span></code> for useful code snippets</li>
<li><code class="docutils literal"><span class="pre">web.time</span></code> for every time-related generic functions</li>
</ul>
</li>
<li>the <code class="docutils literal"><span class="pre">views/</span></code> folder contains all view definitions</li>
<li><code class="docutils literal"><span class="pre">widgets/</span></code> is for standalone widgets</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">js/</span></code> folder also contains some important files:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">action_manager.js</span></code> is the ActionManager class</li>
<li><code class="docutils literal"><span class="pre">boot.js</span></code> is the file actually implementing the module system</li>
<li><code class="docutils literal"><span class="pre">menu.js</span></code> is the definition of the top menu</li>
<li><code class="docutils literal"><span class="pre">web_client.js</span></code> is for the root widget WebClient</li>
<li><code class="docutils literal"><span class="pre">view_manager.js</span></code> contains the ViewManager</li>
</ul>
<p>The two other files are <code class="docutils literal"><span class="pre">tour.js</span></code> for the tours and <code class="docutils literal"><span class="pre">compatibility.js</span></code>.
The latter file is a compatibility layer bridging the old system to the
new module system.  This is where every module names are exported to the
global variable <code class="docutils literal"><span class="pre">odoo</span></code>.  In theory, our addons should work without
ever using the variable <code class="docutils literal"><span class="pre">odoo</span></code>, and the compatibility module can be
disabled safely.</p>
</div>
<div class="section" id="javascript-conventions">
<h2>Javascript conventions<a class="headerlink" href="#javascript-conventions" title="Permalink to this headline">¶</a></h2>
<p>Here are some basic conventions for the javascript code:</p>
<ul class="simple">
<li>declare all your dependencies at the top of the module.  Also, they
should be sorted alphabetically by module name.  This makes it
easier to understand your module.</li>
<li>declare all exports at the end.</li>
<li>add the <code class="docutils literal"><span class="pre">use</span> <span class="pre">strict</span></code> statement at the beginning of every module</li>
<li>always name your module properly: <code class="docutils literal"><span class="pre">addon_name.description</span></code>.</li>
<li>use capital letters for classes (for example, <code class="docutils literal"><span class="pre">ActionManager</span></code> is
defined in the module <code class="docutils literal"><span class="pre">web.ActionManager</span></code>), and lowercase for
everything else (for example, <code class="docutils literal"><span class="pre">ajax</span></code> is defined in <code class="docutils literal"><span class="pre">web.ajax</span></code>).</li>
<li>declare one module per file</li>
</ul>
</div>
<div class="section" id="javascript-unit-testing">
<h2>Javascript Unit Testing<a class="headerlink" href="#javascript-unit-testing" title="Permalink to this headline">¶</a></h2>
<p>Odoo Web includes means to unit-test both the core code of
Odoo Web and your own javascript modules. On the javascript side,
unit-testing is based on <a class="reference external" href="http://qunitjs.com/">QUnit</a> with a number of helpers and
extensions for better integration with Odoo.</p>
<p>To see what the runner looks like, find (or start) an Odoo server
with the web client enabled, and navigate to <code class="docutils literal"><span class="pre">/web/tests</span></code>
This will show the runner selector, which lists all modules with javascript
unit tests, and allows starting any of them (or all javascript tests in all
modules at once).</p>
<img alt="../_images/runner.png" class="align-center" src="../_images/runner.png" />
<p>Clicking any runner button will launch the corresponding tests in the
bundled <a class="reference external" href="http://qunitjs.com/">QUnit</a> runner:</p>
<img alt="../_images/tests.png" class="align-center" src="../_images/tests.png" />
</div>
<div class="section" id="writing-a-test-case">
<h2>Writing a test case<a class="headerlink" href="#writing-a-test-case" title="Permalink to this headline">¶</a></h2>
<p>The first step is to list the test file(s). This is done through the
<code class="docutils literal"><span class="pre">test</span></code> key of the Odoo manifest, by adding javascript files to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Demonstration of web/javascript tests&quot;</span><span class="p">,</span>
    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="s1">&#39;Hidden&#39;</span><span class="p">,</span>
    <span class="s1">&#39;depends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">],</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;static/tests/demo.js&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and to create the corresponding test file(s)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Test files which do not exist will be ignored, if all test files
of a module are ignored (can not be found), the test runner will
consider that the module has no javascript tests.</p>
</div>
<p>After that, refreshing the runner selector will display the new module
and allow running all of its (0 so far) tests:</p>
<img alt="../_images/runner2.png" class="align-center" src="../_images/runner2.png" />
<p>The next step is to create a test case:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">testing</span><span class="p">.</span><span class="nx">section</span><span class="p">(</span><span class="s1">&#39;basic section&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">test</span><span class="p">(</span><span class="s1">&#39;my first test&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">ok</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;this test has run&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>All testing helpers and structures live in the <code class="docutils literal"><span class="pre">odoo.testing</span></code>
module. Odoo tests live in a <a class="reference internal" href="#odoo.testing.section" title="odoo.testing.section"><code class="xref js js-func docutils literal"><span class="pre">section()</span></code></a>,
which is itself part of a module. The first argument to a section is
the name of the section, the second one is the section body.</p>
<p><a class="reference internal" href="#odoo.testing.case" title="odoo.testing.case"><code class="xref js js-func docutils literal"><span class="pre">test</span></code></a>, provided by the
<a class="reference internal" href="#odoo.testing.section" title="odoo.testing.section"><code class="xref js js-func docutils literal"><span class="pre">section()</span></code></a> to the callback, is used to
register a given test case which will be run whenever the test runner
actually does its job. Odoo Web test case use standard <a class="reference external" href="http://api.qunitjs.com/category/assert/">QUnit
assertions</a> within them.</p>
<p>Launching the test runner at this point will run the test and display
the corresponding assertion message, with red colors indicating the
test failed:</p>
<img alt="../_images/tests2.png" class="align-center" src="../_images/tests2.png" />
<p>Fixing the test (by replacing <code class="docutils literal"><span class="pre">false</span></code> to <code class="docutils literal"><span class="pre">true</span></code> in the assertion)
will make it pass:</p>
<img alt="../_images/tests3.png" class="align-center" src="../_images/tests3.png" />
</div>
<div class="section" id="assertions">
<h2>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h2>
<p>As noted above, Odoo Web’s tests use <a class="reference external" href="http://api.qunitjs.com/category/assert/">qunit assertions</a>. They are
available globally (so they can just be called without references to
anything). The following list is available:</p>
<dl class="function">
<dt id="ok">
<code class="descname">ok</code><span class="sig-paren">(</span><em>state</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#ok" title="Permalink to this definition">¶</a></dt>
<dd><p>checks that <code class="docutils literal"><span class="pre">state</span></code> is truthy (in the javascript sense)</p>
</dd></dl>

<dl class="function">
<dt id="strictEqual">
<code class="descname">strictEqual</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#strictEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>checks that the actual (produced by a method being tested) and
expected values are identical (roughly equivalent to <code class="docutils literal"><span class="pre">ok(actual</span>
<span class="pre">===</span> <span class="pre">expected,</span> <span class="pre">message)</span></code>)</p>
</dd></dl>

<dl class="function">
<dt id="notStrictEqual">
<code class="descname">notStrictEqual</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#notStrictEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>checks that the actual and expected values are <em>not</em> identical
(roughly equivalent to <code class="docutils literal"><span class="pre">ok(actual</span> <span class="pre">!==</span> <span class="pre">expected,</span> <span class="pre">message)</span></code>)</p>
</dd></dl>

<dl class="function">
<dt id="deepEqual">
<code class="descname">deepEqual</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#deepEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>deep comparison between actual and expected: recurse into
containers (objects and arrays) to ensure that they have the same
keys/number of elements, and the values match.</p>
</dd></dl>

<dl class="function">
<dt id="notDeepEqual">
<code class="descname">notDeepEqual</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#notDeepEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>inverse operation to <a class="reference internal" href="#deepEqual" title="deepEqual"><code class="xref js js-func docutils literal"><span class="pre">deepEqual()</span></code></a></p>
</dd></dl>

<dl class="function">
<dt id="throws">
<code class="descname">throws</code><span class="sig-paren">(</span><em>block[, expected][, message]</em><span class="sig-paren">)</span><a class="headerlink" href="#throws" title="Permalink to this definition">¶</a></dt>
<dd><p>checks that, when called, the <code class="docutils literal"><span class="pre">block</span></code> throws an
error. Optionally validates that error against <code class="docutils literal"><span class="pre">expected</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>block</strong> (<em>Function</em>) – </li>
<li><strong>expected</strong> (<em>Error | RegExp</em>) – if a regexp, checks that the thrown error’s
message matches the regular expression. If an
error type, checks that the thrown error is of
that type.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="equal">
<code class="descname">equal</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#equal" title="Permalink to this definition">¶</a></dt>
<dd><p>checks that <code class="docutils literal"><span class="pre">actual</span></code> and <code class="docutils literal"><span class="pre">expected</span></code> are loosely equal, using
the <code class="docutils literal"><span class="pre">==</span></code> operator and its coercion rules.</p>
</dd></dl>

<dl class="function">
<dt id="notEqual">
<code class="descname">notEqual</code><span class="sig-paren">(</span><em>actual</em>, <em>expected</em><span class="optional">[</span>, <em>message</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#notEqual" title="Permalink to this definition">¶</a></dt>
<dd><p>inverse operation to <a class="reference internal" href="#equal" title="equal"><code class="xref js js-func docutils literal"><span class="pre">equal()</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="getting-an-odoo-instance">
<h2>Getting an Odoo instance<a class="headerlink" href="#getting-an-odoo-instance" title="Permalink to this headline">¶</a></h2>
<p>The Odoo instance is the base through which most Odoo Web
modules behaviors (functions, objects, …) are accessed. As a result,
the test framework automatically builds one, and loads the module
being tested and all of its dependencies inside it. This new instance
is provided as the first positional parameter to your test
cases. Let’s observe by adding javascript code (not test code) to the
test module:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Demonstration of web/javascript tests&quot;</span><span class="p">,</span>
    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="s1">&#39;Hidden&#39;</span><span class="p">,</span>
    <span class="s1">&#39;depends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">],</span>
    <span class="s1">&#39;js&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;static/src/js/demo.js&#39;</span><span class="p">],</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;static/tests/demo.js&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// src/js/demo.js</span>
<span class="nx">odoo</span><span class="p">.</span><span class="nx">web_tests_demo</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">web_tests_demo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">value_true</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">SomeType</span><span class="o">:</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>and then adding a new test case, which simply checks that the
<code class="docutils literal"><span class="pre">instance</span></code> contains all the expected stuff we created in the
module:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// test/demo.js</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;module content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ok</span><span class="p">(</span><span class="nx">instance</span><span class="p">.</span><span class="nx">web_tests_demo</span><span class="p">.</span><span class="nx">value_true</span><span class="p">,</span> <span class="s2">&quot;should have a true value&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">type_instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web_tests_demo</span><span class="p">.</span><span class="nx">SomeType</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
    <span class="nx">strictEqual</span><span class="p">(</span><span class="nx">type_instance</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s2">&quot;should have provided value&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="dom-scratchpad">
<h2>DOM Scratchpad<a class="headerlink" href="#dom-scratchpad" title="Permalink to this headline">¶</a></h2>
<p>As in the wider client, arbitrarily accessing document content is
strongly discouraged during tests. But DOM access is still needed to
e.g. fully initialize <code class="xref js js-class docutils literal"><span class="pre">widgets</span></code> before
testing them.</p>
<p>Thus, a test case gets a DOM scratchpad as its second positional
parameter, in a jQuery instance. That scratchpad is fully cleaned up
before each test, and as long as it doesn’t do anything outside the
scratchpad your code can do whatever it wants:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// test/demo.js</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;DOM content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">$scratchpad</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scratchpad</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&lt;span class=&quot;foo bar&quot;&gt;ok&lt;/span&gt;&lt;/div&gt;&#39;</span><span class="p">);</span>
    <span class="nx">ok</span><span class="p">(</span><span class="nx">$scratchpad</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span>
       <span class="s2">&quot;should have provided class&quot;</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;clean scratchpad&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">$scratchpad</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ok</span><span class="p">(</span><span class="o">!</span><span class="nx">$scratchpad</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">length</span><span class="p">,</span> <span class="s2">&quot;should have no content&quot;</span><span class="p">);</span>
    <span class="nx">ok</span><span class="p">(</span><span class="o">!</span><span class="nx">$scratchpad</span><span class="p">.</span><span class="nx">text</span><span class="p">(),</span> <span class="s2">&quot;should have no text&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The top-level element of the scratchpad is not cleaned up, test
cases can add text or DOM children but shoud not alter
<code class="docutils literal"><span class="pre">$scratchpad</span></code> itself.</p>
</div>
</div>
<div class="section" id="loading-templates">
<h2>Loading templates<a class="headerlink" href="#loading-templates" title="Permalink to this headline">¶</a></h2>
<p>To avoid the corresponding processing costs, by default templates are
not loaded into QWeb. If you need to render e.g. widgets making use of
QWeb templates, you can request their loading through the
<code class="xref js js-attr docutils literal"><span class="pre">templates</span></code> option to the <a class="reference internal" href="#odoo.testing.case" title="odoo.testing.case"><code class="xref js js-func docutils literal"><span class="pre">test</span> <span class="pre">case</span>
<span class="pre">function</span></code></a>.</p>
<p>This will automatically load all relevant templates in the instance’s
qweb before running the test case:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Demonstration of web/javascript tests&quot;</span><span class="p">,</span>
    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="s1">&#39;Hidden&#39;</span><span class="p">,</span>
    <span class="s1">&#39;depends&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">],</span>
    <span class="s1">&#39;js&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;static/src/js/demo.js&#39;</span><span class="p">],</span>
    <span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;static/tests/demo.js&#39;</span><span class="p">],</span>
    <span class="s1">&#39;qweb&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;static/src/xml/demo.xml&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- src/xml/demo.xml --&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">id=</span><span class="s">&quot;template&quot;</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;DemoTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;5&quot;</span> <span class="na">t-as=</span><span class="s">&quot;value&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;value&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// test/demo.js</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;templates&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">templates</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;DemoTemplate&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">texts</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">s</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
    <span class="p">}).</span><span class="nx">get</span><span class="p">();</span>

    <span class="nx">deepEqual</span><span class="p">(</span><span class="nx">texts</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="asynchronous-cases">
<h2>Asynchronous cases<a class="headerlink" href="#asynchronous-cases" title="Permalink to this headline">¶</a></h2>
<p>The test case examples so far are all synchronous, they execute from
the first to the last line and once the last line has executed the
test is done. But the web client is full of <a class="reference internal" href="async.html#reference-async"><span class="std std-ref">asynchronous code</span></a>, and thus test cases need to be async-aware.</p>
<p>This is done by returning a <a class="reference internal" href="async.html#Deferred" title="Deferred"><code class="xref js js-class docutils literal"><span class="pre">deferred</span></code></a> from the
case callback:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// test/demo.js</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;asynchronous&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">asserts</span><span class="o">:</span> <span class="mi">1</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">ok</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This example also uses the <a class="reference internal" href="#TestOptions" title="TestOptions"><code class="xref js js-class docutils literal"><span class="pre">options</span> <span class="pre">parameter</span></code></a>
to specify the number of assertions the case should expect, if less or
more assertions are specified the case will count as failed.</p>
<p>Asynchronous test cases <em>must</em> specify the number of assertions they
will run. This allows more easily catching situations where e.g. the
test architecture was not warned about asynchronous operations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Asynchronous test cases also have a 2 seconds timeout: if the test
does not finish within 2 seconds, it will be considered
failed. This pretty much always means the test will not
resolve. This timeout <em>only</em> applies to the test itself, not to
the setup and teardown processes.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the returned deferred is rejected, the test will be failed
unless <code class="xref js js-attr docutils literal"><span class="pre">fail_on_rejection</span></code> is set to
<code class="docutils literal"><span class="pre">false</span></code>.</p>
</div>
</div>
<div class="section" id="rpc">
<h2>RPC<a class="headerlink" href="#rpc" title="Permalink to this headline">¶</a></h2>
<p>An important subset of asynchronous test cases is test cases which
need to perform (and chain, to an extent) RPC calls.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because they are a subset of asynchronous cases, RPC cases must
also provide a valid <code class="xref js js-attr docutils literal"><span class="pre">assertions</span> <span class="pre">count</span></code>.</p>
</div>
<p>To enable mock RPC, set the <code class="xref js js-attr docutils literal"><span class="pre">rpc</span> <span class="pre">option</span></code> to
<code class="docutils literal"><span class="pre">mock</span></code>. This will add a third parameter to the test case callback:</p>
<dl class="function">
<dt id="mock">
<code class="descname">mock</code><span class="sig-paren">(</span><em>rpc_spec</em>, <em>handler</em><span class="sig-paren">)</span><a class="headerlink" href="#mock" title="Permalink to this definition">¶</a></dt>
<dd><p>Can be used in two different ways depending on the shape of the
first parameter:</p>
<ul>
<li><p class="first">If it matches the pattern <code class="docutils literal"><span class="pre">model:method</span></code> (if it contains a
colon, essentially) the call will set up the mocking of an RPC
call straight to the Odoo server (through XMLRPC) as
performed via e.g. <code class="xref js js-func docutils literal"><span class="pre">odoo.web.Model.call()</span></code>.</p>
<p>In that case, <code class="docutils literal"><span class="pre">handler</span></code> should be a function taking two
arguments <code class="docutils literal"><span class="pre">args</span></code> and <code class="docutils literal"><span class="pre">kwargs</span></code>, matching the corresponding
arguments on the server side and should simply return the value
as if it were returned by the Python XMLRPC handler:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;XML-RPC&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">rpc</span><span class="o">:</span> <span class="s1">&#39;mock&#39;</span><span class="p">,</span> <span class="nx">asserts</span><span class="o">:</span> <span class="mi">3</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">$s</span><span class="p">,</span> <span class="nx">mock</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// set up mocking</span>
    <span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;people.famous:name_search&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">kwargs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">strictEqual</span><span class="p">(</span><span class="nx">kwargs</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="s1">&#39;bob&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Microsoft Bob&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Bob the Builder&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Silent Bob&quot;</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">});</span>

    <span class="c1">// actual test code</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;people.famous&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;name_search&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;bob&#39;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;shoud return 3 people&quot;</span><span class="p">);</span>
            <span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Microsoft Bob&quot;</span><span class="p">,</span>
                <span class="s2">&quot;the most famous bob should be Microsoft Bob&quot;</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
<li><p class="first">Otherwise, if it matches an absolute path (e.g. <code class="docutils literal"><span class="pre">/a/b/c</span></code>) it
will mock a JSON-RPC call to a web client controller, such as
<code class="docutils literal"><span class="pre">/web/webclient/translations</span></code>. In that case, the handler takes
a single <code class="docutils literal"><span class="pre">params</span></code> argument holding all of the parameters
provided over JSON-RPC.</p>
<p>As previously, the handler should simply return the result value
as if returned by the original JSON-RPC handler:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;JSON-RPC&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">rpc</span><span class="o">:</span> <span class="s1">&#39;mock&#39;</span><span class="p">,</span> <span class="nx">asserts</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">templates</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">$s</span><span class="p">,</span> <span class="nx">mock</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fetched_dbs</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">fetched_langs</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;/web/database/get_list&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">fetched_dbs</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">];</span>
    <span class="p">});</span>
    <span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;/web/session/get_lang_list&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">fetched_langs</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">[[</span><span class="s1">&#39;vo_IS&#39;</span><span class="p">,</span> <span class="s1">&#39;Hopelandic / Vonlenska&#39;</span><span class="p">]];</span>
    <span class="p">});</span>

    <span class="c1">// widget needs that or it blows up</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">webclient</span> <span class="o">=</span> <span class="p">{</span><span class="nx">toggle_bars</span><span class="o">:</span> <span class="nx">odoo</span><span class="p">.</span><span class="nx">testing</span><span class="p">.</span><span class="nx">noop</span><span class="p">};</span>
    <span class="kd">var</span> <span class="nx">dbm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">DatabaseManager</span><span class="p">({});</span>
    <span class="k">return</span> <span class="nx">dbm</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$s</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">ok</span><span class="p">(</span><span class="nx">fetched_dbs</span><span class="p">,</span> <span class="s2">&quot;should have fetched databases&quot;</span><span class="p">);</span>
        <span class="nx">ok</span><span class="p">(</span><span class="nx">fetched_langs</span><span class="p">,</span> <span class="s2">&quot;should have fetched languages&quot;</span><span class="p">);</span>
        <span class="nx">deepEqual</span><span class="p">(</span><span class="nx">dbm</span><span class="p">.</span><span class="nx">db_list</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
</ul>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mock handlers can contain assertions, these assertions should be
part of the assertions count (and if multiple calls are made to a
handler containing assertions, it multiplies the effective number
of assertions).</p>
</div>
</div>
<div class="section" id="testing-api">
<h2>Testing API<a class="headerlink" href="#testing-api" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="odoo.testing.section">
<code class="descclassname">odoo.testing.</code><code class="descname">section</code><span class="sig-paren">(</span><em>name</em>, <span class="optional">[</span><em>options</em>, <span class="optional">]</span><em>body</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.testing.section" title="Permalink to this definition">¶</a></dt>
<dd><p>A test section, serves as shared namespace for related tests (for
constants or values to only set up once). The <code class="docutils literal"><span class="pre">body</span></code> function
should contain the tests themselves.</p>
<p>Note that the order in which tests are run is essentially
undefined, do <em>not</em> rely on it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>String</em>) – </li>
<li><strong>options</strong> (<a class="reference internal" href="#TestOptions" title="TestOptions"><em>TestOptions</em></a>) – </li>
<li><strong>body</strong> (Function&lt;<a class="reference internal" href="#odoo.testing.case" title="odoo.testing.case"><code class="xref js js-func docutils literal"><span class="pre">case()</span></code></a>, void&gt;) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="odoo.testing.case">
<code class="descclassname">odoo.testing.</code><code class="descname">case</code><span class="sig-paren">(</span><em>name</em>, <span class="optional">[</span><em>options</em>, <span class="optional">]</span><em>callback</em><span class="sig-paren">)</span><a class="headerlink" href="#odoo.testing.case" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers a test case callback in the test runner, the callback
will only be run once the runner is started (or maybe not at all,
if the test is filtered out).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>String</em>) – </li>
<li><strong>options</strong> (<a class="reference internal" href="#TestOptions" title="TestOptions"><em>TestOptions</em></a>) – </li>
<li><strong>callback</strong> (<em>Function&lt;instance, $, Function&lt;String, Function, void&gt;&gt;</em>) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="TestOptions">
<em class="property">class </em><code class="descname">TestOptions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TestOptions" title="Permalink to this definition">¶</a></dt>
<dd><p>the various options which can be passed to
<a class="reference internal" href="#odoo.testing.section" title="odoo.testing.section"><code class="xref js js-func docutils literal"><span class="pre">section()</span></code></a> or
<a class="reference internal" href="#odoo.testing.case" title="odoo.testing.case"><code class="xref js js-func docutils literal"><span class="pre">case()</span></code></a>. Except for
<a class="reference internal" href="#TestOptions.TestOptions.setup" title="TestOptions.TestOptions.setup"><code class="xref js js-attr docutils literal"><span class="pre">setup</span></code></a> and
<a class="reference internal" href="#TestOptions.TestOptions.teardown" title="TestOptions.TestOptions.teardown"><code class="xref js js-attr docutils literal"><span class="pre">teardown</span></code></a>, an option on
<a class="reference internal" href="#odoo.testing.case" title="odoo.testing.case"><code class="xref js js-func docutils literal"><span class="pre">case()</span></code></a> will overwrite the corresponding
option on <a class="reference internal" href="#odoo.testing.section" title="odoo.testing.section"><code class="xref js js-func docutils literal"><span class="pre">section()</span></code></a> so
e.g. <a class="reference internal" href="#TestOptions.TestOptions.rpc" title="TestOptions.TestOptions.rpc"><code class="xref js js-attr docutils literal"><span class="pre">rpc</span></code></a> can be set for a
<a class="reference internal" href="#odoo.testing.section" title="odoo.testing.section"><code class="xref js js-func docutils literal"><span class="pre">section()</span></code></a> and then differently set for
some <a class="reference internal" href="#odoo.testing.case" title="odoo.testing.case"><code class="xref js js-func docutils literal"><span class="pre">case()</span></code></a> of that
<a class="reference internal" href="#odoo.testing.section" title="odoo.testing.section"><code class="xref js js-func docutils literal"><span class="pre">section()</span></code></a></p>
<dl class="attribute">
<dt id="TestOptions.TestOptions.asserts">
<code class="descclassname">TestOptions.TestOptions.</code><code class="descname">asserts</code><a class="headerlink" href="#TestOptions.TestOptions.asserts" title="Permalink to this definition">¶</a></dt>
<dd><p>An integer, the number of assertions which should run during a
normal execution of the test. Mandatory for asynchronous tests.</p>
</dd></dl>

<dl class="attribute">
<dt id="TestOptions.TestOptions.setup">
<code class="descclassname">TestOptions.TestOptions.</code><code class="descname">setup</code><a class="headerlink" href="#TestOptions.TestOptions.setup" title="Permalink to this definition">¶</a></dt>
<dd><p>Test case setup, run right before each test case. A section’s
<code class="xref js js-func docutils literal"><span class="pre">setup()</span></code> is run before the case’s own, if
both are specified.</p>
</dd></dl>

<dl class="attribute">
<dt id="TestOptions.TestOptions.teardown">
<code class="descclassname">TestOptions.TestOptions.</code><code class="descname">teardown</code><a class="headerlink" href="#TestOptions.TestOptions.teardown" title="Permalink to this definition">¶</a></dt>
<dd><p>Test case teardown, a case’s <code class="xref js js-func docutils literal"><span class="pre">teardown()</span></code>
is run before the corresponding section if both are present.</p>
</dd></dl>

<dl class="attribute">
<dt id="TestOptions.TestOptions.fail_on_rejection">
<code class="descclassname">TestOptions.TestOptions.</code><code class="descname">fail_on_rejection</code><a class="headerlink" href="#TestOptions.TestOptions.fail_on_rejection" title="Permalink to this definition">¶</a></dt>
<dd><p>If the test is asynchronous and its resulting promise is
rejected, fail the test. Defaults to <code class="docutils literal"><span class="pre">true</span></code>, set to
<code class="docutils literal"><span class="pre">false</span></code> to not fail the test in case of rejection:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// test/demo.js</span>
<span class="nx">test</span><span class="p">(</span><span class="s1">&#39;unfail rejection&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">asserts</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">fail_on_rejection</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">ok</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
    <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="TestOptions.TestOptions.rpc">
<code class="descclassname">TestOptions.TestOptions.</code><code class="descname">rpc</code><a class="headerlink" href="#TestOptions.TestOptions.rpc" title="Permalink to this definition">¶</a></dt>
<dd><p>RPC method to use during tests, one of <code class="docutils literal"><span class="pre">&quot;mock&quot;</span></code> or
<code class="docutils literal"><span class="pre">&quot;rpc&quot;</span></code>. Any other value will disable RPC for the test (if
they were enabled by the suite for instance).</p>
</dd></dl>

<dl class="attribute">
<dt id="TestOptions.TestOptions.templates">
<code class="descclassname">TestOptions.TestOptions.</code><code class="descname">templates</code><a class="headerlink" href="#TestOptions.TestOptions.templates" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether the current module (and its dependencies)’s templates
should be loaded into QWeb before starting the test. A
boolean, <code class="docutils literal"><span class="pre">false</span></code> by default.</p>
</dd></dl>

</dd></dl>

<p>The test runner can also use two global configuration values set
directly on the <code class="docutils literal"><span class="pre">window</span></code> object:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">oe_all_dependencies</span></code> is an <code class="docutils literal"><span class="pre">Array</span></code> of all modules with a web
component, ordered by dependency (for a module <code class="docutils literal"><span class="pre">A</span></code> with
dependencies <code class="docutils literal"><span class="pre">A'</span></code>, any module of <code class="docutils literal"><span class="pre">A'</span></code> must come before <code class="docutils literal"><span class="pre">A</span></code> in
the array)</li>
</ul>
</div>
<div class="section" id="running-through-python">
<h2>Running through Python<a class="headerlink" href="#running-through-python" title="Permalink to this headline">¶</a></h2>
<p>The web client includes the means to run these tests on the
command-line (or in a CI system), but while actually running it is
pretty simple the setup of the pre-requisite parts has some
complexities.</p>
<ol class="arabic">
<li><p class="first">Install <a class="reference external" href="http://phantomjs.org/">PhantomJS</a>. It is a headless
browser which allows automating running and testing web
pages. <a class="reference external" href="http://pypi.python.org/pypi/QUnitSuite/">QUnitSuite</a> uses it to actually run the <a class="reference external" href="http://qunitjs.com/">qunit</a> test suite.</p>
<p>The <a class="reference external" href="http://phantomjs.org/">PhantomJS</a> website provides pre-built binaries for some
platforms, and your OS’s package management probably provides it as
well.</p>
<p>If you’re building <a class="reference external" href="http://phantomjs.org/">PhantomJS</a> from source, I recommend preparing
for some knitting time as it’s not exactly fast (it needs to
compile both <a class="reference external" href="http://qt-project.org/">Qt</a> and <a class="reference external" href="http://www.webkit.org/">Webkit</a>, both being pretty big projects).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because <a class="reference external" href="http://phantomjs.org/">PhantomJS</a> is webkit-based, it will not be able to test
if Firefox, Opera or Internet Explorer can correctly run the
test suite (and it is only an approximation for Safari and
Chrome). It is therefore recommended to <em>also</em> run the test
suites in actual browsers once in a while.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The version of <a class="reference external" href="http://phantomjs.org/">PhantomJS</a> this was build through is 1.7,
previous versions <em>should</em> work but are not actually supported
(and tend to just segfault when something goes wrong in
<a class="reference external" href="http://phantomjs.org/">PhantomJS</a> itself so they’re a pain to debug).</p>
</div>
</li>
<li><p class="first">Install a new database with all relevant modules (all modules with
a web component at least), then restart the server</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For some tests, a source database needs to be duplicated. This
operation requires that there be no connection to the database
being duplicated, but Odoo doesn’t currently break
existing/outstanding connections, so restarting the server is
the simplest way to ensure everything is in the right state.</p>
</div>
</li>
<li><p class="first">Launch <code class="docutils literal"><span class="pre">oe</span> <span class="pre">run-tests</span> <span class="pre">-d</span> <span class="pre">$DATABASE</span> <span class="pre">-mweb</span></code> with the correct
addons-path specified (and replacing <code class="docutils literal"><span class="pre">$DATABASE</span></code> by the source
database you created above)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you leave out <code class="docutils literal"><span class="pre">-mweb</span></code>, the runner will attempt to run all
the tests in all the modules, which may or may not work.</p>
</div>
</li>
</ol>
<p>If everything went correctly, you should now see a list of tests with
(hopefully) <code class="docutils literal"><span class="pre">ok</span></code> next to their names, closing with a report of the
number of tests run and the time it took:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>test_empty_find (odoo.addons.web.tests.test_dataset.TestDataSetController) ... ok
test_ids_shortcut (odoo.addons.web.tests.test_dataset.TestDataSetController) ... ok
test_regular_find (odoo.addons.web.tests.test_dataset.TestDataSetController) ... ok
web.testing.stack: direct, value, success ... ok
web.testing.stack: direct, deferred, success ... ok
web.testing.stack: direct, value, error ... ok
web.testing.stack: direct, deferred, failure ... ok
web.testing.stack: successful setup ... ok
web.testing.stack: successful teardown ... ok
web.testing.stack: successful setup and teardown ... ok

[snip ~150 lines]

test_convert_complex_context (odoo.addons.web.tests.test_view.DomainsAndContextsTest) ... ok
test_convert_complex_domain (odoo.addons.web.tests.test_view.DomainsAndContextsTest) ... ok
test_convert_literal_context (odoo.addons.web.tests.test_view.DomainsAndContextsTest) ... ok
test_convert_literal_domain (odoo.addons.web.tests.test_view.DomainsAndContextsTest) ... ok
test_retrieve_nonliteral_context (odoo.addons.web.tests.test_view.DomainsAndContextsTest) ... ok
test_retrieve_nonliteral_domain (odoo.addons.web.tests.test_view.DomainsAndContextsTest) ... ok

----------------------------------------------------------------------
Ran 181 tests in 15.706s

OK
</pre></div>
</div>
<p>Congratulation, you have just performed a successful “offline” run of
the OpenERP Web test suite.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that this runs all the Python tests for the <code class="docutils literal"><span class="pre">web</span></code> module,
but all the web tests for all of Odoo. This can be surprising.</p>
</div>
<table class="docutils footnote" frame="void" id="eventsdelegation" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>not all DOM events are compatible with events delegation</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="terminal" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>with a small twist: <code class="xref py py-meth docutils literal"><span class="pre">sqlalchemy.orm.query.Query.group_by()</span></code> is not
terminal, it returns a query which can still be altered.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Gahan Corporation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/reference/javascript.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>